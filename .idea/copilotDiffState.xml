<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/SOLUCION_DEFINITIVA.bat">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SOLUCION_DEFINITIVA.bat" />
              <option name="updatedContent" value="@echo off&#10;echo ==========================================&#10;echo SOLUCION DEFINITIVA - ERROR GRADLE TASKS&#10;echo ==========================================&#10;cd /d &quot;%~dp0&quot;&#10;&#10;echo.&#10;echo Este script resolvera: &quot;Unable to find Gradle tasks to build&quot;&#10;echo.&#10;pause&#10;&#10;echo.&#10;echo [1/8] Cerrando Android Studio si esta abierto...&#10;echo Por favor, CIERRA Android Studio ahora si esta abierto.&#10;echo.&#10;pause&#10;&#10;echo.&#10;echo [2/8] Deteniendo procesos de Gradle...&#10;call gradlew.bat --stop&#10;timeout /t 3 /nobreak &gt; nul&#10;&#10;echo.&#10;echo [3/8] Eliminando cache del proyecto...&#10;if exist .gradle rmdir /s /q .gradle&#10;if exist .idea rmdir /s /q .idea&#10;if exist .kotlin rmdir /s /q .kotlin&#10;if exist build rmdir /s /q build&#10;if exist app\build rmdir /s /q app\build&#10;&#10;echo.&#10;echo [4/8] Eliminando archivos de configuracion del IDE...&#10;if exist *.iml del /q *.iml&#10;if exist app\*.iml del /q app\*.iml&#10;&#10;echo.&#10;echo [5/8] Limpiando con Gradle...&#10;call gradlew.bat clean&#10;&#10;echo.&#10;echo [6/8] Verificando estructura del proyecto...&#10;call gradlew.bat projects&#10;&#10;echo.&#10;echo [7/8] Listando tareas disponibles...&#10;call gradlew.bat tasks&#10;&#10;echo.&#10;echo [8/8] Compilando el proyecto...&#10;call gradlew.bat assembleDebug&#10;&#10;echo.&#10;echo ==========================================&#10;echo COMPLETADO!&#10;echo ==========================================&#10;echo.&#10;echo Ahora ABRE Android Studio y:&#10;echo 1. Abre este proyecto&#10;echo 2. File ^&gt; Sync Project with Gradle Files&#10;echo 3. Build ^&gt; Rebuild Project&#10;echo.&#10;echo El error deberia estar resuelto.&#10;echo ==========================================&#10;pause&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/admin/AdminScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/admin/AdminScreen.kt" />
              <option name="originalContent" value="package com.example.appcolegios.admin&#10;&#10;import android.content.Intent&#10;import android.net.Uri&#10;import androidx.activity.compose.rememberLauncherForActivityResult&#10;import androidx.activity.result.contract.ActivityResultContracts&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import com.google.firebase.firestore.FirebaseFirestore&#10;import kotlinx.coroutines.launch&#10;import java.io.BufferedReader&#10;import java.io.InputStreamReader&#10;import kotlinx.coroutines.tasks.await&#10;import com.example.appcolegios.data.UserData&#10;import com.example.appcolegios.data.UserPreferencesRepository&#10;import com.example.appcolegios.data.model.Role&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.compose.runtime.collectAsState&#10;import com.example.appcolegios.auth.RegisterActivity&#10;import org.apache.poi.ss.usermodel.WorkbookFactory&#10;import java.io.BufferedInputStream&#10;import com.google.firebase.FirebaseApp&#10;import com.google.firebase.FirebaseOptions&#10;import com.google.firebase.auth.FirebaseAuth&#10;&#10;@Composable&#10;fun AdminScreen() {&#10;    val context = LocalContext.current&#10;    val userPrefs = remember { UserPreferencesRepository(context) }&#10;    val userData = userPrefs.userData.collectAsState(initial = UserData(null, null, null)).value&#10;    // Tratar rol nulo o vacío como ADMIN&#10;    val role = if (userData.role.isNullOrBlank()) Role.ADMIN else Role.fromString(userData.role)&#10;&#10;    if (role != Role.ADMIN) {&#10;        Box(modifier = Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {&#10;            Text(&quot;No autorizado&quot;, color = MaterialTheme.colorScheme.error)&#10;        }&#10;        return&#10;    }&#10;&#10;    val scope = rememberCoroutineScope()&#10;    val db = remember { FirebaseFirestore.getInstance() }&#10;&#10;    var status by remember { mutableStateOf&lt;String?&gt;(null) }&#10;    var isLoading by remember { mutableStateOf(false) }&#10;&#10;    val filePicker = rememberLauncherForActivityResult(ActivityResultContracts.OpenDocument()) { uri: Uri? -&gt;&#10;        if (uri != null) {&#10;            scope.launch {&#10;                isLoading = true&#10;                status = null&#10;                try {&#10;                    context.contentResolver.takePersistableUriPermission(uri, Intent.FLAG_GRANT_READ_URI_PERMISSION)&#10;                } catch (_: Exception) {}&#10;&#10;                // Intentar inicializar FirebaseApp secundaria (importer) si existe google-services&#10;                var authImporter: FirebaseAuth? = null&#10;                try {&#10;                    val opts = FirebaseOptions.fromResource(context)&#10;                    val importerApp = if (opts != null) {&#10;                        try { FirebaseApp.getInstance(&quot;importer&quot;) } catch (_: IllegalStateException) { FirebaseApp.initializeApp(context, opts, &quot;importer&quot;) }&#10;                    } else null&#10;                    authImporter = if (importerApp != null) FirebaseAuth.getInstance(importerApp) else null&#10;                } catch (_: Exception) { authImporter = null }&#10;&#10;                try {&#10;                    // Detectar por extensión si es CSV o XLSX&#10;                    val name = uri.lastPathSegment ?: &quot;&quot;&#10;                    val isXlsx = name.endsWith(&quot;.xlsx&quot;, ignoreCase = true) || name.endsWith(&quot;.xls&quot;, ignoreCase = true)&#10;                    var count = 0&#10;                    if (isXlsx) {&#10;                        // Leer con Apache POI&#10;                        context.contentResolver.openInputStream(uri)?.use { input -&gt;&#10;                            BufferedInputStream(input).use { bis -&gt;&#10;                                val wb = WorkbookFactory.create(bis)&#10;                                val sheet = wb.getSheetAt(0)&#10;                                for (r in 1..sheet.lastRowNum) {&#10;                                    val row = sheet.getRow(r) ?: continue&#10;                                    // Soportar dos formatos:&#10;                                    // Formato completo (9 cols): 0 nombre,1 apellidos,2 tipoDoc,3 numeroDoc,4 celular,5 direccion,6 email,7 pass,8 rol&#10;                                    // Formato compacto (&gt;=5 cols): 0 nombre,1 apellidos,2 tipo,3 email,4 role&#10;                                    val cellCount = row.lastCellNum?.toInt() ?: 0&#10;                                    var nombre = &quot;&quot;&#10;                                    var apellidos = &quot;&quot;&#10;                                    var tipo = &quot;&quot;&#10;                                    var email = &quot;&quot;&#10;                                    var pass: String? = null&#10;                                    var rol = &quot;ESTUDIANTE&quot;&#10;&#10;                                    if (cellCount &gt;= 9) {&#10;                                        nombre = row.getCell(0)?.toString()?.trim() ?: &quot;&quot;&#10;                                        apellidos = row.getCell(1)?.toString()?.trim() ?: &quot;&quot;&#10;                                        tipo = row.getCell(2)?.toString()?.trim() ?: &quot;&quot;&#10;                                        // salto campos intermedios&#10;                                        email = row.getCell(6)?.toString()?.trim() ?: &quot;&quot;&#10;                                        pass = row.getCell(7)?.toString()?.trim()?.takeIf { it.isNotBlank() }&#10;                                        val rawRol = row.getCell(8)?.toString()?.trim()&#10;                                        rol = if (rawRol.isNullOrBlank()) &quot;ESTUDIANTE&quot; else rawRol&#10;                                    } else if (cellCount &gt;= 5) {&#10;                                        nombre = row.getCell(0)?.toString()?.trim() ?: &quot;&quot;&#10;                                        apellidos = row.getCell(1)?.toString()?.trim() ?: &quot;&quot;&#10;                                        tipo = row.getCell(2)?.toString()?.trim() ?: &quot;&quot;&#10;                                        email = row.getCell(3)?.toString()?.trim() ?: &quot;&quot;&#10;                                        rol = row.getCell(4)?.toString()?.trim() ?: &quot;ESTUDIANTE&quot;&#10;                                        // si hay columna 5 posible password&#10;                                        if (cellCount &gt; 5) pass = row.getCell(5)?.toString()?.trim()?.takeIf { it.isNotBlank() }&#10;                                    } else {&#10;                                        // intentar una heuristica: buscar el primer email-like cell&#10;                                        for (c in 0 until cellCount) {&#10;                                            val v = row.getCell(c)?.toString()?.trim() ?: &quot;&quot;&#10;                                            if (v.contains(&quot;@&quot;)) { email = v; break }&#10;                                        }&#10;                                        nombre = row.getCell(0)?.toString()?.trim() ?: &quot;&quot;&#10;                                    }&#10;&#10;                                    if (email.isBlank() || nombre.isBlank()) continue&#10;&#10;                                    val roleParsed = when (rol.uppercase()) {&#10;                                        &quot;PADRE&quot;, &quot;PARENT&quot; -&gt; &quot;PADRE&quot;&#10;                                        &quot;DOCENTE&quot;, &quot;TEACHER&quot; -&gt; &quot;DOCENTE&quot;&#10;                                        &quot;ADMIN&quot;, &quot;ADMINISTRADOR&quot; -&gt; &quot;ADMIN&quot;&#10;                                        else -&gt; &quot;ESTUDIANTE&quot;&#10;                                    }&#10;&#10;                                    val coll = when (roleParsed) {&#10;                                        &quot;PADRE&quot; -&gt; &quot;parents&quot;&#10;                                        &quot;DOCENTE&quot; -&gt; &quot;teachers&quot;&#10;                                        &quot;ADMIN&quot; -&gt; &quot;admins&quot;&#10;                                        else -&gt; &quot;students&quot;&#10;                                    }&#10;&#10;                                    try {&#10;                                        if (pass != null &amp;&amp; authImporter != null) {&#10;                                            // Crear en Auth y guardar con UID&#10;                                            val res = authImporter.createUserWithEmailAndPassword(email, pass).await()&#10;                                            val uid = res.user?.uid ?: db.collection(coll).document().id&#10;                                            val data = hashMapOf(&#10;                                                &quot;nombres&quot; to nombre,&#10;                                                &quot;apellidos&quot; to apellidos,&#10;                                                &quot;email&quot; to email,&#10;                                                &quot;tipo&quot; to tipo,&#10;                                                &quot;role&quot; to roleParsed,&#10;                                                &quot;importedAt&quot; to com.google.firebase.Timestamp.now()&#10;                                            )&#10;                                            db.collection(coll).document(uid).set(data).await()&#10;                                            // enviar verificacion&#10;                                            try { authImporter.currentUser?.sendEmailVerification() } catch (_: Exception) {}&#10;                                        } else {&#10;                                            // Guardar doc y encolar petición para backend&#10;                                            val data = hashMapOf(&#10;                                                &quot;nombres&quot; to nombre,&#10;                                                &quot;apellidos&quot; to apellidos,&#10;                                                &quot;email&quot; to email,&#10;                                                &quot;tipo&quot; to tipo,&#10;                                                &quot;role&quot; to roleParsed,&#10;                                                &quot;importedAt&quot; to com.google.firebase.Timestamp.now()&#10;                                            )&#10;                                            db.collection(coll).add(data).await()&#10;                                            db.collection(&quot;auth_queue&quot;).add(hashMapOf(&#10;                                                &quot;email&quot; to email,&#10;                                                &quot;role&quot; to roleParsed,&#10;                                                &quot;displayName&quot; to (&quot;$nombre $apellidos&quot;).trim(),&#10;                                                &quot;requestedAt&quot; to com.google.firebase.Timestamp.now()&#10;                                            )).await()&#10;                                        }&#10;                                        count++&#10;                                    } catch (e: Exception) {&#10;                                        // registrar error y continuar&#10;                                    }&#10;                                }&#10;                                wb.close()&#10;                            }&#10;                        }&#10;                    } else {&#10;                        // CSV (mantener comportamiento anterior, con intento de creación si hay password column)&#10;                        context.contentResolver.openInputStream(uri)?.use { input -&gt;&#10;                            val reader = BufferedReader(InputStreamReader(input))&#10;                            reader.readLine() // descartar encabezado&#10;                            var line: String?&#10;                            var localCount = 0&#10;                            while (true) {&#10;                                line = reader.readLine() ?: break&#10;                                val parts = line.split(',')&#10;                                if (parts.size &gt;= 3) {&#10;                                    val type = parts[0].trim().lowercase()&#10;                                    val email = parts[1].trim()&#10;                                    val name = parts[2].trim()&#10;                                    val parsedRole = when (parts.getOrNull(3)?.trim()?.uppercase()) {&#10;                                        &quot;PADRE&quot; -&gt; &quot;PADRE&quot;&#10;                                        &quot;DOCENTE&quot; -&gt; &quot;DOCENTE&quot;&#10;                                        &quot;ADMIN&quot; -&gt; &quot;ADMIN&quot;&#10;                                        else -&gt; &quot;ESTUDIANTE&quot;&#10;                                    }&#10;                                    val maybePass = parts.getOrNull(4)?.trim()?.takeIf { it.isNotBlank() }&#10;                                    val coll = when (parsedRole) {&#10;                                        &quot;PADRE&quot; -&gt; &quot;parents&quot;&#10;                                        &quot;DOCENTE&quot; -&gt; &quot;teachers&quot;&#10;                                        &quot;ADMIN&quot; -&gt; &quot;admins&quot;&#10;                                        else -&gt; &quot;students&quot;&#10;                                    }&#10;&#10;                                    try {&#10;                                        if (maybePass != null &amp;&amp; authImporter != null) {&#10;                                            val res = authImporter.createUserWithEmailAndPassword(email, maybePass).await()&#10;                                            val uid = res.user?.uid ?: db.collection(coll).document().id&#10;                                            db.collection(coll).document(uid).set(hashMapOf(&#10;                                                &quot;name&quot; to name,&#10;                                                &quot;email&quot; to email,&#10;                                                &quot;role&quot; to parsedRole,&#10;                                                &quot;type&quot; to type,&#10;                                                &quot;importedAt&quot; to com.google.firebase.Timestamp.now()&#10;                                            )).await()&#10;                                        } else {&#10;                                            db.collection(coll).add(hashMapOf(&#10;                                                &quot;email&quot; to email,&#10;                                                &quot;name&quot; to name,&#10;                                                &quot;role&quot; to parsedRole,&#10;                                                &quot;type&quot; to type,&#10;                                                &quot;importedAt&quot; to com.google.firebase.Timestamp.now()&#10;                                            )).await()&#10;                                            db.collection(&quot;auth_queue&quot;).add(hashMapOf(&#10;                                                &quot;email&quot; to email,&#10;                                                &quot;role&quot; to parsedRole,&#10;                                                &quot;displayName&quot; to name,&#10;                                                &quot;requestedAt&quot; to com.google.firebase.Timestamp.now()&#10;                                            )).await()&#10;                                        }&#10;                                        localCount++&#10;                                    } catch (e: Exception) {&#10;                                        // continuar&#10;                                    }&#10;                                }&#10;                            }&#10;                            count = localCount&#10;                        }&#10;                    }&#10;&#10;                    status = &quot;Se importaron $count registros correctamente.&quot;&#10;                } catch (e: Exception) {&#10;                    status = &quot;Error importando: ${e.message}&quot;&#10;                } finally {&#10;                    isLoading = false&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .padding(16.dp),&#10;        verticalArrangement = Arrangement.spacedBy(16.dp)&#10;    ) {&#10;        Text(&#10;            &quot;Panel de Administración&quot;,&#10;            style = MaterialTheme.typography.headlineMedium,&#10;            fontWeight = FontWeight.Bold&#10;        )&#10;&#10;        // Nueva tarjeta: Registrar usuario&#10;        Row(Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.spacedBy(12.dp)) {&#10;            ElevatedCard(modifier = Modifier.weight(1f), onClick = {&#10;                // Lanzar RegisterActivity en modo admin (no afectar sesión)&#10;                val intent = android.content.Intent(context, RegisterActivity::class.java)&#10;                intent.putExtra(&quot;fromAdmin&quot;, true)&#10;                context.startActivity(intent)&#10;            }) {&#10;                Box(Modifier.height(84.dp).fillMaxWidth(), contentAlignment = Alignment.Center) {&#10;                    Text(&quot;Registrar usuario&quot;)&#10;                }&#10;            }&#10;&#10;            // Se eliminaron las tarjetas &quot;Accesos Admin&quot; y &quot;Dashboard&quot; para dejar solo la opción de registrar usuario&#10;            Spacer(modifier = Modifier.weight(1f))&#10;            Spacer(modifier = Modifier.weight(1f))&#10;        }&#10;&#10;        if (status != null) {&#10;            Card(&#10;                colors = CardDefaults.cardColors(&#10;                    containerColor = if (status!!.contains(&quot;Error&quot;))&#10;                        MaterialTheme.colorScheme.errorContainer&#10;                    else&#10;                        MaterialTheme.colorScheme.primaryContainer&#10;                )&#10;            ) {&#10;                Text(&#10;                    status!!,&#10;                    modifier = Modifier.padding(16.dp),&#10;                    color = if (status!!.contains(&quot;Error&quot;))&#10;                        MaterialTheme.colorScheme.onErrorContainer&#10;                    else&#10;                        MaterialTheme.colorScheme.onPrimaryContainer&#10;                )&#10;            }&#10;        }&#10;&#10;        if (isLoading) {&#10;            CircularProgressIndicator()&#10;        }&#10;&#10;        // Botón para inicializar datos de prueba&#10;        Card(&#10;            colors = CardDefaults.cardColors(&#10;                containerColor = MaterialTheme.colorScheme.surface&#10;            ),&#10;            elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)&#10;        ) {&#10;            Column(Modifier.padding(16.dp)) {&#10;                Text(&#10;                    &quot;Inicializar Datos de Prueba&quot;,&#10;                    style = MaterialTheme.typography.titleMedium,&#10;                    fontWeight = FontWeight.Bold&#10;                )&#10;                Spacer(Modifier.height(8.dp))&#10;                Text(&#10;                    &quot;Crea usuarios de prueba con información completa:\n&quot; +&#10;                    &quot;• Estudiante: jcamilodiaz7@gmail.com\n&quot; +&#10;                    &quot;• Profesor: hermanitos605@gmail.com\n&quot; +&#10;                    &quot;• Admin: jcamilodiaz777@gmail.com\n&quot; +&#10;                    &quot;• Padre: hermanitos604@gmail.com&quot;,&#10;                    style = MaterialTheme.typography.bodyMedium&#10;                )&#10;                Spacer(Modifier.height(12.dp))&#10;                Button(&#10;                    onClick = {&#10;                        scope.launch {&#10;                            isLoading = true&#10;                            status = null&#10;                            try {&#10;                                com.example.appcolegios.data.TestDataInitializer.initializeAllTestData()&#10;                                status = &quot;✅ Datos de prueba inicializados correctamente&quot;&#10;                            } catch (e: Exception) {&#10;                                status = &quot;❌ Error: ${e.message}&quot;&#10;                            } finally {&#10;                                isLoading = false&#10;                            }&#10;                        }&#10;                    },&#10;                    enabled = !isLoading,&#10;                    modifier = Modifier.fillMaxWidth()&#10;                ) {&#10;                    Text(&quot;Inicializar Datos de Prueba&quot;)&#10;                }&#10;            }&#10;        }&#10;&#10;        // Botón para importar desde CSV/XLSX&#10;        Button(&#10;            onClick = { filePicker.launch(arrayOf(&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;,&quot;text/*&quot;,&quot;text/csv&quot;,&quot;text/comma-separated-values&quot;)) },&#10;            enabled = !isLoading,&#10;            modifier = Modifier.fillMaxWidth()&#10;        ) {&#10;            Text(&quot;Importar desde CSV / Excel (.xlsx)&quot;)&#10;        }&#10;&#10;        Text(&#10;            &quot;Formato CSV: tipo,email,nombre,rol\nEjemplo: estudiante,juan@mail.com,Juan Pérez,ESTUDIANTE&quot;,&#10;            style = MaterialTheme.typography.bodySmall,&#10;            color = MaterialTheme.colorScheme.onSurfaceVariant&#10;        )&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="@file:Suppress(&quot;RedundantQualifierName&quot;)&#10;&#10;package com.example.appcolegios.admin&#10;&#10;import android.content.Intent&#10;import android.net.Uri&#10;import androidx.activity.compose.rememberLauncherForActivityResult&#10;import androidx.activity.result.contract.ActivityResultContracts&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import com.google.firebase.firestore.FirebaseFirestore&#10;import com.google.firebase.Timestamp&#10;import kotlinx.coroutines.launch&#10;import java.io.BufferedReader&#10;import java.io.InputStreamReader&#10;import kotlinx.coroutines.tasks.await&#10;import com.example.appcolegios.data.UserData&#10;import com.example.appcolegios.data.UserPreferencesRepository&#10;import com.example.appcolegios.data.model.Role&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.compose.runtime.collectAsState&#10;import com.example.appcolegios.auth.RegisterActivity&#10;import org.apache.poi.ss.usermodel.WorkbookFactory&#10;import java.io.BufferedInputStream&#10;import com.google.firebase.FirebaseApp&#10;import com.google.firebase.FirebaseOptions&#10;import com.google.firebase.auth.FirebaseAuth&#10;&#10;@Composable&#10;fun AdminScreen() {&#10;    val context = LocalContext.current&#10;    val userPrefs = remember { UserPreferencesRepository(context) }&#10;    val userData = userPrefs.userData.collectAsState(initial = UserData(null, null, null)).value&#10;    // Tratar rol nulo o vacío como ADMIN&#10;    val role = if (userData.role.isNullOrBlank()) Role.ADMIN else Role.fromString(userData.role)&#10;&#10;    if (role != Role.ADMIN) {&#10;        Box(modifier = Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {&#10;            Text(&quot;No autorizado&quot;, color = MaterialTheme.colorScheme.error)&#10;        }&#10;        return&#10;    }&#10;&#10;    val scope = rememberCoroutineScope()&#10;    val db = remember { FirebaseFirestore.getInstance() }&#10;&#10;    var status by remember { mutableStateOf&lt;String?&gt;(null) }&#10;    var isLoading by remember { mutableStateOf(false) }&#10;&#10;    val filePicker = rememberLauncherForActivityResult(ActivityResultContracts.OpenDocument()) { uri: Uri? -&gt;&#10;        if (uri != null) {&#10;            scope.launch {&#10;                isLoading = true&#10;                status = null&#10;                try {&#10;                    context.contentResolver.takePersistableUriPermission(uri, Intent.FLAG_GRANT_READ_URI_PERMISSION)&#10;                } catch (_: Exception) {}&#10;&#10;                // Intentar inicializar FirebaseApp secundaria (importer) si existe google-services&#10;                var authImporter: FirebaseAuth? = null&#10;                try {&#10;                    val opts = FirebaseOptions.fromResource(context)&#10;                    val importerApp = if (opts != null) {&#10;                        try { FirebaseApp.getInstance(&quot;importer&quot;) } catch (_: IllegalStateException) { FirebaseApp.initializeApp(context, opts, &quot;importer&quot;) }&#10;                    } else null&#10;                    authImporter = if (importerApp != null) FirebaseAuth.getInstance(importerApp) else null&#10;                } catch (_: Exception) { authImporter = null }&#10;&#10;                try {&#10;                    // Detectar por extensión si es CSV o XLSX&#10;                    val name = uri.lastPathSegment ?: &quot;&quot;&#10;                    val isXlsx = name.endsWith(&quot;.xlsx&quot;, ignoreCase = true) || name.endsWith(&quot;.xls&quot;, ignoreCase = true)&#10;                    var count = 0&#10;                    if (isXlsx) {&#10;                        // Leer con Apache POI&#10;                        context.contentResolver.openInputStream(uri)?.use { input -&gt;&#10;                            BufferedInputStream(input).use { bis -&gt;&#10;                                val wb = WorkbookFactory.create(bis)&#10;                                val sheet = wb.getSheetAt(0)&#10;                                for (r in 1..sheet.lastRowNum) {&#10;                                    val row = sheet.getRow(r) ?: continue&#10;                                    // Soportar dos formatos:&#10;                                    // Formato completo (9 cols): 0 nombre,1 apellidos,2 tipoDoc,3 numeroDoc,4 celular,5 direccion,6 email,7 pass,8 rol&#10;                                    // Formato compacto (&gt;=5 cols): 0 nombre,1 apellidos,2 tipo,3 email,4 role&#10;                                    val cellCount = row.lastCellNum?.toInt() ?: 0&#10;                                    var nombre = &quot;&quot;&#10;                                    var apellidos = &quot;&quot;&#10;                                    var tipo = &quot;&quot;&#10;                                    var email = &quot;&quot;&#10;                                    var pass: String? = null&#10;                                    var rol = &quot;ESTUDIANTE&quot;&#10;&#10;                                    if (cellCount &gt;= 9) {&#10;                                        nombre = row.getCell(0)?.toString()?.trim() ?: &quot;&quot;&#10;                                        apellidos = row.getCell(1)?.toString()?.trim() ?: &quot;&quot;&#10;                                        tipo = row.getCell(2)?.toString()?.trim() ?: &quot;&quot;&#10;                                        // salto campos intermedios&#10;                                        email = row.getCell(6)?.toString()?.trim() ?: &quot;&quot;&#10;                                        val cell7 = row.getCell(7)?.let { it.toString().trim() }&#10;                                        pass = cell7?.takeIf { it.isNotBlank() }&#10;                                        // leer rol&#10;                                        val rawRol = row.getCell(8)?.toString()?.trim() ?: &quot;&quot;&#10;                                        rol = if (rawRol.isBlank()) &quot;ESTUDIANTE&quot; else rawRol&#10;                                    } else if (cellCount &gt;= 5) {&#10;                                        nombre = row.getCell(0)?.toString()?.trim() ?: &quot;&quot;&#10;                                        apellidos = row.getCell(1)?.toString()?.trim() ?: &quot;&quot;&#10;                                        tipo = row.getCell(2)?.toString()?.trim() ?: &quot;&quot;&#10;                                        email = row.getCell(3)?.toString()?.trim() ?: &quot;&quot;&#10;                                        rol = row.getCell(4)?.toString()?.trim() ?: &quot;ESTUDIANTE&quot;&#10;                                        // si hay columna 5 posible password&#10;                                        if (cellCount &gt; 5) pass = row.getCell(5)?.toString()?.trim()?.takeIf { it.isNotBlank() }&#10;                                    } else {&#10;                                        // intentar una heuristica: buscar el primer email-like cell&#10;                                        for (c in 0 until cellCount) {&#10;                                            val v = row.getCell(c)?.toString()?.trim() ?: &quot;&quot;&#10;                                            if (v.contains(&quot;@&quot;)) { email = v; break }&#10;                                        }&#10;                                        nombre = row.getCell(0)?.toString()?.trim() ?: &quot;&quot;&#10;                                    }&#10;&#10;                                    if (email.isBlank() || nombre.isBlank()) continue&#10;&#10;                                    val roleParsed = when (rol.uppercase()) {&#10;                                        &quot;PADRE&quot;, &quot;PARENT&quot; -&gt; &quot;PADRE&quot;&#10;                                        &quot;DOCENTE&quot;, &quot;TEACHER&quot; -&gt; &quot;DOCENTE&quot;&#10;                                        &quot;ADMIN&quot;, &quot;ADMINISTRADOR&quot; -&gt; &quot;ADMIN&quot;&#10;                                        else -&gt; &quot;ESTUDIANTE&quot;&#10;                                    }&#10;&#10;                                    val coll = when (roleParsed) {&#10;                                        &quot;PADRE&quot; -&gt; &quot;parents&quot;&#10;                                        &quot;DOCENTE&quot; -&gt; &quot;teachers&quot;&#10;                                        &quot;ADMIN&quot; -&gt; &quot;admins&quot;&#10;                                        else -&gt; &quot;students&quot;&#10;                                    }&#10;&#10;                                    try {&#10;                                        if (pass != null &amp;&amp; authImporter != null) {&#10;                                            // Crear en Auth y guardar con UID&#10;                                            val res = authImporter.createUserWithEmailAndPassword(email, pass).await()&#10;                                            val uid = res.user?.uid ?: db.collection(coll).document().id&#10;                                            val data = hashMapOf(&#10;                                                &quot;nombres&quot; to nombre,&#10;                                                &quot;apellidos&quot; to apellidos,&#10;                                                &quot;email&quot; to email,&#10;                                                &quot;tipo&quot; to tipo,&#10;                                                &quot;role&quot; to roleParsed,&#10;                                                &quot;importedAt&quot; to Timestamp.now()&#10;                                            )&#10;                                            db.collection(coll).document(uid).set(data).await()&#10;                                            // Además, crear documento en la colección &quot;users&quot; para que la app lo encuentre&#10;                                            try {&#10;                                                val displayName = (&quot;$nombre $apellidos&quot;).trim()&#10;                                                val userMap = hashMapOf(&#10;                                                    &quot;displayName&quot; to displayName,&#10;                                                    &quot;email&quot; to email,&#10;                                                    &quot;role&quot; to roleParsed&#10;                                                )&#10;                                                db.collection(&quot;users&quot;).document(uid).set(userMap).await()&#10;                                            } catch (_: Exception) { }&#10;                                            // enviar verificacion de forma asíncrona y esperar&#10;                                            try {&#10;                                                res.user?.let { it.sendEmailVerification().await() }&#10;                                            } catch (_: Exception) { }&#10;                                            // Asegurarse de no dejar al importer autenticado&#10;                                            try { authImporter.signOut() } catch (_: Exception) {}&#10;                                        } else {&#10;                                            // Guardar doc y encolar petición para backend&#10;                                            val data = hashMapOf(&#10;                                                &quot;nombres&quot; to nombre,&#10;                                                &quot;apellidos&quot; to apellidos,&#10;                                                &quot;email&quot; to email,&#10;                                                &quot;tipo&quot; to tipo,&#10;                                                &quot;role&quot; to roleParsed,&#10;                                                &quot;importedAt&quot; to Timestamp.now()&#10;                                            )&#10;                                            db.collection(coll).add(data).await()&#10;                                            db.collection(&quot;auth_queue&quot;).add(hashMapOf(&#10;                                                &quot;email&quot; to email,&#10;                                                &quot;role&quot; to roleParsed,&#10;                                                &quot;displayName&quot; to (&quot;$nombre $apellidos&quot;).trim(),&#10;                                                &quot;requestedAt&quot; to Timestamp.now()&#10;                                            )).await()&#10;&#10;                                            // Cambio mínimo: crear también un documento en &quot;users&quot; para que la app tenga acceso al correo&#10;                                            try {&#10;                                                val userMap = hashMapOf(&#10;                                                    &quot;displayName&quot; to (&quot;$nombre $apellidos&quot;).trim(),&#10;                                                    &quot;email&quot; to email,&#10;                                                    &quot;role&quot; to roleParsed,&#10;                                                    &quot;importedAt&quot; to Timestamp.now()&#10;                                                )&#10;                                                db.collection(&quot;users&quot;).add(userMap).await()&#10;                                            } catch (_: Exception) { }&#10;&#10;                                            // Intentar enviar email de restablecimiento (si la cuenta ya existe esto ayudará al usuario a establecer contraseña)&#10;                                            try {&#10;                                                val mainAuth = FirebaseAuth.getInstance()&#10;                                                mainAuth.sendPasswordResetEmail(email).await()&#10;                                            } catch (_: Exception) { }&#10;                                        }&#10;                                        count++&#10;                                    } catch (e: Exception) {&#10;                                        // registrar error y continuar&#10;                                    }&#10;                                }&#10;                                wb.close()&#10;                            }&#10;                        }&#10;                    } else {&#10;                        // CSV (mantener comportamiento anterior, con intento de creación si hay password column)&#10;                        context.contentResolver.openInputStream(uri)?.use { input -&gt;&#10;                            val reader = BufferedReader(InputStreamReader(input))&#10;                            reader.readLine() // descartar encabezado&#10;                            var line: String?&#10;                            var localCount = 0&#10;                            while (true) {&#10;                                line = reader.readLine() ?: break&#10;                                val parts = line.split(',')&#10;                                if (parts.size &gt;= 3) {&#10;                                    val type = parts[0].trim().lowercase()&#10;                                    val email = parts[1].trim()&#10;                                    val name = parts[2].trim()&#10;                                    val parsedRole = when (parts.getOrNull(3)?.trim()?.uppercase()) {&#10;                                        &quot;PADRE&quot; -&gt; &quot;PADRE&quot;&#10;                                        &quot;DOCENTE&quot; -&gt; &quot;DOCENTE&quot;&#10;                                        &quot;ADMIN&quot; -&gt; &quot;ADMIN&quot;&#10;                                        else -&gt; &quot;ESTUDIANTE&quot;&#10;                                    }&#10;                                    val maybePass = parts.getOrNull(4)?.trim()?.takeIf { it.isNotBlank() }&#10;                                    val coll = when (parsedRole) {&#10;                                        &quot;PADRE&quot; -&gt; &quot;parents&quot;&#10;                                        &quot;DOCENTE&quot; -&gt; &quot;teachers&quot;&#10;                                        &quot;ADMIN&quot; -&gt; &quot;admins&quot;&#10;                                        else -&gt; &quot;students&quot;&#10;                                    }&#10;&#10;                                    try {&#10;                                        if (maybePass != null &amp;&amp; authImporter != null) {&#10;                                            val res = authImporter.createUserWithEmailAndPassword(email, maybePass).await()&#10;                                            val uid = res.user?.uid ?: db.collection(coll).document().id&#10;                                            db.collection(coll).document(uid).set(hashMapOf(&#10;                                                &quot;name&quot; to name,&#10;                                                &quot;email&quot; to email,&#10;                                                &quot;role&quot; to parsedRole,&#10;                                                &quot;type&quot; to type,&#10;                                                &quot;importedAt&quot; to Timestamp.now()&#10;                                            )).await()&#10;                                        } else {&#10;                                            db.collection(coll).add(hashMapOf(&#10;                                                &quot;email&quot; to email,&#10;                                                &quot;name&quot; to name,&#10;                                                &quot;role&quot; to parsedRole,&#10;                                                &quot;type&quot; to type,&#10;                                                &quot;importedAt&quot; to Timestamp.now()&#10;                                            )).await()&#10;                                            db.collection(&quot;auth_queue&quot;).add(hashMapOf(&#10;                                                &quot;email&quot; to email,&#10;                                                &quot;role&quot; to parsedRole,&#10;                                                &quot;displayName&quot; to name,&#10;                                                &quot;requestedAt&quot; to Timestamp.now()&#10;                                            )).await()&#10;                                        }&#10;                                        localCount++&#10;                                    } catch (e: Exception) {&#10;                                        // continuar&#10;                                    }&#10;                                }&#10;                            }&#10;                            count = localCount&#10;                        }&#10;                    }&#10;&#10;                    status = &quot;Se importaron $count registros correctamente.&quot;&#10;                } catch (e: Exception) {&#10;                    status = &quot;Error importando: ${e.message}&quot;&#10;                } finally {&#10;                    isLoading = false&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .padding(16.dp),&#10;        verticalArrangement = Arrangement.spacedBy(16.dp)&#10;    ) {&#10;        Text(&#10;            &quot;Panel de Administración&quot;,&#10;            style = MaterialTheme.typography.headlineMedium,&#10;            fontWeight = FontWeight.Bold&#10;        )&#10;&#10;        // Nueva tarjeta: Registrar usuario&#10;        Row(Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.spacedBy(12.dp)) {&#10;            ElevatedCard(modifier = Modifier.weight(1f), onClick = {&#10;                // Lanzar RegisterActivity en modo admin (no afectar sesión)&#10;                val intent = android.content.Intent(context, RegisterActivity::class.java)&#10;                intent.putExtra(&quot;fromAdmin&quot;, true)&#10;                context.startActivity(intent)&#10;            }) {&#10;                Box(Modifier.height(84.dp).fillMaxWidth(), contentAlignment = Alignment.Center) {&#10;                    Text(&quot;Registrar usuario&quot;)&#10;                }&#10;            }&#10;&#10;            // Se eliminaron las tarjetas &quot;Accesos Admin&quot; y &quot;Dashboard&quot; para dejar solo la opción de registrar usuario&#10;            Spacer(modifier = Modifier.weight(1f))&#10;            Spacer(modifier = Modifier.weight(1f))&#10;        }&#10;&#10;        if (status != null) {&#10;            Card(&#10;                colors = CardDefaults.cardColors(&#10;                    containerColor = if (status!!.contains(&quot;Error&quot;))&#10;                        MaterialTheme.colorScheme.errorContainer&#10;                    else&#10;                        MaterialTheme.colorScheme.primaryContainer&#10;                )&#10;            ) {&#10;                Text(&#10;                    status!!,&#10;                    modifier = Modifier.padding(16.dp),&#10;                    color = if (status!!.contains(&quot;Error&quot;))&#10;                        MaterialTheme.colorScheme.onErrorContainer&#10;                    else&#10;                        MaterialTheme.colorScheme.onPrimaryContainer&#10;                )&#10;            }&#10;        }&#10;&#10;        if (isLoading) {&#10;            CircularProgressIndicator()&#10;        }&#10;&#10;        // Botón para inicializar datos de prueba&#10;        Card(&#10;            colors = CardDefaults.cardColors(&#10;                containerColor = MaterialTheme.colorScheme.surface&#10;            ),&#10;            elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)&#10;        ) {&#10;            Column(Modifier.padding(16.dp)) {&#10;                Text(&#10;                    &quot;Inicializar Datos de Prueba&quot;,&#10;                    style = MaterialTheme.typography.titleMedium,&#10;                    fontWeight = FontWeight.Bold&#10;                )&#10;                Spacer(Modifier.height(8.dp))&#10;                Text(&#10;                    &quot;Crea usuarios de prueba con información completa:\n&quot; +&#10;                    &quot;• Estudiante: jcamilodiaz7@gmail.com\n&quot; +&#10;                    &quot;• Profesor: hermanitos605@gmail.com\n&quot; +&#10;                    &quot;• Admin: jcamilodiaz777@gmail.com\n&quot; +&#10;                    &quot;• Padre: hermanitos604@gmail.com&quot;,&#10;                    style = MaterialTheme.typography.bodyMedium&#10;                )&#10;                Spacer(Modifier.height(12.dp))&#10;                Button(&#10;                    onClick = {&#10;                        scope.launch {&#10;                            isLoading = true&#10;                            status = null&#10;                            try {&#10;                                com.example.appcolegios.data.TestDataInitializer.initializeAllTestData()&#10;                                status = &quot;✅ Datos de prueba inicializados correctamente&quot;&#10;                            } catch (e: Exception) {&#10;                                status = &quot;❌ Error: ${e.message}&quot;&#10;                            } finally {&#10;                                isLoading = false&#10;                            }&#10;                        }&#10;                    },&#10;                    enabled = !isLoading,&#10;                    modifier = Modifier.fillMaxWidth()&#10;                ) {&#10;                    Text(&quot;Inicializar Datos de Prueba&quot;)&#10;                }&#10;            }&#10;        }&#10;&#10;        // Botón para importar desde CSV/XLSX&#10;        Button(&#10;            onClick = { filePicker.launch(arrayOf(&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;,&quot;text/*&quot;,&quot;text/csv&quot;,&quot;text/comma-separated-values&quot;)) },&#10;            enabled = !isLoading,&#10;            modifier = Modifier.fillMaxWidth()&#10;        ) {&#10;            Text(&quot;Importar desde CSV / Excel (.xlsx)&quot;)&#10;        }&#10;&#10;        Text(&#10;            &quot;Formato CSV: tipo,email,nombre,rol\nEjemplo: estudiante,juan@mail.com,Juan Pérez,ESTUDIANTE&quot;,&#10;            style = MaterialTheme.typography.bodySmall,&#10;            color = MaterialTheme.colorScheme.onSurfaceVariant&#10;        )&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/auth/LoginActivity.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/auth/LoginActivity.kt" />
              <option name="originalContent" value="package com.example.appcolegios.auth&#10;&#10;import android.content.Intent&#10;import android.os.Bundle&#10;import android.widget.EditText&#10;import android.widget.TextView&#10;import android.widget.Toast&#10;import androidx.appcompat.app.AppCompatActivity&#10;import com.example.appcolegios.R&#10;import com.google.firebase.auth.FirebaseAuth&#10;import com.google.android.material.button.MaterialButton&#10;import com.google.firebase.firestore.FirebaseFirestore&#10;import androidx.lifecycle.lifecycleScope&#10;import com.example.appcolegios.data.UserPreferencesRepository&#10;import kotlinx.coroutines.launch&#10;&#10;class LoginActivity : AppCompatActivity() {&#10;    private lateinit var auth: FirebaseAuth&#10;    private val firestore = FirebaseFirestore.getInstance()&#10;&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        super.onCreate(savedInstanceState)&#10;        setContentView(R.layout.activity_login)&#10;        auth = FirebaseAuth.getInstance()&#10;&#10;        val emailInput: EditText = findViewById(R.id.emailInput)&#10;        val passwordInput: EditText = findViewById(R.id.passwordInput)&#10;        val loginButton: MaterialButton = findViewById(R.id.loginButton)&#10;        val resetLink: TextView = findViewById(R.id.resetLink)&#10;&#10;        loginButton.setOnClickListener {&#10;            val email = emailInput.text.toString().trim()&#10;            val password = passwordInput.text.toString().trim()&#10;            if (email.isEmpty() || password.isEmpty()) {&#10;                Toast.makeText(this, &quot;Ingresa email y contraseña&quot;, Toast.LENGTH_SHORT).show()&#10;            } else {&#10;                auth.signInWithEmailAndPassword(email, password)&#10;                    .addOnSuccessListener {&#10;                        // Obtener rol desde Firestore y redirigir al startDestination apropiado&#10;                        val user = auth.currentUser&#10;                        if (user == null) {&#10;                            // Fallback&#10;                            val intent = Intent(this, com.example.appcolegios.MainActivity::class.java)&#10;                            intent.putExtra(&quot;startDestination&quot;, &quot;home&quot;)&#10;                            startActivity(intent)&#10;                            finish()&#10;                            return@addOnSuccessListener&#10;                        }&#10;                        firestore.collection(&quot;users&quot;).document(user.uid).get()&#10;                            .addOnSuccessListener { doc -&gt;&#10;                                val role = doc.getString(&quot;role&quot;)?.uppercase() ?: &quot;ADMIN&quot;&#10;                                val displayName = doc.getString(&quot;displayName&quot;) ?: doc.getString(&quot;name&quot;) ?: &quot;&quot;&#10;                                // Guardar en preferencias para sesiones persistentes&#10;                                val userPrefs = UserPreferencesRepository(applicationContext)&#10;                                lifecycleScope.launch {&#10;                                    try {&#10;                                        userPrefs.updateUserData(user.uid, role, displayName)&#10;                                    } catch (_: Exception) {}&#10;                                }&#10;                                val startDestination = when (role) {&#10;                                    // Admin ahora abre 'home' para ver la tarjeta de administración&#10;                                    &quot;ADMIN&quot; -&gt; &quot;home&quot;&#10;                                    &quot;DOCENTE&quot; -&gt; &quot;teacher_home&quot;&#10;                                    &quot;PADRE&quot; -&gt; &quot;home&quot;&#10;                                    &quot;ESTUDIANTE&quot; -&gt; &quot;student_home&quot;&#10;                                    else -&gt; &quot;home&quot;&#10;                                }&#10;                                val intent = Intent(this, com.example.appcolegios.MainActivity::class.java)&#10;                                intent.putExtra(&quot;startDestination&quot;, startDestination)&#10;                                startActivity(intent)&#10;                                finish()&#10;                            }&#10;                            .addOnFailureListener {&#10;                                // Si falla al leer rol, abrir home por defecto&#10;                                val intent = Intent(this, com.example.appcolegios.MainActivity::class.java)&#10;                                intent.putExtra(&quot;startDestination&quot;, &quot;home&quot;)&#10;                                startActivity(intent)&#10;                                finish()&#10;                            }&#10;                    }&#10;                    .addOnFailureListener { e -&gt;&#10;                        Toast.makeText(this, &quot;Error: ${e.localizedMessage}&quot;, Toast.LENGTH_LONG).show()&#10;                    }&#10;            }&#10;        }&#10;        resetLink.setOnClickListener {&#10;            startActivity(Intent(this, ResetPasswordActivity::class.java))&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.appcolegios.auth&#13;&#10;&#13;&#10;import android.content.Intent&#13;&#10;import android.os.Bundle&#13;&#10;import android.widget.EditText&#13;&#10;import android.widget.TextView&#13;&#10;import android.widget.Toast&#13;&#10;import androidx.appcompat.app.AppCompatActivity&#13;&#10;import com.example.appcolegios.R&#13;&#10;import com.google.firebase.auth.FirebaseAuth&#13;&#10;import com.google.android.material.button.MaterialButton&#13;&#10;import com.google.firebase.firestore.FirebaseFirestore&#13;&#10;import androidx.lifecycle.lifecycleScope&#13;&#10;import com.example.appcolegios.data.UserPreferencesRepository&#13;&#10;import kotlinx.coroutines.launch&#13;&#10;import kotlinx.coroutines.tasks.await&#13;&#10;import kotlinx.coroutines.Dispatchers&#13;&#10;import kotlinx.coroutines.withContext&#13;&#10;&#13;&#10;class LoginActivity : AppCompatActivity() {&#13;&#10;    private lateinit var auth: FirebaseAuth&#13;&#10;    private val firestore = FirebaseFirestore.getInstance()&#13;&#10;&#13;&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#13;&#10;        super.onCreate(savedInstanceState)&#13;&#10;        setContentView(R.layout.activity_login)&#13;&#10;        auth = FirebaseAuth.getInstance()&#13;&#10;&#13;&#10;        val emailInput: EditText = findViewById(R.id.emailInput)&#13;&#10;        val passwordInput: EditText = findViewById(R.id.passwordInput)&#13;&#10;        val loginButton: MaterialButton = findViewById(R.id.loginButton)&#13;&#10;        val resetLink: TextView = findViewById(R.id.resetLink)&#13;&#10;&#13;&#10;        loginButton.setOnClickListener {&#13;&#10;            val email = emailInput.text.toString().trim()&#13;&#10;            val password = passwordInput.text.toString().trim()&#13;&#10;            if (email.isEmpty() || password.isEmpty()) {&#13;&#10;                Toast.makeText(this, &quot;Ingresa email y contraseña&quot;, Toast.LENGTH_SHORT).show()&#13;&#10;            } else {&#13;&#10;                // Usar coroutines para control más sencillo y fallback&#13;&#10;                lifecycleScope.launch {&#13;&#10;                    try {&#13;&#10;                        val result = auth.signInWithEmailAndPassword(email, password).await()&#13;&#10;                        val user = result.user&#13;&#10;                        if (user == null) {&#13;&#10;                            val intent = Intent(this@LoginActivity, com.example.appcolegios.MainActivity::class.java)&#13;&#10;                            intent.putExtra(&quot;startDestination&quot;, &quot;home&quot;)&#13;&#10;                            startActivity(intent)&#13;&#10;                            finish()&#13;&#10;                            return@launch&#13;&#10;                        }&#13;&#10;&#13;&#10;                        // Verificar email&#13;&#10;                        if (!user.isEmailVerified) {&#13;&#10;                            auth.signOut()&#13;&#10;                            Toast.makeText(this@LoginActivity, &quot;Por favor verifica tu correo antes de iniciar sesión.&quot;, Toast.LENGTH_LONG).show()&#13;&#10;                            return@launch&#13;&#10;                        }&#13;&#10;&#13;&#10;                        // Intentar obtener role y displayName desde 'users' y, si no está, desde colecciones específicas&#13;&#10;                        val usersDoc = firestore.collection(&quot;users&quot;).document(user.uid).get().await()&#13;&#10;                        var role = usersDoc.getString(&quot;role&quot;)?.uppercase() ?: &quot;&quot;&#13;&#10;                        var displayName = usersDoc.getString(&quot;displayName&quot;) ?: usersDoc.getString(&quot;name&quot;) ?: &quot;&quot;&#13;&#10;&#13;&#10;                        if (role.isBlank() || displayName.isBlank()) {&#13;&#10;                            val collections = listOf(&quot;students&quot;, &quot;teachers&quot;, &quot;parents&quot;, &quot;admins&quot;)&#13;&#10;                            for (coll in collections) {&#13;&#10;                                val doc = firestore.collection(coll).document(user.uid).get().await()&#13;&#10;                                if (doc.exists()) {&#13;&#10;                                    role = doc.getString(&quot;role&quot;) ?: when (coll) {&#13;&#10;                                        &quot;students&quot; -&gt; &quot;ESTUDIANTE&quot;&#13;&#10;                                        &quot;teachers&quot; -&gt; &quot;DOCENTE&quot;&#13;&#10;                                        &quot;parents&quot; -&gt; &quot;PADRE&quot;&#13;&#10;                                        &quot;admins&quot; -&gt; &quot;ADMIN&quot;&#13;&#10;                                        else -&gt; &quot;ADMIN&quot;&#13;&#10;                                    }&#13;&#10;                                    displayName = (doc.getString(&quot;nombres&quot;) ?: doc.getString(&quot;name&quot;)) ?: displayName&#13;&#10;                                    break&#13;&#10;                                }&#13;&#10;                            }&#13;&#10;                            if (displayName.isBlank()) {&#13;&#10;                                val emailStr = user.email&#13;&#10;                                if (!emailStr.isNullOrBlank()) {&#13;&#10;                                    for (coll in listOf(&quot;students&quot;, &quot;teachers&quot;, &quot;parents&quot;, &quot;admins&quot;)) {&#13;&#10;                                        val query = firestore.collection(coll).whereEqualTo(&quot;email&quot;, emailStr).limit(1).get().await()&#13;&#10;                                        if (!query.isEmpty) {&#13;&#10;                                            val d = query.documents[0]&#13;&#10;                                            role = d.getString(&quot;role&quot;) ?: role&#13;&#10;                                            displayName = (d.getString(&quot;nombres&quot;) ?: d.getString(&quot;name&quot;)) ?: displayName&#13;&#10;                                            break&#13;&#10;                                        }&#13;&#10;                                    }&#13;&#10;                                }&#13;&#10;                            }&#13;&#10;                        }&#13;&#10;&#13;&#10;                        if (role.isBlank()) role = &quot;ADMIN&quot;&#13;&#10;&#13;&#10;                        // Guardar en preferencias para sesiones persistentes&#13;&#10;                        val userPrefs = UserPreferencesRepository(applicationContext)&#13;&#10;                        withContext(Dispatchers.IO) {&#13;&#10;                            try {&#13;&#10;                                userPrefs.updateUserData(user.uid, role, displayName)&#13;&#10;                            } catch (_: Exception) {}&#13;&#10;                        }&#13;&#10;&#13;&#10;                        val startDestination = when (role.uppercase()) {&#13;&#10;                            &quot;ADMIN&quot; -&gt; &quot;home&quot;&#13;&#10;                            &quot;DOCENTE&quot; -&gt; &quot;teacher_home&quot;&#13;&#10;                            &quot;PADRE&quot; -&gt; &quot;home&quot;&#13;&#10;                            &quot;ESTUDIANTE&quot; -&gt; &quot;student_home&quot;&#13;&#10;                            else -&gt; &quot;home&quot;&#13;&#10;                        }&#13;&#10;&#13;&#10;                        val intent = Intent(this@LoginActivity, com.example.appcolegios.MainActivity::class.java)&#13;&#10;                        intent.putExtra(&quot;startDestination&quot;, startDestination)&#13;&#10;                        startActivity(intent)&#13;&#10;                        finish()&#13;&#10;                    } catch (e: Exception) {&#13;&#10;                        Toast.makeText(this@LoginActivity, &quot;Error: ${e.localizedMessage}&quot;, Toast.LENGTH_LONG).show()&#13;&#10;                    }&#13;&#10;                }&#13;&#10;             }&#13;&#10;         }&#13;&#10;        resetLink.setOnClickListener {&#13;&#10;            startActivity(Intent(this, ResetPasswordActivity::class.java))&#13;&#10;        }&#13;&#10;    }&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/auth/RegisterActivity.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/auth/RegisterActivity.kt" />
              <option name="originalContent" value="package com.example.appcolegios.auth&#10;&#10;import android.content.Intent&#10;import android.graphics.Color&#10;import android.os.Bundle&#10;import android.view.View&#10;import android.view.ViewGroup&#10;import android.widget.ArrayAdapter&#10;import android.widget.EditText&#10;import android.widget.Spinner&#10;import android.widget.TextView&#10;import android.widget.Toast&#10;import androidx.appcompat.app.AppCompatActivity&#10;import com.example.appcolegios.R&#10;import com.google.firebase.auth.FirebaseAuth&#10;import com.google.firebase.auth.FirebaseAuthUserCollisionException&#10;import com.google.firebase.FirebaseApp&#10;import com.google.firebase.FirebaseOptions&#10;import com.google.firebase.firestore.FirebaseFirestore&#10;import com.google.android.material.button.MaterialButton&#10;import java.util.Locale&#10;&#10;class RegisterActivity : AppCompatActivity() {&#10;    private lateinit var auth: FirebaseAuth&#10;    private lateinit var db: FirebaseFirestore&#10;&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        super.onCreate(savedInstanceState)&#10;        setContentView(R.layout.activity_register)&#10;        auth = FirebaseAuth.getInstance()&#10;        db = FirebaseFirestore.getInstance()&#10;&#10;        val fromAdmin = intent.getBooleanExtra(&quot;fromAdmin&quot;, false)&#10;&#10;        val nameInput: EditText = findViewById(R.id.nameInput)&#10;        val emailInput: EditText = findViewById(R.id.emailInput)&#10;        val documentInput: EditText = findViewById(R.id.documentInput)&#10;        val phoneInput: EditText = findViewById(R.id.phoneInput)&#10;        val passwordInput: EditText = findViewById(R.id.passwordInput)&#10;        val confirmInput: EditText = findViewById(R.id.confirmPasswordInput)&#10;        val roleSpinner: Spinner = findViewById(R.id.roleSpinner)&#10;        val registerButton: MaterialButton = findViewById(R.id.registerButton)&#10;&#10;        // Si viene de admin permitir seleccionar ADMIN y ocultar campos de contraseña opcionalmente&#10;        val roles = if (fromAdmin) listOf(&quot;ESTUDIANTE&quot;, &quot;PADRE&quot;, &quot;DOCENTE&quot;, &quot;ADMIN&quot;) else listOf(&quot;ESTUDIANTE&quot;, &quot;PADRE&quot;, &quot;DOCENTE&quot;)&#10;&#10;        // Adapter personalizado para forzar color de texto (evita que las letras salgan en blanco en temas oscuros)&#10;        val adapter = object : ArrayAdapter&lt;String&gt;(this, android.R.layout.simple_spinner_item, roles) {&#10;            override fun getView(position: Int, convertView: View?, parent: ViewGroup): View {&#10;                val v = super.getView(position, convertView, parent) as TextView&#10;                v.setTextColor(Color.BLACK)&#10;                return v&#10;            }&#10;&#10;            override fun getDropDownView(position: Int, convertView: View?, parent: ViewGroup): View {&#10;                val v = super.getDropDownView(position, convertView, parent) as TextView&#10;                v.setTextColor(Color.BLACK)&#10;                return v&#10;            }&#10;        }&#10;        adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item)&#10;        roleSpinner.adapter = adapter&#10;&#10;        // Si es desde admin no mostramos la confirmación de contraseña y password puede ser opcional&#10;        if (fromAdmin) {&#10;            // No ocultar los campos para que no parezcan &quot;no funcionales&quot;.&#10;            // Sólo avisamos con el hint de que la contraseña no se almacenará en este modo.&#10;            passwordInput.hint = &quot;Opcional (si se deja vacío se encola para backend)&quot;&#10;            confirmInput.hint = &quot;Opcional&quot;&#10;        }&#10;&#10;        registerButton.setOnClickListener {&#10;            val name = nameInput.text.toString().trim()&#10;            val email = emailInput.text.toString().trim()&#10;            val document = documentInput.text.toString().trim()&#10;            val phone = phoneInput.text.toString().trim()&#10;            val password = passwordInput.text.toString().trim()&#10;            val confirm = confirmInput.text.toString().trim()&#10;            // Obtener rol seleccionado y normalizar a mayúsculas; si está vacío, asumir ADMIN&#10;            val rawRole = roles.getOrNull(roleSpinner.selectedItemPosition)&#10;            val role = rawRole?.uppercase(Locale.ROOT) ?: &quot;ADMIN&quot;&#10;&#10;            if (name.isEmpty() || email.isEmpty() || document.isEmpty() || phone.isEmpty() || (!fromAdmin &amp;&amp; (password.isEmpty() || confirm.isEmpty()))) {&#10;                Toast.makeText(this, &quot;Todos los campos son obligatorios&quot;, Toast.LENGTH_SHORT).show()&#10;                return@setOnClickListener&#10;            }&#10;            if (!fromAdmin &amp;&amp; (password.length &lt; 6 || password != confirm)) {&#10;                Toast.makeText(this, &quot;Contraseñas inválidas&quot;, Toast.LENGTH_SHORT).show()&#10;                return@setOnClickListener&#10;            }&#10;&#10;            if (fromAdmin) {&#10;                // Intentamos crear la cuenta en Firebase Auth usando una FirebaseApp secundaria&#10;                // para no afectar la sesión del admin.&#10;                try {&#10;                    val opts = FirebaseOptions.fromResource(this)&#10;                    val importerApp = if (opts != null) {&#10;                        try {&#10;                            FirebaseApp.getInstance(&quot;importer&quot;)&#10;                        } catch (_: IllegalStateException) {&#10;                            FirebaseApp.initializeApp(this, opts, &quot;importer&quot;)&#10;                        }&#10;                    } else {&#10;                        null&#10;                    }&#10;&#10;                    val authImporter = if (importerApp != null) FirebaseAuth.getInstance(importerApp) else FirebaseAuth.getInstance()&#10;&#10;                    if (password.isNotEmpty()) {&#10;                        // Crear usuario en Auth (en la app importadora si fue posible)&#10;                        authImporter.createUserWithEmailAndPassword(email, password)&#10;                            .addOnSuccessListener { result -&gt;&#10;                                val uid = result.user?.uid&#10;                                val data = mapOf(&#10;                                    &quot;name&quot; to name,&#10;                                    &quot;email&quot; to email,&#10;                                    &quot;document&quot; to document,&#10;                                    &quot;phone&quot; to phone,&#10;                                    &quot;role&quot; to role,&#10;                                    &quot;createdAt&quot; to com.google.firebase.Timestamp.now()&#10;                                )&#10;                                val coll = when (role) {&#10;                                    &quot;PADRE&quot; -&gt; &quot;parents&quot;&#10;                                    &quot;DOCENTE&quot; -&gt; &quot;teachers&quot;&#10;                                    &quot;ADMIN&quot; -&gt; &quot;admins&quot;&#10;                                    else -&gt; &quot;students&quot;&#10;                                }&#10;                                // Guardar documento asociado&#10;                                db.collection(coll).document(uid ?: db.collection(coll).document().id)&#10;                                    .set(data)&#10;                                    .addOnSuccessListener {&#10;                                        // Enviar verificación desde authImporter (no afecta admin)&#10;                                        try {&#10;                                            authImporter.currentUser?.sendEmailVerification()&#10;                                        } catch (_: Exception) {}&#10;&#10;                                        // Cerrar sesión en importer para limpiar&#10;                                        try { authImporter.signOut() } catch (_: Exception) {}&#10;&#10;                                        Toast.makeText(this, &quot;Usuario creado correctamente (Auth + Firestore)&quot;, Toast.LENGTH_LONG).show()&#10;                                        finish()&#10;                                    }&#10;                                    .addOnFailureListener { e -&gt;&#10;                                        Toast.makeText(this, &quot;Error guardando documento: ${e.localizedMessage}&quot;, Toast.LENGTH_LONG).show()&#10;                                    }&#10;                            }&#10;                            .addOnFailureListener { e -&gt;&#10;                                if (e is FirebaseAuthUserCollisionException) {&#10;                                    Toast.makeText(this, &quot;El correo ya está registrado.&quot;, Toast.LENGTH_LONG).show()&#10;                                } else {&#10;                                    Toast.makeText(this, &quot;Error creando usuario en Auth: ${e.localizedMessage}&quot;, Toast.LENGTH_LONG).show()&#10;                                }&#10;                            }&#10;                    } else {&#10;                        // Si no se especifica contraseña, encolamos la petición para backend (auth_queue)&#10;                        val queueData = mapOf(&#10;                            &quot;email&quot; to email,&#10;                            &quot;role&quot; to role,&#10;                            &quot;displayName&quot; to name,&#10;                            &quot;requestedAt&quot; to com.google.firebase.Timestamp.now()&#10;                        )&#10;                        val coll = when (role) {&#10;                            &quot;PADRE&quot; -&gt; &quot;parents&quot;&#10;                            &quot;DOCENTE&quot; -&gt; &quot;teachers&quot;&#10;                            &quot;ADMIN&quot; -&gt; &quot;admins&quot;&#10;                            else -&gt; &quot;students&quot;&#10;                        }&#10;                        db.collection(coll).add(mapOf(&#10;                            &quot;name&quot; to name,&#10;                            &quot;email&quot; to email,&#10;                            &quot;document&quot; to document,&#10;                            &quot;phone&quot; to phone,&#10;                            &quot;role&quot; to role,&#10;                            &quot;createdAt&quot; to com.google.firebase.Timestamp.now()&#10;                        )).addOnSuccessListener {&#10;                            db.collection(&quot;auth_queue&quot;).add(queueData)&#10;                                .addOnSuccessListener {&#10;                                    Toast.makeText(this, &quot;Usuario creado en Firestore y encolado para Auth (backend)&quot;, Toast.LENGTH_LONG).show()&#10;                                    finish()&#10;                                }&#10;                                .addOnFailureListener { e -&gt;&#10;                                    Toast.makeText(this, &quot;Error encolando para Auth: ${e.localizedMessage}&quot;, Toast.LENGTH_LONG).show()&#10;                                }&#10;                        }.addOnFailureListener { e -&gt;&#10;                            Toast.makeText(this, &quot;Error guardando documento: ${e.localizedMessage}&quot;, Toast.LENGTH_LONG).show()&#10;                        }&#10;                    }&#10;&#10;                } catch (e: Exception) {&#10;                    Toast.makeText(this, &quot;Error inicializando importador Auth: ${e.localizedMessage}&quot;, Toast.LENGTH_LONG).show()&#10;                }&#10;&#10;            } else {&#10;                // Flujo normal: registrar en FirebaseAuth y crear documento en Firestore luego cerrar sesión y volver al login&#10;                auth.createUserWithEmailAndPassword(email, password)&#10;                    .addOnSuccessListener { result -&gt;&#10;                        val uid = result.user?.uid ?: return@addOnSuccessListener&#10;                        val data = mapOf(&#10;                            &quot;name&quot; to name,&#10;                            &quot;email&quot; to email,&#10;                            &quot;document&quot; to document,&#10;                            &quot;phone&quot; to phone,&#10;                            &quot;role&quot; to role&#10;                        )&#10;                        db.collection(&quot;users&quot;).document(uid).set(data)&#10;                            .addOnCompleteListener {&#10;                                // Mantener comportamiento previo: desloguear y volver al login&#10;                                auth.signOut()&#10;                                Toast.makeText(this, &quot;Cuenta creada. Inicia sesión.&quot;, Toast.LENGTH_LONG).show()&#10;                                startActivity(Intent(this, LoginActivity::class.java))&#10;                                finish()&#10;                            }&#10;                    }&#10;                    .addOnFailureListener { e -&gt;&#10;                        Toast.makeText(this, &quot;Error: ${e.localizedMessage}&quot;, Toast.LENGTH_LONG).show()&#10;                    }&#10;            }&#10;        }&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.appcolegios.auth&#10;&#10;import android.content.Intent&#10;import android.graphics.Color&#10;import android.os.Bundle&#10;import android.view.View&#10;import android.view.ViewGroup&#10;import android.widget.ArrayAdapter&#10;import android.widget.EditText&#10;import android.widget.Spinner&#10;import android.widget.TextView&#10;import android.widget.Toast&#10;import androidx.appcompat.app.AppCompatActivity&#10;import com.example.appcolegios.R&#10;import com.google.firebase.auth.FirebaseAuth&#10;import com.google.firebase.auth.FirebaseAuthUserCollisionException&#10;import com.google.firebase.FirebaseApp&#10;import com.google.firebase.FirebaseOptions&#10;import com.google.firebase.firestore.FirebaseFirestore&#10;import com.google.android.material.button.MaterialButton&#10;import java.util.Locale&#10;&#10;class RegisterActivity : AppCompatActivity() {&#10;    private lateinit var auth: FirebaseAuth&#10;    private lateinit var db: FirebaseFirestore&#10;&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        super.onCreate(savedInstanceState)&#10;        setContentView(R.layout.activity_register)&#10;        auth = FirebaseAuth.getInstance()&#10;        db = FirebaseFirestore.getInstance()&#10;&#10;        val fromAdmin = intent.getBooleanExtra(&quot;fromAdmin&quot;, false)&#10;&#10;        val nameInput: EditText = findViewById(R.id.nameInput)&#10;        val emailInput: EditText = findViewById(R.id.emailInput)&#10;        val documentInput: EditText = findViewById(R.id.documentInput)&#10;        val phoneInput: EditText = findViewById(R.id.phoneInput)&#10;        val passwordInput: EditText = findViewById(R.id.passwordInput)&#10;        val confirmInput: EditText = findViewById(R.id.confirmPasswordInput)&#10;        val roleSpinner: Spinner = findViewById(R.id.roleSpinner)&#10;        val registerButton: MaterialButton = findViewById(R.id.registerButton)&#10;&#10;        // Si viene de admin permitir seleccionar ADMIN y ocultar campos de contraseña opcionalmente&#10;        val roles = if (fromAdmin) listOf(&quot;ESTUDIANTE&quot;, &quot;PADRE&quot;, &quot;DOCENTE&quot;, &quot;ADMIN&quot;) else listOf(&quot;ESTUDIANTE&quot;, &quot;PADRE&quot;, &quot;DOCENTE&quot;)&#10;&#10;        // Adapter personalizado para forzar color de texto (evita que las letras salgan en blanco en temas oscuros)&#10;        val adapter = object : ArrayAdapter&lt;String&gt;(this, android.R.layout.simple_spinner_item, roles) {&#10;            override fun getView(position: Int, convertView: View?, parent: ViewGroup): View {&#10;                val v = super.getView(position, convertView, parent) as TextView&#10;                v.setTextColor(Color.BLACK)&#10;                return v&#10;            }&#10;&#10;            override fun getDropDownView(position: Int, convertView: View?, parent: ViewGroup): View {&#10;                val v = super.getDropDownView(position, convertView, parent) as TextView&#10;                v.setTextColor(Color.BLACK)&#10;                return v&#10;            }&#10;        }&#10;        adapter.setDropDownViewResource(android.R.layout.simple_spinner_dropdown_item)&#10;        roleSpinner.adapter = adapter&#10;&#10;        // Si es desde admin no mostramos la confirmación de contraseña y password puede ser opcional&#10;        if (fromAdmin) {&#10;            // No ocultar los campos para que no parezcan &quot;no funcionales&quot;.&#10;            // Sólo avisamos con el hint de que la contraseña no se almacenará en este modo.&#10;            passwordInput.hint = &quot;Opcional (si se deja vacío se encola para backend)&quot;&#10;            confirmInput.hint = &quot;Opcional&quot;&#10;        }&#10;&#10;        registerButton.setOnClickListener {&#10;            val name = nameInput.text.toString().trim()&#10;            val email = emailInput.text.toString().trim()&#10;            val document = documentInput.text.toString().trim()&#10;            val phone = phoneInput.text.toString().trim()&#10;            val password = passwordInput.text.toString().trim()&#10;            val confirm = confirmInput.text.toString().trim()&#10;            // Obtener rol seleccionado y normalizar a mayúsculas; si está vacío, asumir ADMIN&#10;            val rawRole = roles.getOrNull(roleSpinner.selectedItemPosition)&#10;            val role = rawRole?.uppercase(Locale.ROOT) ?: &quot;ADMIN&quot;&#10;&#10;            if (name.isEmpty() || email.isEmpty() || document.isEmpty() || phone.isEmpty() || (!fromAdmin &amp;&amp; (password.isEmpty() || confirm.isEmpty()))) {&#10;                Toast.makeText(this, &quot;Todos los campos son obligatorios&quot;, Toast.LENGTH_SHORT).show()&#10;                return@setOnClickListener&#10;            }&#10;            if (!fromAdmin &amp;&amp; (password.length &lt; 6 || password != confirm)) {&#10;                Toast.makeText(this, &quot;Contraseñas inválidas&quot;, Toast.LENGTH_SHORT).show()&#10;                return@setOnClickListener&#10;            }&#10;&#10;            if (fromAdmin) {&#10;                // Intentamos crear la cuenta en Firebase Auth usando una FirebaseApp secundaria&#10;                // para no afectar la sesión del admin.&#10;                try {&#10;                    val opts = FirebaseOptions.fromResource(this)&#10;                    val importerApp = if (opts != null) {&#10;                        try {&#10;                            FirebaseApp.getInstance(&quot;importer&quot;)&#10;                        } catch (_: IllegalStateException) {&#10;                            FirebaseApp.initializeApp(this, opts, &quot;importer&quot;)&#10;                        }&#10;                    } else {&#10;                        null&#10;                    }&#10;&#10;                    val authImporter = if (importerApp != null) FirebaseAuth.getInstance(importerApp) else FirebaseAuth.getInstance()&#10;&#10;                    if (password.isNotEmpty()) {&#10;                        // Crear usuario en Auth (en la app importadora si fue posible)&#10;                        authImporter.createUserWithEmailAndPassword(email, password)&#10;                            .addOnSuccessListener { result -&gt;&#10;                                val uid = result.user?.uid&#10;                                val data = mapOf(&#10;                                    &quot;name&quot; to name,&#10;                                    &quot;email&quot; to email,&#10;                                    &quot;document&quot; to document,&#10;                                    &quot;phone&quot; to phone,&#10;                                    &quot;role&quot; to role,&#10;                                    &quot;createdAt&quot; to com.google.firebase.Timestamp.now()&#10;                                )&#10;                                val coll = when (role) {&#10;                                    &quot;PADRE&quot; -&gt; &quot;parents&quot;&#10;                                    &quot;DOCENTE&quot; -&gt; &quot;teachers&quot;&#10;                                    &quot;ADMIN&quot; -&gt; &quot;admins&quot;&#10;                                    else -&gt; &quot;students&quot;&#10;                                }&#10;                                // Guardar documento asociado&#10;                                db.collection(coll).document(uid ?: db.collection(coll).document().id)&#10;                                    .set(data)&#10;                                    .addOnSuccessListener {&#10;                                        // Enviar verificación desde authImporter (no afecta admin)&#10;                                        try {&#10;                                            authImporter.currentUser?.sendEmailVerification()&#10;                                        } catch (_: Exception) {}&#10;&#10;                                        // Crear también documento en 'users' para que la app reconozca el rol y email&#10;                                        try {&#10;                                            val userMap = mapOf(&#10;                                                &quot;displayName&quot; to name,&#10;                                                &quot;email&quot; to email,&#10;                                                &quot;role&quot; to role&#10;                                            )&#10;                                            db.collection(&quot;users&quot;).document(uid ?: db.collection(&quot;users&quot;).document().id)&#10;                                                .set(userMap)&#10;                                        } catch (_: Exception) {}&#10;&#10;                                        // Cerrar sesión en importer para limpiar&#10;                                        try { authImporter.signOut() } catch (_: Exception) {}&#10;&#10;                                        Toast.makeText(this, &quot;Usuario creado correctamente (Auth + Firestore)&quot;, Toast.LENGTH_LONG).show()&#10;                                        finish()&#10;                                    }&#10;                                    .addOnFailureListener { e -&gt;&#10;                                        Toast.makeText(this, &quot;Error guardando documento: ${e.localizedMessage}&quot;, Toast.LENGTH_LONG).show()&#10;                                    }&#10;                            }&#10;                            .addOnFailureListener { e -&gt;&#10;                                if (e is FirebaseAuthUserCollisionException) {&#10;                                    Toast.makeText(this, &quot;El correo ya está registrado.&quot;, Toast.LENGTH_LONG).show()&#10;                                } else {&#10;                                    Toast.makeText(this, &quot;Error creando usuario en Auth: ${e.localizedMessage}&quot;, Toast.LENGTH_LONG).show()&#10;                                }&#10;                            }&#10;                    } else {&#10;                        // Si no se especifica contraseña, encolamos la petición para backend (auth_queue)&#10;                        val queueData = mapOf(&#10;                            &quot;email&quot; to email,&#10;                            &quot;role&quot; to role,&#10;                            &quot;displayName&quot; to name,&#10;                            &quot;requestedAt&quot; to com.google.firebase.Timestamp.now()&#10;                        )&#10;                        val coll = when (role) {&#10;                            &quot;PADRE&quot; -&gt; &quot;parents&quot;&#10;                            &quot;DOCENTE&quot; -&gt; &quot;teachers&quot;&#10;                            &quot;ADMIN&quot; -&gt; &quot;admins&quot;&#10;                            else -&gt; &quot;students&quot;&#10;                        }&#10;                        db.collection(coll).add(mapOf(&#10;                            &quot;name&quot; to name,&#10;                            &quot;email&quot; to email,&#10;                            &quot;document&quot; to document,&#10;                            &quot;phone&quot; to phone,&#10;                            &quot;role&quot; to role,&#10;                            &quot;createdAt&quot; to com.google.firebase.Timestamp.now()&#10;                        )).addOnSuccessListener {&#10;                            db.collection(&quot;auth_queue&quot;).add(queueData)&#10;                                .addOnSuccessListener {&#10;                                    // Crear también doc en 'users' para que la app conozca el correo/rol&#10;                                    try {&#10;                                        val userMap = mapOf(&#10;                                            &quot;displayName&quot; to name,&#10;                                            &quot;email&quot; to email,&#10;                                            &quot;role&quot; to role,&#10;                                            &quot;importedAt&quot; to com.google.firebase.Timestamp.now()&#10;                                        )&#10;                                        db.collection(&quot;users&quot;).add(userMap)&#10;                                    } catch (_: Exception) {}&#10;&#10;                                    Toast.makeText(this, &quot;Usuario creado en Firestore y encolado para Auth (backend)&quot;, Toast.LENGTH_LONG).show()&#10;                                    finish()&#10;                                }&#10;                                .addOnFailureListener { e -&gt;&#10;                                    Toast.makeText(this, &quot;Error encolando para Auth: ${e.localizedMessage}&quot;, Toast.LENGTH_LONG).show()&#10;                                }&#10;                        }.addOnFailureListener { e -&gt;&#10;                            Toast.makeText(this, &quot;Error guardando documento: ${e.localizedMessage}&quot;, Toast.LENGTH_LONG).show()&#10;                        }&#10;                    }&#10;&#10;                } catch (e: Exception) {&#10;                    Toast.makeText(this, &quot;Error inicializando importador Auth: ${e.localizedMessage}&quot;, Toast.LENGTH_LONG).show()&#10;                }&#10;&#10;            } else {&#10;                // Flujo normal: registrar en FirebaseAuth y crear documento en Firestore luego cerrar sesión y volver al login&#10;                auth.createUserWithEmailAndPassword(email, password)&#10;                    .addOnSuccessListener { result -&gt;&#10;                        val uid = result.user?.uid ?: return@addOnSuccessListener&#10;                        val data = mapOf(&#10;                            &quot;name&quot; to name,&#10;                            &quot;email&quot; to email,&#10;                            &quot;document&quot; to document,&#10;                            &quot;phone&quot; to phone,&#10;                            &quot;role&quot; to role&#10;                        )&#10;                        db.collection(&quot;users&quot;).document(uid).set(data)&#10;                            .addOnCompleteListener {&#10;                                // Mantener comportamiento previo: desloguear y volver al login&#10;                                auth.signOut()&#10;                                Toast.makeText(this, &quot;Cuenta creada. Inicia sesión.&quot;, Toast.LENGTH_LONG).show()&#10;                                startActivity(Intent(this, LoginActivity::class.java))&#10;                                finish()&#10;                            }&#10;                    }&#10;                    .addOnFailureListener { e -&gt;&#10;                        Toast.makeText(this, &quot;Error: ${e.localizedMessage}&quot;, Toast.LENGTH_LONG).show()&#10;                    }&#10;            }&#10;        }&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/auth/SplashActivity.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/auth/SplashActivity.kt" />
              <option name="updatedContent" value="package com.example.appcolegios.auth&#10;&#10;import android.content.Intent&#10;import android.os.Bundle&#10;import android.os.Handler&#10;import android.os.Looper&#10;import android.view.animation.Animation&#10;import android.view.animation.AnimationUtils&#10;import android.widget.ImageView&#10;import androidx.appcompat.app.AppCompatActivity&#10;import com.example.appcolegios.R&#10;&#10;class SplashActivity : AppCompatActivity() {&#10;&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        super.onCreate(savedInstanceState)&#10;        setContentView(R.layout.activity_splash)&#10;&#10;        // Animación de fade in para el logo&#10;        val logoView: ImageView = findViewById(R.id.splashLogo)&#10;        val fadeIn: Animation = AnimationUtils.loadAnimation(this, R.anim.fade_in)&#10;        logoView.startAnimation(fadeIn)&#10;&#10;        // Al terminar la animación, iniciar LoginActivity&#10;        fadeIn.setAnimationListener(object : Animation.AnimationListener {&#10;            override fun onAnimationStart(animation: Animation) {}&#10;            override fun onAnimationRepeat(animation: Animation) {}&#10;            override fun onAnimationEnd(animation: Animation) {&#10;                // Retardo breve antes de iniciar&#10;                Handler(Looper.getMainLooper()).postDelayed({&#10;                    startActivity(Intent(this@SplashActivity, com.example.appcolegios.auth.LoginActivity::class.java))&#10;                    finish()&#10;                }, 300)&#10;            }&#10;        })&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/data/UserPreferencesRepository.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/data/UserPreferencesRepository.kt" />
              <option name="originalContent" value="package com.example.appcolegios.data&#10;&#10;import android.content.Context&#10;import androidx.datastore.core.DataStore&#10;import androidx.datastore.preferences.core.Preferences&#10;import androidx.datastore.preferences.core.edit&#10;import androidx.datastore.preferences.core.stringPreferencesKey&#10;import androidx.datastore.preferences.preferencesDataStore&#10;import com.example.appcolegios.data.model.Role&#10;import kotlinx.coroutines.flow.Flow&#10;import kotlinx.coroutines.flow.map&#10;&#10;private val Context.dataStore: DataStore&lt;Preferences&gt; by preferencesDataStore(name = &quot;user_prefs&quot;)&#10;&#10;class UserPreferencesRepository(context: Context) {&#10;&#10;    private val dataStore = context.dataStore&#10;&#10;    private object PreferencesKeys {&#10;        val USER_ID = stringPreferencesKey(&quot;user_id&quot;)&#10;        val USER_ROLE = stringPreferencesKey(&quot;user_role&quot;)&#10;        val USER_NAME = stringPreferencesKey(&quot;user_name&quot;)&#10;    }&#10;&#10;    val userData: Flow&lt;UserData&gt; = dataStore.data&#10;        .map { preferences -&gt;&#10;            UserData(&#10;                userId = preferences[PreferencesKeys.USER_ID],&#10;                role = preferences[PreferencesKeys.USER_ROLE],&#10;                name = preferences[PreferencesKeys.USER_NAME]&#10;            )&#10;        }&#10;&#10;    // Actualiza userId, role y displayName&#10;    suspend fun updateUserData(userId: String?, role: String?, name: String?) {&#10;        dataStore.edit { preferences -&gt;&#10;            if (userId == null) {&#10;                preferences.remove(PreferencesKeys.USER_ID)&#10;            } else {&#10;                preferences[PreferencesKeys.USER_ID] = userId&#10;            }&#10;            if (role == null) {&#10;                preferences.remove(PreferencesKeys.USER_ROLE)&#10;            } else {&#10;                preferences[PreferencesKeys.USER_ROLE] = role&#10;            }&#10;            if (name == null) {&#10;                preferences.remove(PreferencesKeys.USER_NAME)&#10;            } else {&#10;                preferences[PreferencesKeys.USER_NAME] = name&#10;            }&#10;        }&#10;    }&#10;&#10;    // Limpia todos los datos del usuario al cerrar sesión&#10;    suspend fun clearUserData() {&#10;        dataStore.edit { preferences -&gt;&#10;            preferences.clear()&#10;        }&#10;    }&#10;}&#10;&#10;data class UserData(&#10;    val userId: String?,&#10;    val role: String?, // mantener string para compatibilidad; usar helper de conversión&#10;    val name: String?&#10;) {&#10;    // Si no hay rol (null o vacío) o la cadena no coincide, asumimos ADMIN&#10;    val roleEnum: Role? get() = when {&#10;        role.isNullOrBlank() -&gt; Role.ADMIN&#10;        else -&gt; Role.fromString(role) ?: Role.ADMIN&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.appcolegios.data&#13;&#10;&#13;&#10;import android.content.Context&#13;&#10;import androidx.datastore.core.DataStore&#13;&#10;import androidx.datastore.preferences.core.Preferences&#13;&#10;import androidx.datastore.preferences.core.edit&#13;&#10;import androidx.datastore.preferences.core.stringPreferencesKey&#13;&#10;import androidx.datastore.preferences.preferencesDataStore&#13;&#10;import com.example.appcolegios.data.model.Role&#13;&#10;import kotlinx.coroutines.flow.Flow&#13;&#10;import kotlinx.coroutines.flow.map&#13;&#10;&#13;&#10;private val Context.dataStore: DataStore&lt;Preferences&gt; by preferencesDataStore(name = &quot;user_prefs&quot;)&#13;&#10;&#13;&#10;class UserPreferencesRepository(context: Context) {&#13;&#10;&#13;&#10;    private val dataStore = context.dataStore&#13;&#10;&#13;&#10;    private object PreferencesKeys {&#13;&#10;        val USER_ID = stringPreferencesKey(&quot;user_id&quot;)&#13;&#10;        val USER_ROLE = stringPreferencesKey(&quot;user_role&quot;)&#13;&#10;        val USER_NAME = stringPreferencesKey(&quot;user_name&quot;)&#13;&#10;    }&#13;&#10;&#13;&#10;    val userData: Flow&lt;UserData&gt; = dataStore.data&#13;&#10;        .map { preferences -&gt;&#13;&#10;            UserData(&#13;&#10;                userId = preferences[PreferencesKeys.USER_ID],&#13;&#10;                role = preferences[PreferencesKeys.USER_ROLE],&#13;&#10;                name = preferences[PreferencesKeys.USER_NAME]&#13;&#10;            )&#13;&#10;        }&#13;&#10;&#13;&#10;    // Actualiza userId, role y displayName&#13;&#10;    suspend fun updateUserData(userId: String?, role: String?, name: String?) {&#13;&#10;        dataStore.edit { preferences -&gt;&#13;&#10;            if (userId == null) {&#13;&#10;                preferences.remove(PreferencesKeys.USER_ID)&#13;&#10;            } else {&#13;&#10;                preferences[PreferencesKeys.USER_ID] = userId&#13;&#10;            }&#13;&#10;            if (role == null) {&#13;&#10;                preferences.remove(PreferencesKeys.USER_ROLE)&#13;&#10;            } else {&#13;&#10;                preferences[PreferencesKeys.USER_ROLE] = role&#13;&#10;            }&#13;&#10;            if (name == null) {&#13;&#10;                preferences.remove(PreferencesKeys.USER_NAME)&#13;&#10;            } else {&#13;&#10;                preferences[PreferencesKeys.USER_NAME] = name&#13;&#10;            }&#13;&#10;        }&#13;&#10;    }&#13;&#10;&#13;&#10;    // Limpia todos los datos del usuario al cerrar sesión&#13;&#10;    suspend fun clearUserData() {&#13;&#10;        dataStore.edit { preferences -&gt;&#13;&#10;            preferences.clear()&#13;&#10;        }&#13;&#10;    }&#13;&#10;}&#13;&#10;&#13;&#10;data class UserData(&#13;&#10;    val userId: String?,&#13;&#10;    val role: String?, // mantener string para compatibilidad; usar helper de conversión&#13;&#10;    val name: String?&#13;&#10;) {&#13;&#10;    // Si no hay rol (null o vacío) retornamos null para evitar asumir ADMIN por defecto&#13;&#10;    val roleEnum: Role? get() = when {&#13;&#10;        role.isNullOrBlank() -&gt; null&#13;&#10;        else -&gt; Role.fromString(role)&#13;&#10;    }&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/data/model/Models.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/data/model/Models.kt" />
              <option name="originalContent" value="@file:Suppress(&quot;unused&quot;) // Suprime warnings de modelos aún no referenciados (Guardian, enums y constantes) conservándolos para futuras funcionalidades&#10;&#10;package com.example.appcolegios.data.model&#10;&#10;import com.google.firebase.firestore.DocumentId&#10;import java.util.Date&#10;&#10;data class Student(&#10;    val id: String,&#10;    val nombre: String,&#10;    val curso: String,&#10;    val grupo: String,&#10;    val numeroLista: Int,&#10;    val correoInstitucional: String,&#10;    val eps: String,&#10;    val estadoMatricula: String,&#10;    val promedio: Double,&#10;    val avatarUrl: String? = null&#10;)&#10;&#10;data class Guardian(&#10;    val id: String,&#10;    val nombre: String,&#10;    val telefono: String,&#10;    val parentesco: String&#10;)&#10;&#10;data class Grade(&#10;    val materiaId: String,&#10;    val materia: String,&#10;    val periodo: Int,&#10;    val calificacion: Double,&#10;    val ponderacion: Double&#10;)&#10;&#10;data class AttendanceEntry(&#10;    val fecha: Date,&#10;    val estado: AttendanceStatus&#10;)&#10;&#10;enum class AttendanceStatus {&#10;    PRESENTE, AUSENTE, TARDE&#10;}&#10;&#10;data class Homework(&#10;    val id: String,&#10;    val materia: String,&#10;    val titulo: String,&#10;    val descripcion: String,&#10;    val deadline: Date,&#10;    val progreso: Float,&#10;    val completada: Boolean&#10;)&#10;&#10;data class Notification(&#10;    @DocumentId val id: String = &quot;&quot;,&#10;    val titulo: String = &quot;&quot;,&#10;    val cuerpo: String = &quot;&quot;,&#10;    val remitente: String = &quot;&quot;,&#10;    val fechaHora: Date = Date(0),&#10;    val avatarUrl: String? = null,&#10;    val leida: Boolean = false&#10;)&#10;&#10;data class Message(&#10;    val id: String = &quot;&quot;,&#10;    val fromId: String = &quot;&quot;,&#10;    val toId: String = &quot;&quot;,&#10;    val texto: String = &quot;&quot;,&#10;    val fechaHora: Date = Date(0),&#10;    val tipo: MessageType = MessageType.TEXTO,&#10;    val estado: MessageStatus = MessageStatus.ENVIADO&#10;)&#10;&#10;enum class MessageType {&#10;    TEXTO, IMAGEN&#10;}&#10;&#10;enum class MessageStatus {&#10;    ENVIADO, ENTREGADO, LEIDO&#10;}&#10;&#10;data class Event(&#10;    val id: String,&#10;    val titulo: String,&#10;    val fechaHora: Date,&#10;    val categoria: EventCategory,&#10;    val descripcion: String,&#10;    val icon: String? = null&#10;)&#10;&#10;enum class EventCategory {&#10;    ACADEMICO, ADMINISTRATIVO&#10;}&#10;&#10;enum class TransportMode {&#10;    A_PIE, BICICLETA, PUBLICO, PARTICULAR&#10;}&#10;&#10;enum class ArrivalStatus {&#10;    EN_CAMINO, LLEGADO&#10;}&#10;" />
              <option name="updatedContent" value="@file:Suppress(&quot;unused&quot;) // Suprime warnings de modelos aún no referenciados (Guardian, enums y constantes) conservándolos para futuras funcionalidades&#13;&#10;&#13;&#10;package com.example.appcolegios.data.model&#13;&#10;&#13;&#10;import com.google.firebase.firestore.DocumentId&#13;&#10;import java.util.Date&#13;&#10;&#13;&#10;data class Student(&#13;&#10;    val id: String = &quot;&quot;,&#13;&#10;    val nombre: String = &quot;&quot;,&#13;&#10;    val curso: String = &quot;&quot;,&#13;&#10;    val grupo: String = &quot;&quot;,&#13;&#10;    val numeroLista: Int = 0,&#13;&#10;    val correoInstitucional: String = &quot;&quot;,&#13;&#10;    val eps: String = &quot;&quot;,&#13;&#10;    val estadoMatricula: String = &quot;&quot;,&#13;&#10;    val promedio: Double = 0.0,&#13;&#10;    val avatarUrl: String? = null&#13;&#10;)&#13;&#10;&#13;&#10;data class Guardian(&#13;&#10;    val id: String,&#13;&#10;    val nombre: String,&#13;&#10;    val telefono: String,&#13;&#10;    val parentesco: String&#13;&#10;)&#13;&#10;&#13;&#10;data class Grade(&#13;&#10;    val materiaId: String,&#13;&#10;    val materia: String,&#13;&#10;    val periodo: Int,&#13;&#10;    val calificacion: Double,&#13;&#10;    val ponderacion: Double&#13;&#10;)&#13;&#10;&#13;&#10;data class AttendanceEntry(&#13;&#10;    val fecha: Date,&#13;&#10;    val estado: AttendanceStatus&#13;&#10;)&#13;&#10;&#13;&#10;enum class AttendanceStatus {&#13;&#10;    PRESENTE, AUSENTE, TARDE&#13;&#10;}&#13;&#10;&#13;&#10;data class Homework(&#13;&#10;    val id: String,&#13;&#10;    val materia: String,&#13;&#10;    val titulo: String,&#13;&#10;    val descripcion: String,&#13;&#10;    val deadline: Date,&#13;&#10;    val progreso: Float,&#13;&#10;    val completada: Boolean&#13;&#10;)&#13;&#10;&#13;&#10;data class Notification(&#13;&#10;    @DocumentId val id: String = &quot;&quot;,&#13;&#10;    val titulo: String = &quot;&quot;,&#13;&#10;    val cuerpo: String = &quot;&quot;,&#13;&#10;    val remitente: String = &quot;&quot;,&#13;&#10;    val fechaHora: Date = Date(0),&#13;&#10;    val avatarUrl: String? = null,&#13;&#10;    val leida: Boolean = false&#13;&#10;)&#13;&#10;&#13;&#10;data class Message(&#13;&#10;    val id: String = &quot;&quot;,&#13;&#10;    val fromId: String = &quot;&quot;,&#13;&#10;    val toId: String = &quot;&quot;,&#13;&#10;    val texto: String = &quot;&quot;,&#13;&#10;    val fechaHora: Date = Date(0),&#13;&#10;    val tipo: MessageType = MessageType.TEXTO,&#13;&#10;    val estado: MessageStatus = MessageStatus.ENVIADO&#13;&#10;)&#13;&#10;&#13;&#10;enum class MessageType {&#13;&#10;    TEXTO, IMAGEN&#13;&#10;}&#13;&#10;&#13;&#10;enum class MessageStatus {&#13;&#10;    ENVIADO, ENTREGADO, LEIDO&#13;&#10;}&#13;&#10;&#13;&#10;data class Event(&#13;&#10;    val id: String,&#13;&#10;    val titulo: String,&#13;&#10;    val fechaHora: Date,&#13;&#10;    val categoria: EventCategory,&#13;&#10;    val descripcion: String,&#13;&#10;    val icon: String? = null&#13;&#10;)&#13;&#10;&#13;&#10;enum class EventCategory {&#13;&#10;    ACADEMICO, ADMINISTRATIVO&#13;&#10;}&#13;&#10;&#13;&#10;enum class TransportMode {&#13;&#10;    A_PIE, BICICLETA, PUBLICO, PARTICULAR&#13;&#10;}&#13;&#10;&#13;&#10;enum class ArrivalStatus {&#13;&#10;    EN_CAMINO, LLEGADO&#13;&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/ui/AnimatedMaterialButton.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/ui/AnimatedMaterialButton.kt" />
              <option name="updatedContent" value="package com.example.appcolegios.ui&#10;&#10;import android.content.Context&#10;import android.util.AttributeSet&#10;import android.view.MotionEvent&#10;import com.google.android.material.button.MaterialButton&#10;&#10;class AnimatedMaterialButton @JvmOverloads constructor(&#10;    context: Context,&#10;    attrs: AttributeSet? = null,&#10;    defStyleAttr: Int = com.google.android.material.R.attr.materialButtonStyle&#10;) : MaterialButton(context, attrs, defStyleAttr) {&#10;&#10;    override fun onTouchEvent(event: MotionEvent): Boolean {&#10;        when (event.action) {&#10;            MotionEvent.ACTION_DOWN -&gt; {&#10;                this.animate().scaleX(0.97f).scaleY(0.97f).setDuration(50).start()&#10;            }&#10;            MotionEvent.ACTION_UP, MotionEvent.ACTION_CANCEL -&gt; {&#10;                this.animate().scaleX(1f).scaleY(1f).setDuration(50).start()&#10;            }&#10;        }&#10;        return super.onTouchEvent(event)&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/anim/fade_in.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/anim/fade_in.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;alpha xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:duration=&quot;300&quot;&#10;    android:fromAlpha=&quot;0.0&quot;&#10;    android:toAlpha=&quot;1.0&quot; /&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/layout/activity_attendance.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/layout/activity_attendance.xml" />
              <option name="originalContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;&#10;    android:orientation=&quot;vertical&quot;&#10;    android:layout_width=&quot;match_parent&quot;&#10;    android:layout_height=&quot;match_parent&quot;&#10;    android:background=&quot;@color/background&quot;&gt;&#10;&#10;    &lt;!-- Toolbar/Header --&gt;&#10;    &lt;com.google.android.material.appbar.AppBarLayout&#10;        android:layout_width=&quot;match_parent&quot;&#10;        android:layout_height=&quot;wrap_content&quot;&#10;        android:background=&quot;@color/primary&quot;&gt;&#10;&#10;        &lt;androidx.appcompat.widget.Toolbar&#10;            android:id=&quot;@+id/toolbar&quot;&#10;            android:layout_width=&quot;match_parent&quot;&#10;            android:layout_height=&quot;?attr/actionBarSize&quot;&#10;            android:background=&quot;@color/primary&quot;&#10;            app:title=&quot;@string/attendance&quot;&#10;            app:titleTextColor=&quot;@color/on_primary&quot; /&gt;&#10;&#10;    &lt;/com.google.android.material.appbar.AppBarLayout&gt;&#10;&#10;    &lt;!-- Card con resumen de asistencia --&gt;&#10;    &lt;com.google.android.material.card.MaterialCardView&#10;        android:layout_width=&quot;match_parent&quot;&#10;        android:layout_height=&quot;wrap_content&quot;&#10;        android:layout_margin=&quot;16dp&quot;&#10;        app:cardBackgroundColor=&quot;@color/surface&quot;&#10;        app:cardElevation=&quot;4dp&quot;&#10;        app:cardCornerRadius=&quot;16dp&quot;&gt;&#10;&#10;        &lt;LinearLayout&#10;            android:orientation=&quot;vertical&quot;&#10;            android:layout_width=&quot;match_parent&quot;&#10;            android:layout_height=&quot;wrap_content&quot;&#10;            android:padding=&quot;16dp&quot;&gt;&#10;&#10;            &lt;TextView&#10;                android:layout_width=&quot;wrap_content&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:text=&quot;Porcentaje de asistencia&quot;&#10;                android:textSize=&quot;16sp&quot;&#10;                android:textColor=&quot;@color/on_surface_variant&quot; /&gt;&#10;&#10;            &lt;TextView&#10;                android:id=&quot;@+id/attendancePercentageText&quot;&#10;                android:layout_width=&quot;wrap_content&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:text=&quot;95%&quot;&#10;                android:textSize=&quot;32sp&quot;&#10;                android:textStyle=&quot;bold&quot;&#10;                android:textColor=&quot;@color/primary&quot;&#10;                android:layout_marginTop=&quot;8dp&quot; /&gt;&#10;&#10;            &lt;!-- Leyenda --&gt;&#10;            &lt;LinearLayout&#10;                android:orientation=&quot;horizontal&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginTop=&quot;16dp&quot;&gt;&#10;&#10;                &lt;TextView&#10;                    android:layout_width=&quot;wrap_content&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:text=&quot;✅ Presente&quot;&#10;                    android:textSize=&quot;14sp&quot;&#10;                    android:layout_marginEnd=&quot;16dp&quot; /&gt;&#10;&#10;                &lt;TextView&#10;                    android:layout_width=&quot;wrap_content&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:text=&quot;❌ Ausente&quot;&#10;                    android:textSize=&quot;14sp&quot;&#10;                    android:layout_marginEnd=&quot;16dp&quot; /&gt;&#10;&#10;                &lt;TextView&#10;                    android:layout_width=&quot;wrap_content&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:text=&quot;⚠️ Tarde&quot;&#10;                    android:textSize=&quot;14sp&quot; /&gt;&#10;&#10;            &lt;/LinearLayout&gt;&#10;&#10;        &lt;/LinearLayout&gt;&#10;&#10;    &lt;/com.google.android.material.card.MaterialCardView&gt;&#10;&#10;    &lt;!-- Selector de mes --&gt;&#10;    &lt;LinearLayout&#10;        android:orientation=&quot;horizontal&quot;&#10;        android:layout_width=&quot;match_parent&quot;&#10;        android:layout_height=&quot;wrap_content&quot;&#10;        android:gravity=&quot;center&quot;&#10;        android:padding=&quot;8dp&quot;&gt;&#10;&#10;        &lt;com.google.android.material.button.MaterialButton&#10;            android:id=&quot;@+id/previousMonthButton&quot;&#10;            android:layout_width=&quot;wrap_content&quot;&#10;            android:layout_height=&quot;wrap_content&quot;&#10;            android:text=&quot;◀&quot;&#10;            style=&quot;@style/Widget.Material3.Button.TextButton&quot; /&gt;&#10;&#10;        &lt;TextView&#10;            android:id=&quot;@+id/currentMonthText&quot;&#10;            android:layout_width=&quot;0dp&quot;&#10;            android:layout_height=&quot;wrap_content&quot;&#10;            android:layout_weight=&quot;1&quot;&#10;            android:text=&quot;Octubre 2025&quot;&#10;            android:textSize=&quot;18sp&quot;&#10;            android:textStyle=&quot;bold&quot;&#10;            android:textColor=&quot;@color/on_background&quot;&#10;            android:gravity=&quot;center&quot; /&gt;&#10;&#10;        &lt;com.google.android.material.button.MaterialButton&#10;            android:id=&quot;@+id/nextMonthButton&quot;&#10;            android:layout_width=&quot;wrap_content&quot;&#10;            android:layout_height=&quot;wrap_content&quot;&#10;            android:text=&quot;▶&quot;&#10;            style=&quot;@style/Widget.Material3.Button.TextButton&quot; /&gt;&#10;&#10;    &lt;/LinearLayout&gt;&#10;&#10;    &lt;!-- RecyclerView para días --&gt;&#10;    &lt;androidx.recyclerview.widget.RecyclerView&#10;        android:id=&quot;@+id/attendanceRecyclerView&quot;&#10;        android:layout_width=&quot;match_parent&quot;&#10;        android:layout_height=&quot;0dp&quot;&#10;        android:layout_weight=&quot;1&quot;&#10;        android:padding=&quot;8dp&quot;&#10;        android:clipToPadding=&quot;false&quot; /&gt;&#10;&#10;    &lt;!-- Progress bar --&gt;&#10;    &lt;ProgressBar&#10;        android:id=&quot;@+id/progressBar&quot;&#10;        android:layout_width=&quot;wrap_content&quot;&#10;        android:layout_height=&quot;wrap_content&quot;&#10;        android:layout_gravity=&quot;center&quot;&#10;        android:visibility=&quot;gone&quot; /&gt;&#10;&#10;&lt;/LinearLayout&gt;&#10;" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#13;&#10;&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#13;&#10;    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;&#13;&#10;    android:orientation=&quot;vertical&quot;&#13;&#10;    android:layout_width=&quot;match_parent&quot;&#13;&#10;    android:layout_height=&quot;match_parent&quot;&#13;&#10;    android:background=&quot;@color/background&quot;&gt;&#13;&#10;&#13;&#10;    &lt;!-- Toolbar/Header --&gt;&#13;&#10;    &lt;com.google.android.material.appbar.AppBarLayout&#13;&#10;        android:layout_width=&quot;match_parent&quot;&#13;&#10;        android:layout_height=&quot;wrap_content&quot;&#13;&#10;        android:background=&quot;@color/primary&quot;&gt;&#13;&#10;&#13;&#10;        &lt;androidx.appcompat.widget.Toolbar&#13;&#10;            android:id=&quot;@+id/toolbar&quot;&#13;&#10;            android:layout_width=&quot;match_parent&quot;&#13;&#10;            android:layout_height=&quot;?attr/actionBarSize&quot;&#13;&#10;            android:background=&quot;@color/primary&quot;&#13;&#10;            app:title=&quot;@string/attendance&quot;&#13;&#10;            app:titleTextColor=&quot;@color/on_primary&quot; /&gt;&#13;&#10;&#13;&#10;    &lt;/com.google.android.material.appbar.AppBarLayout&gt;&#13;&#10;&#13;&#10;    &lt;!-- Card con resumen de asistencia --&gt;&#13;&#10;    &lt;com.google.android.material.card.MaterialCardView&#13;&#10;        android:layout_width=&quot;match_parent&quot;&#13;&#10;        android:layout_height=&quot;wrap_content&quot;&#13;&#10;        android:layout_margin=&quot;16dp&quot;&#13;&#10;        app:cardBackgroundColor=&quot;@color/surface&quot;&#13;&#10;        app:cardElevation=&quot;4dp&quot;&#13;&#10;        app:cardCornerRadius=&quot;16dp&quot;&gt;&#13;&#10;&#13;&#10;        &lt;LinearLayout&#13;&#10;            android:orientation=&quot;vertical&quot;&#13;&#10;            android:layout_width=&quot;match_parent&quot;&#13;&#10;            android:layout_height=&quot;wrap_content&quot;&#13;&#10;            android:padding=&quot;16dp&quot;&gt;&#13;&#10;&#13;&#10;            &lt;TextView&#13;&#10;                android:layout_width=&quot;wrap_content&quot;&#13;&#10;                android:layout_height=&quot;wrap_content&quot;&#13;&#10;                android:text=&quot;Porcentaje de asistencia&quot;&#13;&#10;                android:textSize=&quot;16sp&quot;&#13;&#10;                android:textColor=&quot;@color/on_surface_variant&quot; /&gt;&#13;&#10;&#13;&#10;            &lt;TextView&#13;&#10;                android:id=&quot;@+id/attendancePercentageText&quot;&#13;&#10;                android:layout_width=&quot;wrap_content&quot;&#13;&#10;                android:layout_height=&quot;wrap_content&quot;&#13;&#10;                android:text=&quot;95%&quot;&#13;&#10;                android:textSize=&quot;32sp&quot;&#13;&#10;                android:textStyle=&quot;bold&quot;&#13;&#10;                android:textColor=&quot;@color/primary&quot;&#13;&#10;                android:layout_marginTop=&quot;8dp&quot; /&gt;&#13;&#10;&#13;&#10;            &lt;!-- Leyenda --&gt;&#13;&#10;            &lt;LinearLayout&#13;&#10;                android:orientation=&quot;horizontal&quot;&#13;&#10;                android:layout_width=&quot;match_parent&quot;&#13;&#10;                android:layout_height=&quot;wrap_content&quot;&#13;&#10;                android:layout_marginTop=&quot;16dp&quot;&gt;&#13;&#10;&#13;&#10;                &lt;TextView&#13;&#10;                    android:layout_width=&quot;wrap_content&quot;&#13;&#10;                    android:layout_height=&quot;wrap_content&quot;&#13;&#10;                    android:text=&quot;✅ Presente&quot;&#13;&#10;                    android:textSize=&quot;14sp&quot;&#13;&#10;                    android:layout_marginEnd=&quot;16dp&quot; /&gt;&#13;&#10;&#13;&#10;                &lt;TextView&#13;&#10;                    android:layout_width=&quot;wrap_content&quot;&#13;&#10;                    android:layout_height=&quot;wrap_content&quot;&#13;&#10;                    android:text=&quot;❌ Ausente&quot;&#13;&#10;                    android:textSize=&quot;14sp&quot;&#13;&#10;                    android:layout_marginEnd=&quot;16dp&quot; /&gt;&#13;&#10;&#13;&#10;                &lt;TextView&#13;&#10;                    android:layout_width=&quot;wrap_content&quot;&#13;&#10;                    android:layout_height=&quot;wrap_content&quot;&#13;&#10;                    android:text=&quot;⚠️ Tarde&quot;&#13;&#10;                    android:textSize=&quot;14sp&quot; /&gt;&#13;&#10;&#13;&#10;            &lt;/LinearLayout&gt;&#13;&#10;&#13;&#10;        &lt;/LinearLayout&gt;&#13;&#10;&#13;&#10;    &lt;/com.google.android.material.card.MaterialCardView&gt;&#13;&#10;&#13;&#10;    &lt;!-- Selector de mes --&gt;&#13;&#10;    &lt;LinearLayout&#13;&#10;        android:orientation=&quot;horizontal&quot;&#13;&#10;        android:layout_width=&quot;match_parent&quot;&#13;&#10;        android:layout_height=&quot;wrap_content&quot;&#13;&#10;        android:gravity=&quot;center&quot;&#13;&#10;        android:padding=&quot;8dp&quot;&gt;&#13;&#10;&#13;&#10;        &lt;com.example.appcolegios.ui.AnimatedMaterialButton&#13;&#10;            android:id=&quot;@+id/previousMonthButton&quot;&#13;&#10;            android:layout_width=&quot;wrap_content&quot;&#13;&#10;            android:layout_height=&quot;wrap_content&quot;&#13;&#10;            android:text=&quot;◀&quot;&#13;&#10;            style=&quot;@style/Widget.Material3.Button.TextButton&quot; /&gt;&#13;&#10;&#13;&#10;        &lt;TextView&#13;&#10;            android:id=&quot;@+id/currentMonthText&quot;&#13;&#10;            android:layout_width=&quot;0dp&quot;&#13;&#10;            android:layout_height=&quot;wrap_content&quot;&#13;&#10;            android:layout_weight=&quot;1&quot;&#13;&#10;            android:text=&quot;Octubre 2025&quot;&#13;&#10;            android:textSize=&quot;18sp&quot;&#13;&#10;            android:textStyle=&quot;bold&quot;&#13;&#10;            android:textColor=&quot;@color/on_background&quot;&#13;&#10;            android:gravity=&quot;center&quot; /&gt;&#13;&#10;&#13;&#10;        &lt;com.example.appcolegios.ui.AnimatedMaterialButton&#13;&#10;            android:id=&quot;@+id/nextMonthButton&quot;&#13;&#10;            android:layout_width=&quot;wrap_content&quot;&#13;&#10;            android:layout_height=&quot;wrap_content&quot;&#13;&#10;            android:text=&quot;▶&quot;&#13;&#10;            style=&quot;@style/Widget.Material3.Button.TextButton&quot; /&gt;&#13;&#10;&#13;&#10;    &lt;/LinearLayout&gt;&#13;&#10;&#13;&#10;    &lt;!-- RecyclerView para días --&gt;&#13;&#10;    &lt;androidx.recyclerview.widget.RecyclerView&#13;&#10;        android:id=&quot;@+id/attendanceRecyclerView&quot;&#13;&#10;        android:layout_width=&quot;match_parent&quot;&#13;&#10;        android:layout_height=&quot;0dp&quot;&#13;&#10;        android:layout_weight=&quot;1&quot;&#13;&#10;        android:padding=&quot;8dp&quot;&#13;&#10;        android:clipToPadding=&quot;false&quot; /&gt;&#13;&#10;&#13;&#10;    &lt;!-- Progress bar --&gt;&#13;&#10;    &lt;ProgressBar&#13;&#10;        android:id=&quot;@+id/progressBar&quot;&#13;&#10;        android:layout_width=&quot;wrap_content&quot;&#13;&#10;        android:layout_height=&quot;wrap_content&quot;&#13;&#10;        android:layout_gravity=&quot;center&quot;&#13;&#10;        android:visibility=&quot;gone&quot; /&gt;&#13;&#10;&#13;&#10;&lt;/LinearLayout&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>