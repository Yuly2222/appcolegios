<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/SOLUCION_DEFINITIVA.bat">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SOLUCION_DEFINITIVA.bat" />
              <option name="updatedContent" value="@echo off&#10;echo ==========================================&#10;echo SOLUCION DEFINITIVA - ERROR GRADLE TASKS&#10;echo ==========================================&#10;cd /d &quot;%~dp0&quot;&#10;&#10;echo.&#10;echo Este script resolvera: &quot;Unable to find Gradle tasks to build&quot;&#10;echo.&#10;pause&#10;&#10;echo.&#10;echo [1/8] Cerrando Android Studio si esta abierto...&#10;echo Por favor, CIERRA Android Studio ahora si esta abierto.&#10;echo.&#10;pause&#10;&#10;echo.&#10;echo [2/8] Deteniendo procesos de Gradle...&#10;call gradlew.bat --stop&#10;timeout /t 3 /nobreak &gt; nul&#10;&#10;echo.&#10;echo [3/8] Eliminando cache del proyecto...&#10;if exist .gradle rmdir /s /q .gradle&#10;if exist .idea rmdir /s /q .idea&#10;if exist .kotlin rmdir /s /q .kotlin&#10;if exist build rmdir /s /q build&#10;if exist app\build rmdir /s /q app\build&#10;&#10;echo.&#10;echo [4/8] Eliminando archivos de configuracion del IDE...&#10;if exist *.iml del /q *.iml&#10;if exist app\*.iml del /q app\*.iml&#10;&#10;echo.&#10;echo [5/8] Limpiando con Gradle...&#10;call gradlew.bat clean&#10;&#10;echo.&#10;echo [6/8] Verificando estructura del proyecto...&#10;call gradlew.bat projects&#10;&#10;echo.&#10;echo [7/8] Listando tareas disponibles...&#10;call gradlew.bat tasks&#10;&#10;echo.&#10;echo [8/8] Compilando el proyecto...&#10;call gradlew.bat assembleDebug&#10;&#10;echo.&#10;echo ==========================================&#10;echo COMPLETADO!&#10;echo ==========================================&#10;echo.&#10;echo Ahora ABRE Android Studio y:&#10;echo 1. Abre este proyecto&#10;echo 2. File ^&gt; Sync Project with Gradle Files&#10;echo 3. Build ^&gt; Rebuild Project&#10;echo.&#10;echo El error deberia estar resuelto.&#10;echo ==========================================&#10;pause&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/admin/AdminProfileDetailScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/admin/AdminProfileDetailScreen.kt" />
              <option name="originalContent" value="&#10;&#10;&#10;" />
              <option name="updatedContent" value="package com.example.appcolegios.admin&#10;&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.unit.dp&#10;import com.google.firebase.firestore.FirebaseFirestore&#10;import com.google.firebase.Timestamp&#10;import kotlinx.coroutines.launch&#10;import androidx.navigation.NavController&#10;import kotlinx.coroutines.tasks.await&#10;&#10;@Composable&#10;fun AdminProfileDetailScreen(navController: NavController? = null, userId: String) {&#10;    val db = FirebaseFirestore.getInstance()&#10;    val scope = rememberCoroutineScope()&#10;    var isLoading by remember { mutableStateOf(true) }&#10;    var status by remember { mutableStateOf&lt;String?&gt;(null) }&#10;&#10;    var displayName by remember { mutableStateOf(&quot;&quot;) }&#10;    var email by remember { mutableStateOf(&quot;&quot;) }&#10;    var role by remember { mutableStateOf(&quot;&quot;) }&#10;&#10;    LaunchedEffect(userId) {&#10;        isLoading = true&#10;        try {&#10;            val doc = db.collection(&quot;users&quot;).document(userId).get().await()&#10;            if (doc.exists()) {&#10;                displayName = doc.getString(&quot;displayName&quot;) ?: doc.getString(&quot;name&quot;) ?: &quot;&quot;&#10;                email = doc.getString(&quot;email&quot;) ?: &quot;&quot;&#10;                role = doc.getString(&quot;role&quot;) ?: &quot;&quot;&#10;            } else {&#10;                // intentar en students/teachers&#10;                val s = db.collection(&quot;students&quot;).document(userId).get().await()&#10;                if (s.exists()) {&#10;                    displayName = s.getString(&quot;nombre&quot;) ?: &quot;&quot;&#10;                    email = s.getString(&quot;email&quot;) ?: &quot;&quot;&#10;                    role = s.getString(&quot;role&quot;) ?: &quot;ESTUDIANTE&quot;&#10;                }&#10;            }&#10;        } catch (e: Exception) {&#10;            status = e.message&#10;        } finally {&#10;            isLoading = false&#10;        }&#10;    }&#10;&#10;    Column(Modifier.fillMaxSize().padding(16.dp), verticalArrangement = Arrangement.spacedBy(12.dp)) {&#10;        Text(&quot;Detalle de perfil&quot;, style = MaterialTheme.typography.headlineSmall)&#10;        if (isLoading) CircularProgressIndicator()&#10;        OutlinedTextField(value = displayName, onValueChange = { displayName = it }, label = { Text(&quot;Nombre&quot;) }, modifier = Modifier.fillMaxWidth())&#10;        OutlinedTextField(value = email, onValueChange = { email = it }, label = { Text(&quot;Email&quot;) }, modifier = Modifier.fillMaxWidth())&#10;        OutlinedTextField(value = role, onValueChange = { role = it }, label = { Text(&quot;Role&quot;) }, modifier = Modifier.fillMaxWidth())&#10;&#10;        Row(horizontalArrangement = Arrangement.spacedBy(8.dp)) {&#10;            Button(onClick = {&#10;                scope.launch {&#10;                    try {&#10;                        // actualizar collection users&#10;                        val map: Map&lt;String, Any?&gt; = mapOf(&quot;displayName&quot; to displayName, &quot;email&quot; to email, &quot;role&quot; to role, &quot;updatedAt&quot; to Timestamp.now())&#10;                        db.collection(&quot;users&quot;).document(userId).set(map).await()&#10;                        // intentar actualizar en students/teachers si existe (update requiere Map&lt;String, Any?&gt;)&#10;                        try { db.collection(&quot;students&quot;).document(userId).update(map).await() } catch (_: Exception) {}&#10;                        try { db.collection(&quot;teachers&quot;).document(userId).update(map).await() } catch (_: Exception) {}&#10;                        status = &quot;Guardado&quot;&#10;                    } catch (e: Exception) {&#10;                        status = e.message&#10;                    }&#10;                }&#10;            }) { Text(&quot;Guardar&quot;) }&#10;&#10;            Button(onClick = { navController?.popBackStack() }) { Text(&quot;Volver&quot;) }&#10;        }&#10;&#10;        if (status != null) Text(status!!)&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/admin/AdminScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/admin/AdminScreen.kt" />
              <option name="originalContent" value="@file:Suppress(&quot;RedundantQualifierName&quot;, &quot;RemoveRedundantQualifierName&quot;, &quot;RedundantQualifiedName&quot;, &quot;RedundantQualifier&quot;, &quot;UNUSED&quot;, &quot;unused&quot;, &quot;RedundantInitializer&quot;)&#10;&#10;package com.example.appcolegios.admin&#10;&#10;import android.content.Intent&#10;import android.net.Uri&#10;import androidx.activity.compose.rememberLauncherForActivityResult&#10;import androidx.activity.result.contract.ActivityResultContracts&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import com.google.firebase.firestore.FirebaseFirestore&#10;import com.google.firebase.Timestamp&#10;import kotlinx.coroutines.launch&#10;import java.io.BufferedReader&#10;import java.io.InputStreamReader&#10;import java.nio.charset.Charset&#10;import java.text.Normalizer&#10;import kotlinx.coroutines.tasks.await&#10;import com.example.appcolegios.data.UserData&#10;import com.example.appcolegios.data.UserPreferencesRepository&#10;import com.example.appcolegios.data.model.Role&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.compose.runtime.collectAsState&#10;import com.example.appcolegios.auth.RegisterActivity&#10;import org.apache.poi.ss.usermodel.WorkbookFactory&#10;import java.io.BufferedInputStream&#10;import com.google.firebase.FirebaseApp&#10;import com.google.firebase.FirebaseOptions&#10;import com.google.firebase.auth.FirebaseAuth&#10;import org.apache.poi.ss.usermodel.Row&#10;import com.example.appcolegios.data.TestDataInitializer&#10;import androidx.navigation.NavController&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.background&#10;&#10;// Helper local para leer celdas de forma segura&#10;private fun safeCellValue(row: Row, index: Int): String? = row.getCell(index)?.toString()?.trim()?.takeIf { it.isNotBlank() }&#10;&#10;@Composable&#10;fun AdminScreen(navController: NavController? = null) {&#10;    val context = LocalContext.current&#10;    val userPrefs = remember { UserPreferencesRepository(context) }&#10;    val userData = userPrefs.userData.collectAsState(initial = UserData(null, null, null)).value&#10;    // Tratar rol nulo o vacío como ADMIN&#10;    val role = if (userData.role.isNullOrBlank()) Role.ADMIN else Role.fromString(userData.role)&#10;&#10;    if (role != Role.ADMIN) {&#10;        Box(modifier = Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {&#10;            Text(&quot;No autorizado&quot;, color = MaterialTheme.colorScheme.error)&#10;        }&#10;        return&#10;    }&#10;&#10;    val scope = rememberCoroutineScope()&#10;    val db = remember { FirebaseFirestore.getInstance() }&#10;&#10;    var status by remember { mutableStateOf&lt;String?&gt;(null) }&#10;    var isLoading by remember { mutableStateOf(false) }&#10;&#10;    val filePicker = rememberLauncherForActivityResult(ActivityResultContracts.OpenDocument()) { uri: Uri? -&gt;&#10;        if (uri != null) {&#10;            scope.launch {&#10;                isLoading = true&#10;                status = null&#10;                try {&#10;                    context.contentResolver.takePersistableUriPermission(uri, Intent.FLAG_GRANT_READ_URI_PERMISSION)&#10;                } catch (_: Exception) {}&#10;&#10;                // Intentar inicializar FirebaseApp secundaria (importer) si existe google-services&#10;                val authImporter: FirebaseAuth? = try {&#10;                    val opts = FirebaseOptions.fromResource(context)&#10;                    val importerApp = if (opts != null) {&#10;                        try {&#10;                            FirebaseApp.getInstance(&quot;importer&quot;)&#10;                        } catch (_: IllegalStateException) {&#10;                            FirebaseApp.initializeApp(context, opts, &quot;importer&quot;)&#10;                            try { FirebaseApp.getInstance(&quot;importer&quot;) } catch (_: Exception) { null }&#10;                        }&#10;                    } else null&#10;                    if (importerApp != null) FirebaseAuth.getInstance(importerApp) else null&#10;                } catch (_: Exception) { null }&#10;&#10;                try {&#10;                    // Detectar por extensión si es CSV o XLSX&#10;                    val name = uri.lastPathSegment ?: &quot;&quot;&#10;                    val isXlsx = name.endsWith(&quot;.xlsx&quot;, ignoreCase = true) || name.endsWith(&quot;.xls&quot;, ignoreCase = true)&#10;                    var count = 0&#10;                    if (isXlsx) {&#10;                        // Leer con Apache POI&#10;                        context.contentResolver.openInputStream(uri)?.use { input -&gt;&#10;                            BufferedInputStream(input).use { bis -&gt;&#10;                                val wb = WorkbookFactory.create(bis)&#10;                                val sheet = wb.getSheetAt(0)&#10;                                for (r in 1..sheet.lastRowNum) {&#10;                                    val row = sheet.getRow(r) ?: continue&#10;                                    // Soportar dos formatos:&#10;                                    // Formato completo (9 cols): 0 nombre,1 apellidos,2 tipoDoc,3 numeroDoc,4 celular,5 direccion,6 email,7 pass,8 rol&#10;                                    // Formato compacto (&gt;=5 cols): 0 nombre,1 apellidos,2 tipo,3 email,4 role&#10;                                    val cellCount = row.lastCellNum.toInt()&#10;                                    @Suppress(&quot;RedundantInitializer&quot;) var nombre = &quot;&quot;&#10;                                    @Suppress(&quot;RedundantInitializer&quot;) var apellidos = &quot;&quot;&#10;                                    @Suppress(&quot;RedundantInitializer&quot;) var tipo = &quot;&quot;&#10;                                    @Suppress(&quot;RedundantInitializer&quot;) var email = &quot;&quot;&#10;                                    var pass: String? = null&#10;                                    var rol = &quot;ESTUDIANTE&quot;&#10;&#10;                                    if (cellCount &gt;= 9) {&#10;                                        nombre = row.getCell(0)?.toString()?.trim() ?: &quot;&quot;&#10;                                        @Suppress(&quot;RemoveRedundantQualifierName&quot;)&#10;                                        apellidos = safeCellValue(row, 1) ?: &quot;&quot;&#10;                                        @Suppress(&quot;RemoveRedundantQualifierName&quot;)&#10;                                        tipo = safeCellValue(row, 2) ?: &quot;&quot;&#10;                                        // salto campos intermedios&#10;                                        email = safeCellValue(row, 6) ?: &quot;&quot;&#10;                                        val cell7 = safeCellValue(row,7)&#10;                                        pass = cell7&#10;                                        // leer rol&#10;                                        val rawRol = safeCellValue(row,8) ?: &quot;&quot;&#10;                                        rol = if (rawRol.isBlank()) &quot;ESTUDIANTE&quot; else rawRol&#10;                                    } else if (cellCount &gt;= 5) {&#10;                                        nombre = safeCellValue(row, 0) ?: row.getCell(0)?.toString()?.trim() ?: &quot;&quot;&#10;                                        @Suppress(&quot;RemoveRedundantQualifierName&quot;)&#10;                                        apellidos = safeCellValue(row, 1) ?: &quot;&quot;&#10;                                        @Suppress(&quot;RemoveRedundantQualifierName&quot;)&#10;                                        tipo = safeCellValue(row, 2) ?: &quot;&quot;&#10;                                        email = safeCellValue(row, 3) ?: &quot;&quot;&#10;                                        rol = safeCellValue(row, 4) ?: &quot;ESTUDIANTE&quot;&#10;                                        // si hay columna 5 posible password&#10;                                        if (cellCount &gt; 5) pass = safeCellValue(row, 5)&#10;                                    } else {&#10;                                        // intentar una heuristica: buscar el primer email-like cell&#10;                                        for (c in 0 until cellCount) {&#10;                                            val v = row.getCell(c)?.toString()?.trim() ?: &quot;&quot;&#10;                                            if (v.contains(&quot;@&quot;)) { email = v; break }&#10;                                        }&#10;                                        nombre = row.getCell(0)?.toString()?.trim() ?: &quot;&quot;&#10;                                    }&#10;&#10;                                    if (email.isBlank() || nombre.isBlank()) continue&#10;&#10;                                    val roleParsed = when (rol.uppercase()) {&#10;                                        &quot;PADRE&quot;, &quot;PARENT&quot; -&gt; &quot;PADRE&quot;&#10;                                        &quot;DOCENTE&quot;, &quot;TEACHER&quot; -&gt; &quot;DOCENTE&quot;&#10;                                        &quot;ADMIN&quot;, &quot;ADMINISTRADOR&quot; -&gt; &quot;ADMIN&quot;&#10;                                        else -&gt; &quot;ESTUDIANTE&quot;&#10;                                    }&#10;&#10;                                    val coll = when (roleParsed) {&#10;                                        &quot;PADRE&quot; -&gt; &quot;parents&quot;&#10;                                        &quot;DOCENTE&quot; -&gt; &quot;teachers&quot;&#10;                                        &quot;ADMIN&quot; -&gt; &quot;admins&quot;&#10;                                        else -&gt; &quot;students&quot;&#10;                                    }&#10;&#10;                                    try {&#10;                                        if (pass != null &amp;&amp; authImporter != null) {&#10;                                            // Crear en Auth y guardar con UID&#10;                                            val res = authImporter.createUserWithEmailAndPassword(email, pass).await()&#10;                                            val uid = res.user?.uid ?: db.collection(coll).document().id&#10;                                            val data = hashMapOf(&#10;                                                &quot;nombres&quot; to nombre,&#10;                                                &quot;apellidos&quot; to apellidos,&#10;                                                &quot;email&quot; to email,&#10;                                                &quot;tipo&quot; to tipo,&#10;                                                &quot;role&quot; to roleParsed,&#10;                                                &quot;importedAt&quot; to Timestamp.now()&#10;                                            )&#10;                                            db.collection(coll).document(uid).set(data).await()&#10;                                            // Además, crear documento en la colección &quot;users&quot; para que la app lo encuentre&#10;                                            try {&#10;                                                val displayName = (&quot;$nombre $apellidos&quot;).trim()&#10;                                                val userMap = hashMapOf(&#10;                                                    &quot;displayName&quot; to displayName,&#10;                                                    &quot;email&quot; to email,&#10;                                                    &quot;role&quot; to roleParsed&#10;                                                )&#10;                                                db.collection(&quot;users&quot;).document(uid).set(userMap).await()&#10;                                            } catch (_: Exception) { }&#10;                                            // enviar verificacion de forma asíncrona y esperar&#10;                                            try {&#10;                                                res.user?.sendEmailVerification()?.await()&#10;                                            } catch (_: Exception) { }&#10;                                            // Asegurarse de no dejar al importer autenticado&#10;                                            try { authImporter.signOut() } catch (_: Exception) {}&#10;                                        } else {&#10;                                            // Guardar doc y encolar petición para backend&#10;                                            val data = hashMapOf(&#10;                                                &quot;nombres&quot; to nombre,&#10;                                                &quot;apellidos&quot; to apellidos,&#10;                                                &quot;email&quot; to email,&#10;                                                &quot;tipo&quot; to tipo,&#10;                                                &quot;role&quot; to roleParsed,&#10;                                                &quot;importedAt&quot; to Timestamp.now()&#10;                                            )&#10;                                            db.collection(coll).add(data).await()&#10;                                            db.collection(&quot;auth_queue&quot;).add(hashMapOf(&#10;                                                &quot;email&quot; to email,&#10;                                                &quot;role&quot; to roleParsed,&#10;                                                &quot;displayName&quot; to (&quot;$nombre $apellidos&quot;).trim(),&#10;                                                &quot;requestedAt&quot; to Timestamp.now()&#10;                                            )).await()&#10;&#10;                                            // Cambio mínimo: crear también un documento en &quot;users&quot; para que la app tenga acceso al correo&#10;                                            try {&#10;                                                val userMap = hashMapOf(&#10;                                                    &quot;displayName&quot; to (&quot;$nombre $apellidos&quot;).trim(),&#10;                                                    &quot;email&quot; to email,&#10;                                                    &quot;role&quot; to roleParsed,&#10;                                                    &quot;importedAt&quot; to Timestamp.now()&#10;                                                )&#10;                                                db.collection(&quot;users&quot;).add(userMap).await()&#10;                                            } catch (_: Exception) { }&#10;&#10;                                            // Intentar enviar email de restablecimiento (si la cuenta ya existe esto ayudará al usuario a establecer contraseña)&#10;                                            try {&#10;                                                val mainAuth = FirebaseAuth.getInstance()&#10;                                                mainAuth.sendPasswordResetEmail(email).await()&#10;                                            } catch (_: Exception) { }&#10;                                        }&#10;                                        count++&#10;                                    } catch (e: Exception) {&#10;                                        // registrar error y continuar&#10;                                    }&#10;                                }&#10;                                wb.close()&#10;                            }&#10;                        }&#10;                    } else {&#10;                        // CSV: usar lector robusto (maneja comillas, BOM y codificación UTF-8/CP1252)&#10;                        context.contentResolver.openInputStream(uri)?.use { input -&gt;&#10;                            // detectar BOM / probar UTF-8 primero&#10;                            val possibleCharsets = listOf(Charset.forName(&quot;UTF-8&quot;), Charset.forName(&quot;windows-1252&quot;))&#10;                            var reader: BufferedReader? = null&#10;                            for (cs in possibleCharsets) {&#10;                                try {&#10;                                    reader = BufferedReader(InputStreamReader(input, cs))&#10;                                    reader.mark(4096)&#10;                                    // try to read first line and reset; if decode okay, break&#10;                                    reader.readLine()&#10;                                    reader.reset()&#10;                                    break&#10;                                } catch (_: Exception) {&#10;                                    try { reader?.close() } catch (_: Exception) {}&#10;                                    reader = null&#10;                                    try { input.reset() } catch (_: Exception) {}&#10;                                }&#10;                            }&#10;                            if (reader == null) reader = BufferedReader(InputStreamReader(input, Charset.forName(&quot;UTF-8&quot;)))&#10;&#10;                            // función auxiliar para parsear línea CSV que respeta comillas&#10;                            fun parseCsvLine(line: String): List&lt;String&gt; {&#10;                                val regex = &quot;,(?=(?:[^\&quot;]*\&quot;[^\&quot;]*\&quot;)*[^\&quot;]*$)&quot;.toRegex()&#10;                                return line.split(regex).map { it.trim().trim('&quot;').let { s -&gt; Normalizer.normalize(s, Normalizer.Form.NFC) } }&#10;                            }&#10;&#10;                            // descartar header si existe&#10;                            var line = reader.readLine() ?: &quot;&quot;&#10;                            // heurística: si primera línea contiene &quot;name&quot; o &quot;email&quot; considerarla header&#10;                            if (line.contains(&quot;email&quot;, true) || line.contains(&quot;nombre&quot;, true) || line.contains(&quot;name&quot;, true)) {&#10;                                // ya descartada&#10;                            } else {&#10;                                // procesar esta primera línea también&#10;                                val parts0 = parseCsvLine(line)&#10;                                if (parts0.size &gt;= 3) {&#10;                                    val type = parts0[0].lowercase().trim()&#10;                                    val email = parts0.getOrNull(1)?.trim() ?: &quot;&quot;&#10;                                    val nameVal = parts0.getOrNull(2)?.trim() ?: &quot;&quot;&#10;                                    val parsedRole = when (parts0.getOrNull(3)?.trim()?.uppercase()) {&#10;                                        &quot;PADRE&quot; -&gt; &quot;PADRE&quot;&#10;                                        &quot;DOCENTE&quot; -&gt; &quot;DOCENTE&quot;&#10;                                        &quot;ADMIN&quot; -&gt; &quot;ADMIN&quot;&#10;                                        else -&gt; &quot;ESTUDIANTE&quot;&#10;                                    }&#10;                                    val maybePass = parts0.getOrNull(4)?.trim()?.takeIf { it.isNotBlank() }&#10;                                    val coll = when (parsedRole) {&#10;                                        &quot;PADRE&quot; -&gt; &quot;parents&quot;&#10;                                        &quot;DOCENTE&quot; -&gt; &quot;teachers&quot;&#10;                                        &quot;ADMIN&quot; -&gt; &quot;admins&quot;&#10;                                        else -&gt; &quot;students&quot;&#10;                                    }&#10;                                    try {&#10;                                        val display = Normalizer.normalize(nameVal, Normalizer.Form.NFC)&#10;                                        if (maybePass != null &amp;&amp; authImporter != null) {&#10;                                            val res = authImporter.createUserWithEmailAndPassword(email, maybePass).await()&#10;                                            val uid = res.user?.uid ?: db.collection(coll).document().id&#10;                                            db.collection(coll).document(uid).set(hashMapOf(&quot;name&quot; to display, &quot;email&quot; to email, &quot;role&quot; to parsedRole, &quot;type&quot; to type, &quot;importedAt&quot; to Timestamp.now())).await()&#10;                                        } else {&#10;                                            db.collection(coll).add(hashMapOf(&quot;email&quot; to email, &quot;name&quot; to display, &quot;role&quot; to parsedRole, &quot;type&quot; to type, &quot;importedAt&quot; to Timestamp.now())).await()&#10;                                            db.collection(&quot;auth_queue&quot;).add(hashMapOf(&quot;email&quot; to email, &quot;role&quot; to parsedRole, &quot;displayName&quot; to display, &quot;requestedAt&quot; to Timestamp.now())).await()&#10;                                        }&#10;                                        count++&#10;                                    } catch (_: Exception) {}&#10;                                }&#10;                            }&#10;&#10;                            var localCount = 0&#10;                            while (true) {&#10;                                line = reader.readLine() ?: break&#10;                                val parts = parseCsvLine(line)&#10;                                if (parts.size &gt;= 3) {&#10;                                    val type = parts[0].lowercase().trim()&#10;                                    val email = parts.getOrNull(1)?.trim() ?: &quot;&quot;&#10;                                    val nameVal = parts.getOrNull(2)?.trim() ?: &quot;&quot;&#10;                                    val parsedRole = when (parts.getOrNull(3)?.trim()?.uppercase()) {&#10;                                        &quot;PADRE&quot; -&gt; &quot;PADRE&quot;&#10;                                        &quot;DOCENTE&quot; -&gt; &quot;DOCENTE&quot;&#10;                                        &quot;ADMIN&quot; -&gt; &quot;ADMIN&quot;&#10;                                        else -&gt; &quot;ESTUDIANTE&quot;&#10;                                    }&#10;                                    val maybePass = parts.getOrNull(4)?.trim()?.takeIf { it.isNotBlank() }&#10;                                    val coll = when (parsedRole) {&#10;                                        &quot;PADRE&quot; -&gt; &quot;parents&quot;&#10;                                        &quot;DOCENTE&quot; -&gt; &quot;teachers&quot;&#10;                                        &quot;ADMIN&quot; -&gt; &quot;admins&quot;&#10;                                        else -&gt; &quot;students&quot;&#10;                                    }&#10;&#10;                                    try {&#10;                                        val display = Normalizer.normalize(nameVal, Normalizer.Form.NFC)&#10;                                        if (maybePass != null &amp;&amp; authImporter != null) {&#10;                                            val res = authImporter.createUserWithEmailAndPassword(email, maybePass).await()&#10;                                            val uid = res.user?.uid ?: db.collection(coll).document().id&#10;                                            db.collection(coll).document(uid).set(hashMapOf(&#10;                                                &quot;name&quot; to display,&#10;                                                &quot;email&quot; to email,&#10;                                                &quot;role&quot; to parsedRole,&#10;                                                &quot;type&quot; to type,&#10;                                                &quot;importedAt&quot; to Timestamp.now()&#10;                                            )).await()&#10;                                        } else {&#10;                                            db.collection(coll).add(hashMapOf(&#10;                                                &quot;email&quot; to email,&#10;                                                &quot;name&quot; to display,&#10;                                                &quot;role&quot; to parsedRole,&#10;                                                &quot;type&quot; to type,&#10;                                                &quot;importedAt&quot; to Timestamp.now()&#10;                                            )).await()&#10;                                            db.collection(&quot;auth_queue&quot;).add(hashMapOf(&#10;                                                &quot;email&quot; to email,&#10;                                                &quot;role&quot; to parsedRole,&#10;                                                &quot;displayName&quot; to display,&#10;                                                &quot;requestedAt&quot; to Timestamp.now()&#10;                                            )).await()&#10;                                        }&#10;                                        localCount++&#10;                                    } catch (e: Exception) {&#10;                                        // continuar&#10;                                    }&#10;                                }&#10;                            }&#10;                            count += localCount&#10;                        }&#10;                    }&#10;&#10;                    status = &quot;Se importaron $count registros correctamente.&quot;&#10;                } catch (e: Exception) {&#10;                    status = &quot;Error importando: ${e.message}&quot;&#10;                } finally {&#10;                    isLoading = false&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .padding(16.dp),&#10;        verticalArrangement = Arrangement.spacedBy(16.dp)&#10;    ) {&#10;        Text(&#10;            &quot;Panel de Administración&quot;,&#10;            style = MaterialTheme.typography.headlineMedium,&#10;            fontWeight = FontWeight.Bold&#10;        )&#10;&#10;        // Tarjetas principales: Registrar usuario, Ver perfiles, Gestionar horarios, Crear evento/Notificación&#10;        Row(Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.spacedBy(12.dp)) {&#10;            ElevatedCard(modifier = Modifier.weight(1f), onClick = {&#10;                val intent = android.content.Intent(context, RegisterActivity::class.java)&#10;                intent.putExtra(&quot;fromAdmin&quot;, true)&#10;                context.startActivity(intent)&#10;            }) {&#10;                Box(Modifier.height(84.dp).fillMaxWidth(), contentAlignment = Alignment.Center) { Text(&quot;Registrar usuario&quot;) }&#10;            }&#10;&#10;            ElevatedCard(modifier = Modifier.weight(1f), onClick = {&#10;                navController?.navigate(com.example.appcolegios.navigation.AppRoutes.AdminUsers.route)&#10;            }) {&#10;                Box(Modifier.height(84.dp).fillMaxWidth(), contentAlignment = Alignment.Center) { Text(&quot;Ver perfiles&quot;) }&#10;            }&#10;&#10;            ElevatedCard(modifier = Modifier.weight(1f), onClick = {&#10;                // Ir a la selección de usuarios (luego seleccionar para gestionar horario)&#10;                navController?.navigate(com.example.appcolegios.navigation.AppRoutes.AdminUsers.route)&#10;            }) {&#10;                Box(Modifier.height(84.dp).fillMaxWidth(), contentAlignment = Alignment.Center) { Text(&quot;Gestionar horarios&quot;) }&#10;            }&#10;&#10;            ElevatedCard(modifier = Modifier.weight(1f), onClick = {&#10;                navController?.navigate(com.example.appcolegios.navigation.AppRoutes.AdminEventCreate.route)&#10;            }) {&#10;                Box(Modifier.height(84.dp).fillMaxWidth(), contentAlignment = Alignment.Center) { Text(&quot;Crear evento/Notificación&quot;) }&#10;            }&#10;        }&#10;&#10;        if (status != null) {&#10;            Card(&#10;                colors = CardDefaults.cardColors(&#10;                    containerColor = if (status!!.contains(&quot;Error&quot;))&#10;                        MaterialTheme.colorScheme.errorContainer&#10;                    else&#10;                        MaterialTheme.colorScheme.primaryContainer&#10;                )&#10;            ) {&#10;                Text(&#10;                    status!!,&#10;                    modifier = Modifier.padding(16.dp),&#10;                    color = if (status!!.contains(&quot;Error&quot;))&#10;                        MaterialTheme.colorScheme.onErrorContainer&#10;                    else&#10;                        MaterialTheme.colorScheme.onPrimaryContainer&#10;                )&#10;            }&#10;        }&#10;&#10;        if (isLoading) {&#10;            CircularProgressIndicator()&#10;        }&#10;&#10;        // Botón para inicializar datos de prueba&#10;        Card(&#10;            colors = CardDefaults.cardColors(&#10;                containerColor = MaterialTheme.colorScheme.surface&#10;            ),&#10;            elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)&#10;        ) {&#10;            Column(Modifier.padding(16.dp)) {&#10;                Text(&#10;                    &quot;Inicializar Datos de Prueba&quot;,&#10;                    style = MaterialTheme.typography.titleMedium,&#10;                    fontWeight = FontWeight.Bold&#10;                )&#10;                Spacer(Modifier.height(8.dp))&#10;                Text(&#10;                    &quot;Crea usuarios de prueba con información completa:\n&quot; +&#10;                    &quot;• Estudiante: jcamilodiaz7@gmail.com\n&quot; +&#10;                    &quot;• Profesor: hermanitos605@gmail.com\n&quot; +&#10;                    &quot;• Admin: jcamilodiaz777@gmail.com\n&quot; +&#10;                    &quot;• Padre: hermanitos604@gmail.com&quot;,&#10;                    style = MaterialTheme.typography.bodyMedium&#10;                )&#10;                Spacer(Modifier.height(12.dp))&#10;                Button(&#10;                    onClick = {&#10;                        scope.launch {&#10;                            isLoading = true&#10;                            status = null&#10;                            try {&#10;                                TestDataInitializer.initializeAllTestData()&#10;                                status = &quot;✅ Datos de prueba inicializados correctamente&quot;&#10;                            } catch (e: Exception) {&#10;                                status = &quot;❌ Error: ${e.message}&quot;&#10;                            } finally {&#10;                                isLoading = false&#10;                            }&#10;                        }&#10;                    },&#10;                    enabled = !isLoading,&#10;                    modifier = Modifier.fillMaxWidth()&#10;                ) {&#10;                    Text(&quot;Inicializar Datos de Prueba&quot;)&#10;                }&#10;            }&#10;        }&#10;&#10;        // Botón para importar desde CSV/XLSX&#10;        Button(&#10;            onClick = { filePicker.launch(arrayOf(&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;,&quot;text/*&quot;,&quot;text/csv&quot;,&quot;text/comma-separated-values&quot;)) },&#10;            enabled = !isLoading,&#10;            modifier = Modifier.fillMaxWidth()&#10;        ) {&#10;            Text(&quot;Importar desde CSV / Excel (.xlsx)&quot;)&#10;        }&#10;&#10;        Text(&#10;            &quot;Formato CSV: tipo,email,nombre,rol\nEjemplo: estudiante,juan@mail.com,Juan Pérez,ESTUDIANTE&quot;,&#10;            style = MaterialTheme.typography.bodySmall,&#10;            color = MaterialTheme.colorScheme.onSurfaceVariant&#10;        )&#10;    }&#10;}&#10;" />
              <option name="updatedContent" value="@file:Suppress(&quot;RedundantQualifierName&quot;, &quot;RemoveRedundantQualifierName&quot;, &quot;RedundantQualifiedName&quot;, &quot;RedundantQualifier&quot;, &quot;UNUSED&quot;, &quot;unused&quot;, &quot;RedundantInitializer&quot;)&#10;&#10;package com.example.appcolegios.admin&#10;&#10;import android.content.Intent&#10;import android.net.Uri&#10;import androidx.activity.compose.rememberLauncherForActivityResult&#10;import androidx.activity.result.contract.ActivityResultContracts&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.text.font.FontWeight&#10;import androidx.compose.ui.unit.dp&#10;import com.google.firebase.firestore.FirebaseFirestore&#10;import com.google.firebase.Timestamp&#10;import kotlinx.coroutines.launch&#10;import java.io.BufferedReader&#10;import java.io.InputStreamReader&#10;import java.nio.charset.Charset&#10;import java.text.Normalizer&#10;import kotlinx.coroutines.tasks.await&#10;import com.example.appcolegios.data.UserData&#10;import com.example.appcolegios.data.UserPreferencesRepository&#10;import com.example.appcolegios.data.model.Role&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.compose.runtime.collectAsState&#10;import com.example.appcolegios.auth.RegisterActivity&#10;import org.apache.poi.ss.usermodel.WorkbookFactory&#10;import java.io.BufferedInputStream&#10;import com.google.firebase.FirebaseApp&#10;import com.google.firebase.FirebaseOptions&#10;import com.google.firebase.auth.FirebaseAuth&#10;import org.apache.poi.ss.usermodel.Row&#10;import com.example.appcolegios.data.TestDataInitializer&#10;import androidx.navigation.NavController&#10;import androidx.compose.animation.core.animateFloatAsState&#10;import androidx.compose.ui.graphics.graphicsLayer&#10;&#10;// Helper local para leer celdas de forma segura&#10;private fun safeCellValue(row: Row, index: Int): String? = row.getCell(index)?.toString()?.trim()?.takeIf { it.isNotBlank() }&#10;&#10;@Composable&#10;fun AdminScreen(navController: NavController? = null) {&#10;    val context = LocalContext.current&#10;    val userPrefs = remember { UserPreferencesRepository(context) }&#10;    val userData = userPrefs.userData.collectAsState(initial = UserData(null, null, null)).value&#10;    // Tratar rol nulo o vacío como ADMIN&#10;    val role = if (userData.role.isNullOrBlank()) Role.ADMIN else Role.fromString(userData.role)&#10;&#10;    if (role != Role.ADMIN) {&#10;        Box(modifier = Modifier.fillMaxSize(), contentAlignment = Alignment.Center) {&#10;            Text(&quot;No autorizado&quot;, color = MaterialTheme.colorScheme.error)&#10;        }&#10;        return&#10;    }&#10;&#10;    val scope = rememberCoroutineScope()&#10;    val db = remember { FirebaseFirestore.getInstance() }&#10;&#10;    var status by remember { mutableStateOf&lt;String?&gt;(null) }&#10;    var isLoading by remember { mutableStateOf(false) }&#10;&#10;    // Preview state for CSV&#10;    var previewRows by remember { mutableStateOf&lt;List&lt;List&lt;String&gt;&gt;&gt;(emptyList()) }&#10;    var previewCols by remember { mutableStateOf(0) }&#10;    val PREVIEW_N = 6&#10;&#10;    val filePicker = rememberLauncherForActivityResult(ActivityResultContracts.OpenDocument()) { uri: Uri? -&gt;&#10;        if (uri != null) {&#10;            scope.launch {&#10;                isLoading = true&#10;                status = null&#10;                try {&#10;                    context.contentResolver.takePersistableUriPermission(uri, Intent.FLAG_GRANT_READ_URI_PERMISSION)&#10;                } catch (_: Exception) {}&#10;&#10;                // Intentar inicializar FirebaseApp secundaria (importer) si existe google-services&#10;                val authImporter: FirebaseAuth? = try {&#10;                    val opts = FirebaseOptions.fromResource(context)&#10;                    val importerApp = if (opts != null) {&#10;                        try {&#10;                            FirebaseApp.getInstance(&quot;importer&quot;)&#10;                        } catch (_: IllegalStateException) {&#10;                            FirebaseApp.initializeApp(context, opts, &quot;importer&quot;)&#10;                            try { FirebaseApp.getInstance(&quot;importer&quot;) } catch (_: Exception) { null }&#10;                        }&#10;                    } else null&#10;                    if (importerApp != null) FirebaseAuth.getInstance(importerApp) else null&#10;                } catch (_: Exception) { null }&#10;&#10;                try {&#10;                    // Detectar por extensión si es CSV o XLSX&#10;                    val name = uri.lastPathSegment ?: &quot;&quot;&#10;                    val isXlsx = name.endsWith(&quot;.xlsx&quot;, ignoreCase = true) || name.endsWith(&quot;.xls&quot;, ignoreCase = true)&#10;                    var count = 0&#10;                    if (isXlsx) {&#10;                        // Leer con Apache POI&#10;                        context.contentResolver.openInputStream(uri)?.use { input -&gt;&#10;                            BufferedInputStream(input).use { bis -&gt;&#10;                                val wb = WorkbookFactory.create(bis)&#10;                                val sheet = wb.getSheetAt(0)&#10;                                for (r in 1..sheet.lastRowNum) {&#10;                                    val row = sheet.getRow(r) ?: continue&#10;                                    // Soportar dos formatos:&#10;                                    // Formato completo (9 cols): 0 nombre,1 apellidos,2 tipoDoc,3 numeroDoc,4 celular,5 direccion,6 email,7 pass,8 rol&#10;                                    // Formato compacto (&gt;=5 cols): 0 nombre,1 apellidos,2 tipo,3 email,4 role&#10;                                    val cellCount = row.lastCellNum.toInt()&#10;                                    @Suppress(&quot;RedundantInitializer&quot;) var nombre = &quot;&quot;&#10;                                    @Suppress(&quot;RedundantInitializer&quot;) var apellidos = &quot;&quot;&#10;                                    @Suppress(&quot;RedundantInitializer&quot;) var tipo = &quot;&quot;&#10;                                    @Suppress(&quot;RedundantInitializer&quot;) var email = &quot;&quot;&#10;                                    var pass: String? = null&#10;                                    var rol = &quot;ESTUDIANTE&quot;&#10;&#10;                                    if (cellCount &gt;= 9) {&#10;                                        nombre = row.getCell(0)?.toString()?.trim() ?: &quot;&quot;&#10;                                        @Suppress(&quot;RemoveRedundantQualifierName&quot;)&#10;                                        apellidos = safeCellValue(row, 1) ?: &quot;&quot;&#10;                                        @Suppress(&quot;RemoveRedundantQualifierName&quot;)&#10;                                        tipo = safeCellValue(row, 2) ?: &quot;&quot;&#10;                                        // salto campos intermedios&#10;                                        email = safeCellValue(row, 6) ?: &quot;&quot;&#10;                                        val cell7 = safeCellValue(row,7)&#10;                                        pass = cell7&#10;                                        // leer rol&#10;                                        val rawRol = safeCellValue(row,8) ?: &quot;&quot;&#10;                                        rol = if (rawRol.isBlank()) &quot;ESTUDIANTE&quot; else rawRol&#10;                                    } else if (cellCount &gt;= 5) {&#10;                                        nombre = safeCellValue(row, 0) ?: row.getCell(0)?.toString()?.trim() ?: &quot;&quot;&#10;                                        @Suppress(&quot;RemoveRedundantQualifierName&quot;)&#10;                                        apellidos = safeCellValue(row, 1) ?: &quot;&quot;&#10;                                        @Suppress(&quot;RemoveRedundantQualifierName&quot;)&#10;                                        tipo = safeCellValue(row, 2) ?: &quot;&quot;&#10;                                        email = safeCellValue(row, 3) ?: &quot;&quot;&#10;                                        rol = safeCellValue(row, 4) ?: &quot;ESTUDIANTE&quot;&#10;                                        // si hay columna 5 posible password&#10;                                        if (cellCount &gt; 5) pass = safeCellValue(row, 5)&#10;                                    } else {&#10;                                        // intentar una heuristica: buscar el primer email-like cell&#10;                                        for (c in 0 until cellCount) {&#10;                                            val v = row.getCell(c)?.toString()?.trim() ?: &quot;&quot;&#10;                                            if (v.contains(&quot;@&quot;)) { email = v; break }&#10;                                        }&#10;                                        nombre = row.getCell(0)?.toString()?.trim() ?: &quot;&quot;&#10;                                    }&#10;&#10;                                    if (email.isBlank() || nombre.isBlank()) continue&#10;&#10;                                    val roleParsed = when (rol.uppercase()) {&#10;                                        &quot;PADRE&quot;, &quot;PARENT&quot; -&gt; &quot;PADRE&quot;&#10;                                        &quot;DOCENTE&quot;, &quot;TEACHER&quot; -&gt; &quot;DOCENTE&quot;&#10;                                        &quot;ADMIN&quot;, &quot;ADMINISTRADOR&quot; -&gt; &quot;ADMIN&quot;&#10;                                        else -&gt; &quot;ESTUDIANTE&quot;&#10;                                    }&#10;&#10;                                    val coll = when (roleParsed) {&#10;                                        &quot;PADRE&quot; -&gt; &quot;parents&quot;&#10;                                        &quot;DOCENTE&quot; -&gt; &quot;teachers&quot;&#10;                                        &quot;ADMIN&quot; -&gt; &quot;admins&quot;&#10;                                        else -&gt; &quot;students&quot;&#10;                                    }&#10;&#10;                                    try {&#10;                                        if (pass != null &amp;&amp; authImporter != null) {&#10;                                            // Crear en Auth y guardar con UID&#10;                                            val res = authImporter.createUserWithEmailAndPassword(email, pass).await()&#10;                                            val uid = res.user?.uid ?: db.collection(coll).document().id&#10;                                            val data = hashMapOf(&#10;                                                &quot;nombres&quot; to nombre,&#10;                                                &quot;apellidos&quot; to apellidos,&#10;                                                &quot;email&quot; to email,&#10;                                                &quot;tipo&quot; to tipo,&#10;                                                &quot;role&quot; to roleParsed,&#10;                                                &quot;importedAt&quot; to Timestamp.now()&#10;                                            )&#10;                                            db.collection(coll).document(uid).set(data).await()&#10;                                            // Además, crear documento en la colección &quot;users&quot; para que la app lo encuentre&#10;                                            try {&#10;                                                val displayName = (&quot;$nombre $apellidos&quot;).trim()&#10;                                                val userMap = hashMapOf(&#10;                                                    &quot;displayName&quot; to displayName,&#10;                                                    &quot;email&quot; to email,&#10;                                                    &quot;role&quot; to roleParsed&#10;                                                )&#10;                                                db.collection(&quot;users&quot;).document(uid).set(userMap).await()&#10;                                            } catch (_: Exception) { }&#10;                                            // enviar verificacion de forma asíncrona y esperar&#10;                                            try {&#10;                                                res.user?.sendEmailVerification()?.await()&#10;                                            } catch (_: Exception) { }&#10;                                            // Asegurarse de no dejar al importer autenticado&#10;                                            try { authImporter.signOut() } catch (_: Exception) {}&#10;                                        } else {&#10;                                            // Guardar doc y encolar petición para backend&#10;                                            val data = hashMapOf(&#10;                                                &quot;nombres&quot; to nombre,&#10;                                                &quot;apellidos&quot; to apellidos,&#10;                                                &quot;email&quot; to email,&#10;                                                &quot;tipo&quot; to tipo,&#10;                                                &quot;role&quot; to roleParsed,&#10;                                                &quot;importedAt&quot; to Timestamp.now()&#10;                                            )&#10;                                            db.collection(coll).add(data).await()&#10;                                            db.collection(&quot;auth_queue&quot;).add(hashMapOf(&#10;                                                &quot;email&quot; to email,&#10;                                                &quot;role&quot; to roleParsed,&#10;                                                &quot;displayName&quot; to (&quot;$nombre $apellidos&quot;).trim(),&#10;                                                &quot;requestedAt&quot; to Timestamp.now()&#10;                                            )).await()&#10;&#10;                                            // Cambio mínimo: crear también un documento en &quot;users&quot; para que la app tenga acceso al correo&#10;                                            try {&#10;                                                val userMap = hashMapOf(&#10;                                                    &quot;displayName&quot; to (&quot;$nombre $apellidos&quot;).trim(),&#10;                                                    &quot;email&quot; to email,&#10;                                                    &quot;role&quot; to roleParsed,&#10;                                                    &quot;importedAt&quot; to Timestamp.now()&#10;                                                )&#10;                                                db.collection(&quot;users&quot;).add(userMap).await()&#10;                                            } catch (_: Exception) { }&#10;&#10;                                            // Intentar enviar email de restablecimiento (si la cuenta ya existe esto ayudará al usuario a establecer contraseña)&#10;                                            try {&#10;                                                val mainAuth = FirebaseAuth.getInstance()&#10;                                                mainAuth.sendPasswordResetEmail(email).await()&#10;                                            } catch (_: Exception) { }&#10;                                        }&#10;                                        count++&#10;                                    } catch (e: Exception) {&#10;                                        // registrar error y continuar&#10;                                    }&#10;                                }&#10;                                wb.close()&#10;                            }&#10;                        }&#10;                    } else {&#10;                        // CSV: usar lector robusto (maneja comillas, BOM y codificación UTF-8/CP1252)&#10;                        context.contentResolver.openInputStream(uri)?.use { input -&gt;&#10;                            // detectar BOM / probar UTF-8 primero&#10;                            val possibleCharsets = listOf(Charset.forName(&quot;UTF-8&quot;), Charset.forName(&quot;windows-1252&quot;))&#10;                            var reader: BufferedReader? = null&#10;                            for (cs in possibleCharsets) {&#10;                                try {&#10;                                    reader = BufferedReader(InputStreamReader(input, cs))&#10;                                    reader.mark(4096)&#10;                                    // try to read first line and reset; if decode okay, break&#10;                                    reader.readLine()&#10;                                    reader.reset()&#10;                                    break&#10;                                } catch (_: Exception) {&#10;                                    try { reader?.close() } catch (_: Exception) {}&#10;                                    reader = null&#10;                                    try { input.reset() } catch (_: Exception) {}&#10;                                }&#10;                            }&#10;                            if (reader == null) reader = BufferedReader(InputStreamReader(input, Charset.forName(&quot;UTF-8&quot;)))&#10;&#10;                            // función auxiliar para parsear línea CSV que respeta comillas&#10;                            fun parseCsvLine(line: String): List&lt;String&gt; {&#10;                                val regex = &quot;,(?=(?:[^\&quot;]*\&quot;[^\&quot;]*\&quot;)*[^\&quot;]*$)&quot;.toRegex()&#10;                                return line.split(regex).map { it.trim().trim('&quot;').let { s -&gt; Normalizer.normalize(s, Normalizer.Form.NFC) } }&#10;                            }&#10;&#10;                            // PREVIEW: leer primeras PREVIEW_N líneas y poblar previewRows&#10;                            val tmpRows = mutableListOf&lt;List&lt;String&gt;&gt;()&#10;                            var headerLine = reader.readLine()&#10;                            val isHeader = headerLine != null &amp;&amp; (headerLine.contains(&quot;email&quot;, true) || headerLine.contains(&quot;nombre&quot;, true) || headerLine.contains(&quot;name&quot;, true))&#10;                            if (!isHeader &amp;&amp; headerLine != null) {&#10;                                tmpRows.add(parseCsvLine(headerLine))&#10;                            }&#10;                            while (tmpRows.size &lt; PREVIEW_N) {&#10;                                val l = reader.readLine() ?: break&#10;                                tmpRows.add(parseCsvLine(l))&#10;                            }&#10;                            previewRows = tmpRows.map { it.map { cell -&gt; cell } }&#10;                            previewCols = previewRows.maxOfOrNull { it.size } ?: 0&#10;                            status = &quot;Archivo cargado: vista previa ${previewRows.size} filas&quot;&#10;                            // additionally keep original import if user chooses to import full file (handled by existing path)&#10;                        }&#10;                    }&#10;&#10;                    status = &quot;Se importaron $count registros correctamente.&quot;&#10;                } catch (e: Exception) {&#10;                    status = &quot;Error importando: ${e.message}&quot;&#10;                } finally {&#10;                    isLoading = false&#10;                }&#10;            }&#10;        }&#10;    }&#10;&#10;    Column(&#10;        modifier = Modifier&#10;            .fillMaxSize()&#10;            .padding(16.dp),&#10;        verticalArrangement = Arrangement.spacedBy(16.dp)&#10;    ) {&#10;        Text(&#10;            &quot;Panel de Administración&quot;,&#10;            style = MaterialTheme.typography.headlineMedium,&#10;            fontWeight = FontWeight.Bold&#10;        )&#10;&#10;        // Tarjetas principales: organizadas 2x2 para mejor presentación&#10;        val btns: List&lt;Pair&lt;String, () -&gt; Unit&gt;&gt; = listOf(&#10;            &quot;Registrar usuario&quot; to {&#10;                val intent = android.content.Intent(context, RegisterActivity::class.java)&#10;                intent.putExtra(&quot;fromAdmin&quot;, true)&#10;                context.startActivity(intent)&#10;                Unit&#10;            },&#10;            &quot;Ver perfiles&quot; to {&#10;                navController?.navigate(com.example.appcolegios.navigation.AppRoutes.AdminUsers.route)&#10;                Unit&#10;            },&#10;            &quot;Gestionar horarios&quot; to {&#10;                navController?.navigate(com.example.appcolegios.navigation.AppRoutes.AdminUsers.route)&#10;                Unit&#10;            },&#10;            &quot;Crear evento/Notificación&quot; to {&#10;                navController?.navigate(com.example.appcolegios.navigation.AppRoutes.AdminEventCreate.route)&#10;                Unit&#10;            }&#10;        )&#10;&#10;        Column(Modifier.fillMaxWidth()) {&#10;            for (rowIdx in 0 until 2) {&#10;                Row(Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.spacedBy(12.dp)) {&#10;                    for (colIdx in 0 until 2) {&#10;                        val idx = rowIdx * 2 + colIdx&#10;                        val label = btns[idx].first&#10;                        val onClick = btns[idx].second&#10;                        val scale by animateFloatAsState(targetValue = 1f, label = &quot;btn_scale_$idx&quot;)&#10;                        ElevatedCard(modifier = Modifier.weight(1f).height(96.dp).graphicsLayer(scaleX = scale, scaleY = scale), onClick = onClick) {&#10;                            Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) { Text(label) }&#10;                        }&#10;                    }&#10;                }&#10;                Spacer(Modifier.height(8.dp))&#10;            }&#10;        }&#10;&#10;        // --- CSV Preview &amp; Mapping ---&#10;        var mappedNameCol by remember { mutableStateOf&lt;Int?&gt;(null) }&#10;        var mappedEmailCol by remember { mutableStateOf&lt;Int?&gt;(null) }&#10;        var mappedRoleCol by remember { mutableStateOf&lt;Int?&gt;(null) }&#10;&#10;        // Button to open filePicker (existing) - keep it near preview&#10;        Row(Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.spacedBy(12.dp)) {&#10;            Button(onClick = { filePicker.launch(arrayOf(&quot;text/*&quot;,&quot;text/csv&quot;,&quot;text/comma-separated-values&quot;,&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;)) }) { Text(&quot;Seleccionar archivo a previsualizar&quot;) }&#10;            if (previewRows.isNotEmpty()) {&#10;                Button(onClick = {&#10;                    // Confirm import using mapping&#10;                    scope.launch {&#10;                        isLoading = true&#10;                        try {&#10;                            // perform import of previewRows using mapped indices&#10;                            var imported = 0&#10;                            for (r in previewRows) {&#10;                                val nameVal = mappedNameCol?.let { r.getOrNull(it) } ?: r.getOrNull(0)&#10;                                val emailVal = mappedEmailCol?.let { r.getOrNull(it) } ?: r.getOrNull(1)&#10;                                val roleVal = mappedRoleCol?.let { r.getOrNull(it) } ?: &quot;ESTUDIANTE&quot;&#10;                                val display = nameVal?.trim() ?: continue&#10;                                val emailS = emailVal?.trim() ?: continue&#10;                                val roleParsed = when (roleVal?.trim()?.uppercase()) {&#10;                                    &quot;PADRE&quot; -&gt; &quot;PADRE&quot;; &quot;DOCENTE&quot; -&gt; &quot;DOCENTE&quot;; &quot;ADMIN&quot; -&gt; &quot;ADMIN&quot;; else -&gt; &quot;ESTUDIANTE&quot;&#10;                                }&#10;                                val coll = when (roleParsed) {&#10;                                    &quot;PADRE&quot; -&gt; &quot;parents&quot;; &quot;DOCENTE&quot; -&gt; &quot;teachers&quot;; &quot;ADMIN&quot; -&gt; &quot;admins&quot;; else -&gt; &quot;students&quot;&#10;                                }&#10;                                db.collection(coll).add(hashMapOf(&quot;name&quot; to display, &quot;email&quot; to emailS, &quot;role&quot; to roleParsed, &quot;importedAt&quot; to Timestamp.now())).await()&#10;                                imported++&#10;                            }&#10;                            status = &quot;Importados $imported registros (preview)&quot;&#10;                        } catch (e: Exception) { status = &quot;Error importando preview: ${e.message}&quot; }&#10;                        finally { isLoading = false }&#10;                    }&#10;                }) { Text(&quot;Importar previsualizados&quot;) }&#10;            }&#10;        }&#10;&#10;        if (previewRows.isNotEmpty()) {&#10;            Text(&quot;Previsualización (primeras $PREVIEW_N filas)&quot;)&#10;            Spacer(Modifier.height(8.dp))&#10;            // header select&#10;            Row(Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.spacedBy(8.dp)) {&#10;                val cols = previewCols&#10;                for (c in 0 until cols) {&#10;                    Column(horizontalAlignment = Alignment.CenterHorizontally) {&#10;                        Text(&quot;Col $c&quot;, style = MaterialTheme.typography.bodySmall)&#10;                        Row {&#10;                            TextButton(onClick = { mappedNameCol = c }) { Text(&quot;Nombre&quot;) }&#10;                            TextButton(onClick = { mappedEmailCol = c }) { Text(&quot;Email&quot;) }&#10;                            TextButton(onClick = { mappedRoleCol = c }) { Text(&quot;Rol&quot;) }&#10;                        }&#10;                    }&#10;                }&#10;            }&#10;            Spacer(Modifier.height(8.dp))&#10;            // mostrar filas&#10;            Column(Modifier.fillMaxWidth()) {&#10;                previewRows.forEachIndexed { ri, row -&gt;&#10;                    Row(Modifier.fillMaxWidth(), horizontalArrangement = Arrangement.spacedBy(8.dp)) {&#10;                        row.forEach { cell -&gt; Text(cell, modifier = Modifier.weight(1f), maxLines = 1) }&#10;                    }&#10;                    Spacer(Modifier.height(4.dp))&#10;                }&#10;            }&#10;            Spacer(Modifier.height(12.dp))&#10;        }&#10;&#10;        if (status != null) {&#10;            Card(&#10;                colors = CardDefaults.cardColors(&#10;                    containerColor = if (status!!.contains(&quot;Error&quot;))&#10;                        MaterialTheme.colorScheme.errorContainer&#10;                    else&#10;                        MaterialTheme.colorScheme.primaryContainer&#10;                )&#10;            ) {&#10;                Text(&#10;                    status!!,&#10;                    modifier = Modifier.padding(16.dp),&#10;                    color = if (status!!.contains(&quot;Error&quot;))&#10;                        MaterialTheme.colorScheme.onErrorContainer&#10;                    else&#10;                        MaterialTheme.colorScheme.onPrimaryContainer&#10;                )&#10;            }&#10;        }&#10;&#10;        if (isLoading) {&#10;            CircularProgressIndicator()&#10;        }&#10;&#10;        // Botón para inicializar datos de prueba&#10;        Card(&#10;            colors = CardDefaults.cardColors(&#10;                containerColor = MaterialTheme.colorScheme.surface&#10;            ),&#10;            elevation = CardDefaults.cardElevation(defaultElevation = 2.dp)&#10;        ) {&#10;            Column(Modifier.padding(16.dp)) {&#10;                Text(&#10;                    &quot;Inicializar Datos de Prueba&quot;,&#10;                    style = MaterialTheme.typography.titleMedium,&#10;                    fontWeight = FontWeight.Bold&#10;                )&#10;                Spacer(Modifier.height(8.dp))&#10;                Text(&#10;                    &quot;Crea usuarios de prueba con información completa:\n&quot; +&#10;                    &quot;• Estudiante: jcamilodiaz7@gmail.com\n&quot; +&#10;                    &quot;• Profesor: hermanitos605@gmail.com\n&quot; +&#10;                    &quot;• Admin: jcamilodiaz777@gmail.com\n&quot; +&#10;                    &quot;• Padre: hermanitos604@gmail.com&quot;,&#10;                    style = MaterialTheme.typography.bodyMedium&#10;                )&#10;                Spacer(Modifier.height(12.dp))&#10;                Button(&#10;                    onClick = {&#10;                        scope.launch {&#10;                            isLoading = true&#10;                            status = null&#10;                            try {&#10;                                TestDataInitializer.initializeAllTestData()&#10;                                status = &quot;✅ Datos de prueba inicializados correctamente&quot;&#10;                            } catch (e: Exception) {&#10;                                status = &quot;❌ Error: ${e.message}&quot;&#10;                            } finally {&#10;                                isLoading = false&#10;                            }&#10;                        }&#10;                    },&#10;                    enabled = !isLoading,&#10;                    modifier = Modifier.fillMaxWidth()&#10;                ) {&#10;                    Text(&quot;Inicializar Datos de Prueba&quot;)&#10;                }&#10;            }&#10;        }&#10;&#10;        // Botón para importar desde CSV/XLSX (comprobar: el filePicker también carga preview)&#10;        Button(&#10;            onClick = { filePicker.launch(arrayOf(&quot;application/vnd.openxmlformats-officedocument.spreadsheetml.sheet&quot;,&quot;text/*&quot;,&quot;text/csv&quot;,&quot;text/comma-separated-values&quot;)) },&#10;            enabled = !isLoading,&#10;            modifier = Modifier.fillMaxWidth()&#10;        ) {&#10;            Text(&quot;Seleccionar archivo (previsualizar)&quot;)&#10;        }&#10;&#10;        Text(&#10;            &quot;Formato CSV: tipo,email,nombre,rol\nEjemplo: estudiante,juan@mail.com,Juan Pérez,ESTUDIANTE&quot;,&#10;            style = MaterialTheme.typography.bodySmall,&#10;            color = MaterialTheme.colorScheme.onSurfaceVariant&#10;        )&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/admin/AdminUsersScreen.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/admin/AdminUsersScreen.kt" />
              <option name="originalContent" value="package com.example.appcolegios.admin&#10;&#10;import androidx.navigation.NavController&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.MoreVert&#10;import androidx.compose.material.icons.filled.Notifications&#10;import androidx.compose.material.icons.filled.Event&#10;import androidx.compose.material.icons.filled.Schedule&#10;import com.google.firebase.firestore.FirebaseFirestore&#10;import com.google.firebase.Timestamp&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.unit.dp&#10;import kotlinx.coroutines.tasks.await&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.material3.IconButton&#10;import androidx.compose.material3.TextButton&#10;import androidx.compose.material3.AlertDialog&#10;import androidx.compose.material3.Icon&#10;import com.example.appcolegios.academico.EventType&#10;import java.util.UUID&#10;&#10;@Composable&#10;fun AdminUsersScreen(navController: NavController? = null, onUserSelected: (String) -&gt; Unit = {}) {&#10;    val db = FirebaseFirestore.getInstance()&#10;    var users by remember { mutableStateOf&lt;List&lt;Map&lt;String, Any&gt;&gt;&gt;(emptyList()) }&#10;    var isLoading by remember { mutableStateOf(true) }&#10;    var error by remember { mutableStateOf&lt;String?&gt;(null) }&#10;&#10;    LaunchedEffect(Unit) {&#10;        isLoading = true&#10;        try {&#10;            // Preferir listar estudiantes (colección &quot;students&quot;) porque la gestión de horarios aplica a estudiantes.&#10;            val snap = db.collection(&quot;students&quot;).get().await()&#10;            val list = mutableListOf&lt;Map&lt;String, Any&gt;&gt;()&#10;            if (!snap.isEmpty) {&#10;                for (doc in snap.documents) {&#10;                    val map = doc.data?.toMutableMap() ?: mutableMapOf()&#10;                    // Normalizar campos: id, displayName, email, role&#10;                    map[&quot;id&quot;] = doc.id&#10;                    val nombre = (map[&quot;nombre&quot;] as? String) ?: (map[&quot;name&quot;] as? String) ?: &quot;(sin nombre)&quot;&#10;                    map[&quot;displayName&quot;] = nombre&#10;                    map[&quot;email&quot;] = map[&quot;email&quot;] ?: &quot;&quot;&#10;                    map[&quot;role&quot;] = &quot;ESTUDIANTE&quot;&#10;                    list.add(map)&#10;                }&#10;            } else {&#10;                // Fallback: listar colección &quot;users&quot; si no hay estudiantes&#10;                val us = db.collection(&quot;users&quot;).get().await()&#10;                for (doc in us.documents) {&#10;                    val map = doc.data?.toMutableMap() ?: mutableMapOf()&#10;                    map[&quot;id&quot;] = doc.id&#10;                    list.add(map)&#10;                }&#10;            }&#10;            users = list&#10;        } catch (e: Exception) {&#10;            error = e.message&#10;        } finally {&#10;            isLoading = false&#10;        }&#10;    }&#10;&#10;    if (isLoading) {&#10;        Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) { CircularProgressIndicator() }&#10;        return&#10;    }&#10;    if (error != null) {&#10;        Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) { Text(&quot;Error: $error&quot;) }&#10;        return&#10;    }&#10;&#10;    Card(Modifier.fillMaxSize().padding(8.dp)) {&#10;        LazyColumn(contentPadding = PaddingValues(8.dp)) {&#10;            items(users) { u -&gt;&#10;                val id = u[&quot;id&quot;] as? String ?: &quot;&quot;&#10;                val name = (u[&quot;displayName&quot;] as? String) ?: (u[&quot;name&quot;] as? String) ?: &quot;(sin nombre)&quot;&#10;                val email = (u[&quot;email&quot;] as? String) ?: &quot;&quot;&#10;                val role = (u[&quot;role&quot;] as? String) ?: &quot;&quot;&#10;                var actionsOpen by remember { mutableStateOf(false) }&#10;                Column(modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .padding(vertical = 8.dp)&#10;                ) {&#10;                    Row(modifier = Modifier.fillMaxWidth(), verticalAlignment = Alignment.CenterVertically) {&#10;                        Column(modifier = Modifier.weight(1f).clickable { onUserSelected(id) }) {&#10;                            Text(name, style = MaterialTheme.typography.titleMedium)&#10;                            Spacer(Modifier.height(4.dp))&#10;                            Text(if (email.isNotBlank()) &quot;$email · ${role}&quot; else role, style = MaterialTheme.typography.bodySmall)&#10;                        }&#10;                        IconButton(onClick = { actionsOpen = true }) { Icon(Icons.Filled.MoreVert, contentDescription = &quot;Acciones&quot;) }&#10;                    }&#10;                    HorizontalDivider(color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.08f))&#10;                    Spacer(Modifier.height(4.dp))&#10;&#10;                    if (actionsOpen) {&#10;                        // Dialog with user details and actions&#10;                        AlertDialog(onDismissRequest = { actionsOpen = false }, title = { Text(name) }, text = {&#10;                            Column {&#10;                                Text(&quot;Email: $email&quot;)&#10;                                Spacer(Modifier.height(8.dp))&#10;                                Text(&quot;Rol: $role&quot;)&#10;                            }&#10;                        }, confirmButton = {&#10;                            Row {&#10;                                TextButton(onClick = {&#10;                                    actionsOpen = false&#10;                                    // navigate to schedule manager for this user&#10;                                    navController?.navigate(com.example.appcolegios.navigation.AppRoutes.AdminScheduleManage.route.replace(&quot;{userId}&quot;, id))&#10;                                }) { Icon(Icons.Filled.Schedule, contentDescription = null); Spacer(Modifier.width(6.dp)); Text(&quot;Agregar horario&quot;) }&#10;                                Spacer(Modifier.width(8.dp))&#10;                                TextButton(onClick = {&#10;                                    actionsOpen = false&#10;                                    // open simple notification dialog&#10;                                    sendNotificationForUser(db, id, name)&#10;                                }) { Icon(Icons.Filled.Notifications, contentDescription = null); Spacer(Modifier.width(6.dp)); Text(&quot;Enviar notificación&quot;) }&#10;                                Spacer(Modifier.width(8.dp))&#10;                                TextButton(onClick = {&#10;                                    actionsOpen = false&#10;                                    // open event dialog to add event to user's calendar&#10;                                    addEventForUser(db, id, name)&#10;                                }) { Icon(Icons.Filled.Event, contentDescription = null); Spacer(Modifier.width(6.dp)); Text(&quot;Agregar evento&quot;) }&#10;                            }&#10;                        }, dismissButton = { TextButton(onClick = { actionsOpen = false }) { Text(&quot;Cerrar&quot;) } })&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;// Helper: open a small UI to send notification; implemented as immediate write after simple default content for speed&#10;private fun sendNotificationForUser(db: FirebaseFirestore, userId: String, senderName: String) {&#10;    // For simplicity create a generic notification; in UI we could ask title/body — keeping it minimal&#10;    try {&#10;        val notif = hashMapOf(&#10;            &quot;titulo&quot; to &quot;Mensaje del Admin&quot;,&#10;            &quot;cuerpo&quot; to &quot;Has recibido una notificación del administrador.&quot;,&#10;            &quot;remitente&quot; to &quot;admin&quot;,&#10;            &quot;senderName&quot; to senderName,&#10;            &quot;fechaHora&quot; to Timestamp.now(),&#10;            &quot;leida&quot; to false,&#10;            &quot;type&quot; to &quot;admin&quot;&#10;        )&#10;        db.collection(&quot;users&quot;).document(userId).collection(&quot;notifications&quot;).add(notif)&#10;    } catch (_: Exception) {}&#10;}&#10;&#10;// Helper: add a minimal event document under users/{userId}/events&#10;private fun addEventForUser(db: FirebaseFirestore, userId: String, titleFallback: String) {&#10;    try {&#10;        val eid = UUID.randomUUID().toString()&#10;        val data = hashMapOf&lt;String, Any?&gt;(&#10;            &quot;id&quot; to eid,&#10;            &quot;title&quot; to &quot;Evento desde Admin&quot;,&#10;            &quot;description&quot; to &quot;Evento agregado por administrador para $titleFallback&quot;,&#10;            &quot;date&quot; to Timestamp.now(),&#10;            &quot;type&quot; to EventType.EVENTO.name,&#10;            &quot;createdAt&quot; to Timestamp.now(),&#10;            &quot;ownerId&quot; to userId&#10;        )&#10;        db.collection(&quot;users&quot;).document(userId).collection(&quot;events&quot;).document(eid).set(data)&#10;        // create notification for the user as well&#10;        val notif = hashMapOf(&#10;            &quot;titulo&quot; to &quot;Nuevo evento&quot;,&#10;            &quot;cuerpo&quot; to &quot;Se agregó un evento a tu calendario&quot;,&#10;            &quot;remitente&quot; to &quot;admin&quot;,&#10;            &quot;senderName&quot; to &quot;Administrador&quot;,&#10;            &quot;fechaHora&quot; to Timestamp.now(),&#10;            &quot;leida&quot; to false,&#10;            &quot;relatedId&quot; to eid,&#10;            &quot;type&quot; to &quot;event&quot;&#10;        )&#10;        db.collection(&quot;users&quot;).document(userId).collection(&quot;notifications&quot;).add(notif)&#10;    } catch (_: Exception) {}&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.appcolegios.admin&#10;&#10;import androidx.navigation.NavController&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.filled.MoreVert&#10;import androidx.compose.material.icons.filled.Notifications&#10;import androidx.compose.material.icons.filled.Event&#10;import androidx.compose.material.icons.filled.Schedule&#10;import com.google.firebase.firestore.FirebaseFirestore&#10;import com.google.firebase.Timestamp&#10;import androidx.compose.foundation.clickable&#10;import androidx.compose.foundation.layout.*&#10;import androidx.compose.foundation.lazy.LazyColumn&#10;import androidx.compose.foundation.lazy.items&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.*&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.unit.dp&#10;import kotlinx.coroutines.tasks.await&#10;import androidx.compose.ui.Alignment&#10;import androidx.compose.material3.IconButton&#10;import androidx.compose.material3.TextButton&#10;import androidx.compose.material3.AlertDialog&#10;import androidx.compose.material3.Icon&#10;import com.example.appcolegios.academico.EventType&#10;import java.util.UUID&#10;&#10;@Composable&#10;fun AdminUsersScreen(navController: NavController? = null, onUserSelected: (String) -&gt; Unit = {}) {&#10;    val db = FirebaseFirestore.getInstance()&#10;    var users by remember { mutableStateOf&lt;List&lt;Map&lt;String, Any&gt;&gt;&gt;(emptyList()) }&#10;    var isLoading by remember { mutableStateOf(true) }&#10;    var error by remember { mutableStateOf&lt;String?&gt;(null) }&#10;&#10;    LaunchedEffect(Unit) {&#10;        isLoading = true&#10;        try {&#10;            // Preferir listar estudiantes (colección &quot;students&quot;) porque la gestión de horarios aplica a estudiantes.&#10;            val snap = db.collection(&quot;students&quot;).get().await()&#10;            val list = mutableListOf&lt;Map&lt;String, Any&gt;&gt;()&#10;            if (!snap.isEmpty) {&#10;                for (doc in snap.documents) {&#10;                    val map = doc.data?.toMutableMap() ?: mutableMapOf()&#10;                    // Normalizar campos: id, displayName, email, role&#10;                    map[&quot;id&quot;] = doc.id&#10;                    val nombre = (map[&quot;nombre&quot;] as? String) ?: (map[&quot;name&quot;] as? String) ?: &quot;(sin nombre)&quot;&#10;                    map[&quot;displayName&quot;] = nombre&#10;                    map[&quot;email&quot;] = map[&quot;email&quot;] ?: &quot;&quot;&#10;                    map[&quot;role&quot;] = &quot;ESTUDIANTE&quot;&#10;                    list.add(map)&#10;                }&#10;            } else {&#10;                // Fallback: listar colección &quot;users&quot; si no hay estudiantes&#10;                val us = db.collection(&quot;users&quot;).get().await()&#10;                for (doc in us.documents) {&#10;                    val map = doc.data?.toMutableMap() ?: mutableMapOf()&#10;                    map[&quot;id&quot;] = doc.id&#10;                    list.add(map)&#10;                }&#10;            }&#10;            users = list&#10;        } catch (e: Exception) {&#10;            error = e.message&#10;        } finally {&#10;            isLoading = false&#10;        }&#10;    }&#10;&#10;    if (isLoading) {&#10;        Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) { CircularProgressIndicator() }&#10;        return&#10;    }&#10;    if (error != null) {&#10;        Box(Modifier.fillMaxSize(), contentAlignment = Alignment.Center) { Text(&quot;Error: $error&quot;) }&#10;        return&#10;    }&#10;&#10;    Card(Modifier.fillMaxSize().padding(8.dp)) {&#10;        LazyColumn(contentPadding = PaddingValues(8.dp)) {&#10;            items(users) { u -&gt;&#10;                val id = u[&quot;id&quot;] as? String ?: &quot;&quot;&#10;                val name = (u[&quot;displayName&quot;] as? String) ?: (u[&quot;name&quot;] as? String) ?: &quot;(sin nombre)&quot;&#10;                val email = (u[&quot;email&quot;] as? String) ?: &quot;&quot;&#10;                val role = (u[&quot;role&quot;] as? String) ?: &quot;&quot;&#10;                var actionsOpen by remember { mutableStateOf(false) }&#10;                Column(modifier = Modifier&#10;                    .fillMaxWidth()&#10;                    .padding(vertical = 8.dp)&#10;                ) {&#10;                    Row(modifier = Modifier.fillMaxWidth(), verticalAlignment = Alignment.CenterVertically) {&#10;                        Column(modifier = Modifier.weight(1f).clickable { &#10;                            // navegar a detalle de perfil&#10;                            navController?.navigate(com.example.appcolegios.navigation.AppRoutes.AdminProfileDetail.route.replace(&quot;{userId}&quot;, id))&#10;                        }) {&#10;                            Text(name, style = MaterialTheme.typography.titleMedium)&#10;                            Spacer(Modifier.height(4.dp))&#10;                            Text(if (email.isNotBlank()) &quot;$email · ${role}&quot; else role, style = MaterialTheme.typography.bodySmall)&#10;                        }&#10;                        IconButton(onClick = { actionsOpen = true }) { Icon(Icons.Filled.MoreVert, contentDescription = &quot;Acciones&quot;) }&#10;                    }&#10;                    HorizontalDivider(color = MaterialTheme.colorScheme.onSurface.copy(alpha = 0.08f))&#10;                    Spacer(Modifier.height(4.dp))&#10;&#10;                    if (actionsOpen) {&#10;                        // Dialog with user details and actions&#10;                        AlertDialog(onDismissRequest = { actionsOpen = false }, title = { Text(name) }, text = {&#10;                            Column {&#10;                                Text(&quot;Email: $email&quot;)&#10;                                Spacer(Modifier.height(8.dp))&#10;                                Text(&quot;Rol: $role&quot;)&#10;                            }&#10;                        }, confirmButton = {&#10;                            Row {&#10;                                TextButton(onClick = {&#10;                                    actionsOpen = false&#10;                                    // navigate to schedule manager for this user&#10;                                    navController?.navigate(com.example.appcolegios.navigation.AppRoutes.AdminScheduleManage.route.replace(&quot;{userId}&quot;, id))&#10;                                }) { Icon(Icons.Filled.Schedule, contentDescription = null); Spacer(Modifier.width(6.dp)); Text(&quot;Agregar horario&quot;) }&#10;                                Spacer(Modifier.width(8.dp))&#10;                                TextButton(onClick = {&#10;                                    actionsOpen = false&#10;                                    // open simple notification dialog&#10;                                    sendNotificationForUser(db, id, name)&#10;                                }) { Icon(Icons.Filled.Notifications, contentDescription = null); Spacer(Modifier.width(6.dp)); Text(&quot;Enviar notificación&quot;) }&#10;                                Spacer(Modifier.width(8.dp))&#10;                                TextButton(onClick = {&#10;                                    actionsOpen = false&#10;                                    // open event dialog to add event to user's calendar&#10;                                    addEventForUser(db, id, name)&#10;                                }) { Icon(Icons.Filled.Event, contentDescription = null); Spacer(Modifier.width(6.dp)); Text(&quot;Agregar evento&quot;) }&#10;                                Spacer(Modifier.width(8.dp))&#10;                                TextButton(onClick = {&#10;                                    actionsOpen = false&#10;                                    // ver perfil (alternativa)&#10;                                    navController?.navigate(com.example.appcolegios.navigation.AppRoutes.AdminProfileDetail.route.replace(&quot;{userId}&quot;, id))&#10;                                }) { Text(&quot;Ver perfil&quot;) }&#10;                            }&#10;                        }, dismissButton = { TextButton(onClick = { actionsOpen = false }) { Text(&quot;Cerrar&quot;) } })&#10;                    }&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;// Helper: open a small UI to send notification; implemented as immediate write after simple default content for speed&#10;private fun sendNotificationForUser(db: FirebaseFirestore, userId: String, senderName: String) {&#10;    // For simplicity create a generic notification; in UI we could ask title/body — keeping it minimal&#10;    try {&#10;        val notif = hashMapOf(&#10;            &quot;titulo&quot; to &quot;Mensaje del Admin&quot;,&#10;            &quot;cuerpo&quot; to &quot;Has recibido una notificación del administrador.&quot;,&#10;            &quot;remitente&quot; to &quot;admin&quot;,&#10;            &quot;senderName&quot; to senderName,&#10;            &quot;fechaHora&quot; to Timestamp.now(),&#10;            &quot;leida&quot; to false,&#10;            &quot;type&quot; to &quot;admin&quot;&#10;        )&#10;        db.collection(&quot;users&quot;).document(userId).collection(&quot;notifications&quot;).add(notif)&#10;    } catch (_: Exception) {}&#10;}&#10;&#10;// Helper: add a minimal event document under users/{userId}/events&#10;private fun addEventForUser(db: FirebaseFirestore, userId: String, titleFallback: String) {&#10;    try {&#10;        val eid = UUID.randomUUID().toString()&#10;        val data = hashMapOf&lt;String, Any?&gt;(&#10;            &quot;id&quot; to eid,&#10;            &quot;title&quot; to &quot;Evento desde Admin&quot;,&#10;            &quot;description&quot; to &quot;Evento agregado por administrador para $titleFallback&quot;,&#10;            &quot;date&quot; to Timestamp.now(),&#10;            &quot;type&quot; to EventType.EVENTO.name,&#10;            &quot;createdAt&quot; to Timestamp.now(),&#10;            &quot;ownerId&quot; to userId&#10;        )&#10;        db.collection(&quot;users&quot;).document(userId).collection(&quot;events&quot;).document(eid).set(data)&#10;        // create notification for the user as well&#10;        val notif = hashMapOf(&#10;            &quot;titulo&quot; to &quot;Nuevo evento&quot;,&#10;            &quot;cuerpo&quot; to &quot;Se agregó un evento a tu calendario&quot;,&#10;            &quot;remitente&quot; to &quot;admin&quot;,&#10;            &quot;senderName&quot; to &quot;Administrador&quot;,&#10;            &quot;fechaHora&quot; to Timestamp.now(),&#10;            &quot;leida&quot; to false,&#10;            &quot;relatedId&quot; to eid,&#10;            &quot;type&quot; to &quot;event&quot;&#10;        )&#10;        db.collection(&quot;users&quot;).document(userId).collection(&quot;notifications&quot;).add(notif)&#10;    } catch (_: Exception) {}&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/auth/SplashActivity.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/auth/SplashActivity.kt" />
              <option name="updatedContent" value="package com.example.appcolegios.auth&#10;&#10;import android.content.Intent&#10;import android.os.Bundle&#10;import android.os.Handler&#10;import android.os.Looper&#10;import android.view.animation.Animation&#10;import android.view.animation.AnimationUtils&#10;import android.widget.ImageView&#10;import androidx.appcompat.app.AppCompatActivity&#10;import com.example.appcolegios.R&#10;&#10;class SplashActivity : AppCompatActivity() {&#10;&#10;    override fun onCreate(savedInstanceState: Bundle?) {&#10;        super.onCreate(savedInstanceState)&#10;        setContentView(R.layout.activity_splash)&#10;&#10;        // Animación de fade in para el logo&#10;        val logoView: ImageView = findViewById(R.id.splashLogo)&#10;        val fadeIn: Animation = AnimationUtils.loadAnimation(this, R.anim.fade_in)&#10;        logoView.startAnimation(fadeIn)&#10;&#10;        // Al terminar la animación, iniciar LoginActivity&#10;        fadeIn.setAnimationListener(object : Animation.AnimationListener {&#10;            override fun onAnimationStart(animation: Animation) {}&#10;            override fun onAnimationRepeat(animation: Animation) {}&#10;            override fun onAnimationEnd(animation: Animation) {&#10;                // Retardo breve antes de iniciar&#10;                Handler(Looper.getMainLooper()).postDelayed({&#10;                    startActivity(Intent(this@SplashActivity, com.example.appcolegios.auth.LoginActivity::class.java))&#10;                    finish()&#10;                }, 300)&#10;            }&#10;        })&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/navigation/AppNavigation.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/navigation/AppNavigation.kt" />
              <option name="originalContent" value="@file:OptIn(ExperimentalMaterial3Api::class)&#10;&#10;package com.example.appcolegios.navigation&#10;&#10;import android.app.Activity&#10;import android.content.Intent&#10;import androidx.compose.animation.core.animateFloatAsState&#10;import androidx.compose.foundation.layout.Box&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.foundation.layout.Spacer&#10;import androidx.compose.foundation.layout.height&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.filled.Message&#10;import androidx.compose.material.icons.automirrored.filled.Logout&#10;import androidx.compose.material.icons.filled.Home&#10;import androidx.compose.material.icons.filled.Menu&#10;import androidx.compose.material.icons.filled.Notifications&#10;import androidx.compose.material.icons.filled.Person&#10;import androidx.compose.material.icons.filled.MoreVert&#10;import androidx.compose.material.icons.filled.CreditCard&#10;import androidx.compose.material.icons.filled.DirectionsBus&#10;import androidx.compose.material.icons.filled.School&#10;import androidx.compose.material.icons.automirrored.filled.Assignment&#10;import androidx.compose.material.icons.automirrored.filled.EventNote&#10;import androidx.compose.material.icons.filled.CalendarToday&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.LaunchedEffect&#10;import androidx.compose.runtime.collectAsState&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.setValue&#10;import androidx.compose.runtime.rememberCoroutineScope&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.graphicsLayer&#10;import androidx.compose.ui.res.stringResource&#10;import androidx.compose.ui.unit.dp&#10;import androidx.navigation.NavDestination.Companion.hierarchy&#10;import androidx.navigation.compose.NavHost&#10;import androidx.navigation.compose.composable&#10;import androidx.navigation.compose.currentBackStackEntryAsState&#10;import androidx.navigation.compose.rememberNavController&#10;import com.example.appcolegios.R&#10;import com.example.appcolegios.academico.AttendanceScreen&#10;import com.example.appcolegios.academico.AnnouncementsScreen&#10;import com.example.appcolegios.academico.CalendarScreen&#10;import com.example.appcolegios.academico.ScheduleScreen&#10;import com.example.appcolegios.academico.NotesScreen&#10;import com.example.appcolegios.academico.TasksScreen&#10;import com.example.appcolegios.auth.LoginActivity&#10;import com.example.appcolegios.auth.RegisterScreen&#10;import com.example.appcolegios.auth.ResetPasswordScreen&#10;import com.example.appcolegios.auth.SplashScreen&#10;import com.example.appcolegios.home.HomeScreen&#10;import com.example.appcolegios.dashboard.DashboardScreen&#10;import com.example.appcolegios.mensajes.ChatScreen&#10;import com.example.appcolegios.mensajes.ConversationsScreen&#10;import com.example.appcolegios.mensajes.NewMessageScreen&#10;import com.example.appcolegios.notificaciones.NotificationsScreen&#10;import com.example.appcolegios.pagos.PaymentsScreen&#10;import com.example.appcolegios.perfil.ProfileScreen&#10;import com.example.appcolegios.transporte.TransportScreen&#10;import com.example.appcolegios.admin.AdminScreen&#10;import com.example.appcolegios.admin.AdminUsersScreen&#10;import com.example.appcolegios.ubicacion.UbicacionScreen&#10;import kotlinx.coroutines.launch&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.lifecycle.viewmodel.compose.viewModel&#10;import com.example.appcolegios.data.UserPreferencesRepository&#10;import androidx.navigation.NavType&#10;import androidx.navigation.navArgument&#10;import android.widget.Toast&#10;import com.example.appcolegios.auth.VerifyEmailScreen&#10;import com.example.appcolegios.teacher.TeacherHomeScreen&#10;import com.example.appcolegios.student.StudentHomeScreen&#10;&#10;@Composable&#10;fun AppNavigation(&#10;    startDestination: String = AppRoutes.Splash.route,&#10;    initialRole: String? = null,&#10;    unreadNotificationsCount: Int = 0,&#10;    unreadMessagesCount: Int = 0&#10;) {&#10;    val navController = rememberNavController()&#10;    val backStackEntry = navController.currentBackStackEntryAsState().value&#10;    val currentDestination = backStackEntry?.destination&#10;&#10;    // Mostrar chrome en todas las rutas salvo pantallas de auth/splash&#10;    val authlessRoutes = setOf(&#10;        AppRoutes.Splash.route,&#10;        AppRoutes.Login.route,&#10;        AppRoutes.Register.route,&#10;        AppRoutes.VerifyEmail.route,&#10;        AppRoutes.ResetPassword.route&#10;    )&#10;&#10;    val showChrome = currentDestination?.route !in authlessRoutes&#10;&#10;    val drawerState = rememberDrawerState(DrawerValue.Closed)&#10;    val scope = rememberCoroutineScope()&#10;&#10;    val context = LocalContext.current&#10;    val userPrefs = UserPreferencesRepository(context)&#10;    val userData = userPrefs.userData.collectAsState(initial = com.example.appcolegios.data.UserData(null, null, null)).value&#10;    // Preferir el role inyectado (initialRole) para evitar condiciones de carrera; si no está, usar el de prefs&#10;    val roleString = if (!initialRole.isNullOrBlank()) initialRole else (userData.role ?: &quot;&quot; )&#10;    val isAdmin = roleString.equals(&quot;ADMIN&quot;, ignoreCase = true)&#10;    val isDocente = roleString.equals(&quot;DOCENTE&quot;, ignoreCase = true)&#10;    val isStudent = roleString.equals(&quot;ESTUDIANTE&quot;, ignoreCase = true)&#10;&#10;    val bottomItems = if (isAdmin) {&#10;        listOf(&#10;            // Para admin, Inicio debe llevar al Home (pantalla de inicio que muestra todas las opciones admin)&#10;            BottomItem(stringResource(R.string.home), AppRoutes.Home.route, Icons.Filled.Home),&#10;            BottomItem(stringResource(R.string.profile), AppRoutes.Profile.route, Icons.Filled.Person)&#10;        )&#10;    } else {&#10;        listOf(&#10;            BottomItem(stringResource(R.string.home), AppRoutes.Home.route, Icons.Filled.Home),&#10;            BottomItem(stringResource(R.string.messages), AppRoutes.Messages.route, Icons.AutoMirrored.Filled.Message),&#10;            BottomItem(stringResource(R.string.notifications), AppRoutes.Notifications.route, Icons.Filled.Notifications),&#10;            BottomItem(stringResource(R.string.schedule), AppRoutes.Schedule.route, Icons.Filled.CalendarToday),&#10;            BottomItem(stringResource(R.string.profile), AppRoutes.Profile.route, Icons.Filled.Person)&#10;        )&#10;    }&#10;&#10;    // Badges en tiempo real desde Firestore&#10;    val badgesVm: BadgesViewModel = viewModel()&#10;    val badgesState = badgesVm.state.collectAsState().value&#10;&#10;    val notifCount = if (badgesState.unreadNotifications &gt; 0) badgesState.unreadNotifications else unreadNotificationsCount&#10;    val msgCount = if (badgesState.unreadMessages &gt; 0) badgesState.unreadMessages else unreadMessagesCount&#10;&#10;    val content: @Composable () -&gt; Unit = {&#10;        NavHost(navController = navController, startDestination = startDestination) {&#10;            composable(AppRoutes.Splash.route) { SplashScreen(navController) }&#10;            composable(AppRoutes.Login.route) {&#10;                val localContext = LocalContext.current&#10;                LaunchedEffect(Unit) {&#10;                    val intent = Intent(localContext, LoginActivity::class.java)&#10;                    localContext.startActivity(intent)&#10;                    if (localContext is Activity) {&#10;                        localContext.finish()&#10;                    }&#10;                }&#10;                // Puedes mostrar una pantalla vacía o de carga mientras se lanza la actividad&#10;                Box(modifier = Modifier.fillMaxSize()) {}&#10;            }&#10;            composable(AppRoutes.Register.route) {&#10;                RegisterScreen(&#10;                    onRegisterSuccess = {&#10;                        // Mostrar mensaje de éxito y navegar a verificación de correo&#10;                        Toast.makeText(context, &quot;Registro exitoso. Verifica tu correo.&quot;, Toast.LENGTH_SHORT).show()&#10;                        navController.navigate(AppRoutes.VerifyEmail.route) {&#10;                            popUpTo(0) { inclusive = true }&#10;                        }&#10;                    },&#10;                    onNavigateToLogin = { navController.popBackStack() }&#10;                )&#10;            }&#10;            // Nueva ruta para registro desde Admin (solo crea documento en Firestore)&#10;            composable(AppRoutes.RegisterAdmin.route) {&#10;                RegisterScreen(&#10;                    onRegisterSuccess = {&#10;                        Toast.makeText(context, &quot;Usuario creado correctamente&quot;, Toast.LENGTH_SHORT).show()&#10;                        // Al crear desde admin solo volver al home del admin&#10;                        navController.navigate(AppRoutes.Home.route) {&#10;                            popUpTo(0) { inclusive = true }&#10;                        }&#10;                    },&#10;                    onNavigateToLogin = { navController.popBackStack() },&#10;                    createOnly = true&#10;                )&#10;            }&#10;            composable(AppRoutes.ResetPassword.route) {&#10;                ResetPasswordScreen(&#10;                    onPasswordResetSent = { navController.popBackStack() },&#10;                    onNavigateToLogin = { navController.popBackStack() }&#10;                )&#10;            }&#10;            composable(AppRoutes.Home.route) { HomeScreen(navController = navController) }&#10;            composable(AppRoutes.Profile.route) { ProfileScreen(navController = navController) }&#10;            composable(AppRoutes.Payments.route) { PaymentsScreen() }&#10;            composable(AppRoutes.Transport.route) { TransportScreen() }&#10;            composable(AppRoutes.Notes.route) {&#10;                if (isDocente) {&#10;                    com.example.appcolegios.academico.TeacherNotesScreen(navController = navController)&#10;                } else {&#10;                    NotesScreen()&#10;                }&#10;            }&#10;            composable(AppRoutes.Attendance.route) { AttendanceScreen() }&#10;            composable(AppRoutes.Announcements.route) { AnnouncementsScreen(navController) }&#10;            composable(AppRoutes.Tasks.route) { TasksScreen() }&#10;            // Ruta para calificar (Cursos -&gt; Estudiantes -&gt; Notas)&#10;            composable(AppRoutes.Grading.route) { com.example.appcolegios.academico.GradingScreen() }&#10;            composable(AppRoutes.Notifications.route) { NotificationsScreen(navController = navController) }&#10;            composable(AppRoutes.Messages.route) { ConversationsScreen(navController = navController) }&#10;            composable(AppRoutes.Calendar.route) { CalendarScreen() }&#10;            composable(AppRoutes.Schedule.route) { ScheduleScreen() }&#10;            composable(AppRoutes.Admin.route) { AdminScreen(navController) }&#10;            composable(AppRoutes.AdminUsers.route) { AdminUsersScreen(onUserSelected = { uid -&gt;&#10;                // navegar a gestión de horario del usuario seleccionado&#10;                navController.navigate(com.example.appcolegios.navigation.AppRoutes.AdminScheduleManage.route.replace(&quot;{userId}&quot;, uid))&#10;            }) }&#10;            composable(AppRoutes.AdminEventCreate.route) { com.example.appcolegios.admin.AdminEventCreateScreen(navController)&#10;            }&#10;            composable(AppRoutes.TeacherHome.route) { TeacherHomeScreen(navController) }&#10;            composable(AppRoutes.StudentHome.route) { StudentHomeScreen(navController = navController) }&#10;            // Ruta Ubicación del colegio&#10;            composable(AppRoutes.Ubicacion.route) { UbicacionScreen() }&#10;            composable(&#10;                route = AppRoutes.Chat.route,&#10;                arguments = listOf(navArgument(&quot;otherUserId&quot;) { type = NavType.StringType })&#10;            ) { backStackEntry2 -&gt;&#10;                val otherUserId = backStackEntry2.arguments?.getString(&quot;otherUserId&quot;) ?: &quot;&quot;&#10;                ChatScreen(navController = navController, otherUserId = otherUserId)&#10;            }&#10;            composable(AppRoutes.NewMessage.route) {&#10;                NewMessageScreen(&#10;                    onUserSelected = { userId -&gt;&#10;                        navController.navigate(&quot;chat/$userId&quot;)&#10;                    },&#10;                    onBack = { navController.popBackStack() }&#10;                )&#10;            }&#10;            composable(AppRoutes.VerifyEmail.route) {&#10;                VerifyEmailScreen(onDone = { navController.navigate(AppRoutes.Splash.route) {&#10;                    popUpTo(0) { inclusive = true }&#10;                } }, onVerified = { dest -&gt;&#10;                    navController.navigate(dest) {&#10;                        popUpTo(0) { inclusive = true }&#10;                    }&#10;                })&#10;            }&#10;            composable(AppRoutes.Dashboard.route) { DashboardScreen() }&#10;            composable(&#10;                route = com.example.appcolegios.navigation.AppRoutes.AdminScheduleManage.route,&#10;                arguments = listOf(navArgument(&quot;userId&quot;) { type = NavType.StringType; defaultValue = &quot;&quot; })&#10;            ) { backStackEntry -&gt;&#10;                val uid = backStackEntry.arguments?.getString(&quot;userId&quot;)&#10;                com.example.appcolegios.admin.AdminScheduleManageScreen(userIdArg = uid, onDone = { navController.popBackStack() })&#10;            }&#10;            composable(&#10;                route = AppRoutes.CalendarEvent.route,&#10;                arguments = listOf(navArgument(&quot;eventId&quot;) { type = NavType.StringType })&#10;            ) { backStackEntry -&gt;&#10;                val eid = backStackEntry.arguments?.getString(&quot;eventId&quot;) ?: &quot;&quot;&#10;                CalendarScreen(eventId = eid)&#10;            }&#10;        }&#10;    }&#10;&#10;    if (!showChrome) {&#10;        // Rutas de auth/splash sin chrome&#10;        content()&#10;    } else {&#10;        // Drawer lateral funcional con opciones&#10;        ModalNavigationDrawer(&#10;            drawerState = drawerState,&#10;            drawerContent = {&#10;                ModalDrawerSheet {&#10;                    Spacer(Modifier.height(12.dp))&#10;                    Text(&#10;                        &quot;Menú&quot;,&#10;                        modifier = Modifier.padding(16.dp),&#10;                        style = MaterialTheme.typography.titleLarge&#10;                    )&#10;                    HorizontalDivider()&#10;&#10;                    // Opción Home / Admin&#10;                    if (isAdmin) {&#10;                        // Drawer item para administradores: ir a Admin&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.Home, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.panel_admin)) },&#10;                            selected = currentDestination?.route == AppRoutes.Admin.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Admin.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;                    } else {&#10;                        // Opción Home para usuarios no-admin (restaurada: menú completo)&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.Home, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.home)) },&#10;                            selected = currentDestination?.route == AppRoutes.Home.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Home.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Mensajes&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.AutoMirrored.Filled.Message, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.messages)) },&#10;                            selected = currentDestination?.route == AppRoutes.Messages.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Messages.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Notificaciones&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.Notifications, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.notifications)) },&#10;                            selected = currentDestination?.route == AppRoutes.Notifications.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Notifications.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Pagos&#10;                        if (!isStudent &amp;&amp; !isDocente) {&#10;                            NavigationDrawerItem(&#10;                                icon = { Icon(Icons.Filled.CreditCard, contentDescription = null) },&#10;                                label = { Text(stringResource(R.string.payments)) },&#10;                                selected = currentDestination?.route == AppRoutes.Payments.route,&#10;                                onClick = {&#10;                                    scope.launch { drawerState.close() }&#10;                                    navController.navigate(AppRoutes.Payments.route) {&#10;                                        launchSingleTop = true&#10;                                        restoreState = true&#10;                                    }&#10;                                },&#10;                                modifier = Modifier.padding(horizontal = 12.dp)&#10;                            )&#10;                        }&#10;&#10;                        // Transporte&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.DirectionsBus, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.transporte)) },&#10;                            selected = currentDestination?.route == AppRoutes.Transport.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Transport.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Notas&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.School, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.notes)) },&#10;                            selected = currentDestination?.route == AppRoutes.Notes.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Notes.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Asistencia&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.AutoMirrored.Filled.Assignment, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.attendance)) },&#10;                            selected = currentDestination?.route == AppRoutes.Attendance.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Attendance.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Tareas&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.AutoMirrored.Filled.EventNote, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.tasks)) },&#10;                            selected = currentDestination?.route == AppRoutes.Tasks.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Tasks.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Calendario&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.CalendarToday, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.calendar)) },&#10;                            selected = currentDestination?.route == AppRoutes.Calendar.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Calendar.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;                    }&#10;&#10;                    // Opciones comunes: Perfil y Cerrar sesión&#10;                    NavigationDrawerItem(&#10;                        icon = { Icon(Icons.Filled.Person, contentDescription = null) },&#10;                        label = { Text(stringResource(R.string.profile)) },&#10;                        selected = currentDestination?.route == AppRoutes.Profile.route,&#10;                        onClick = {&#10;                            scope.launch { drawerState.close() }&#10;                            navController.navigate(AppRoutes.Profile.route) {&#10;                                launchSingleTop = true&#10;                                restoreState = true&#10;                            }&#10;                        },&#10;                        modifier = Modifier.padding(horizontal = 12.dp)&#10;                    )&#10;&#10;                    // Logout&#10;                    NavigationDrawerItem(&#10;                        icon = { Icon(Icons.AutoMirrored.Filled.Logout, contentDescription = null) },&#10;                        label = { Text(stringResource(R.string.logout)) },&#10;                        selected = false,&#10;                        onClick = {&#10;                            scope.launch { drawerState.close() }&#10;                            // limpiar datos locales y lanzar actividad de login para cerrar sesión&#10;                            scope.launch {&#10;                                try {&#10;                                    userPrefs.clearAllUserData()&#10;                                } catch (_: Exception) {}&#10;                                val activity = context as? Activity&#10;                                val intent = Intent(context, LoginActivity::class.java)&#10;                                context.startActivity(intent)&#10;                                activity?.finish()&#10;                            }&#10;                        },&#10;                        modifier = Modifier.padding(horizontal = 12.dp)&#10;                    )&#10;                }&#10;            }&#10;        ) {&#10;            Scaffold(&#10;                topBar = {&#10;                    var overflowOpen by androidx.compose.runtime.remember { androidx.compose.runtime.mutableStateOf(false) }&#10;                    CenterAlignedTopAppBar(&#10;                        title = {&#10;                            Text(&#10;                                when (currentDestination?.route) {&#10;                                    AppRoutes.Home.route -&gt; stringResource(R.string.home)&#10;                                    AppRoutes.Messages.route -&gt; stringResource(R.string.messages)&#10;                                    AppRoutes.Notifications.route -&gt; stringResource(R.string.notifications)&#10;                                    AppRoutes.Profile.route -&gt; stringResource(R.string.profile)&#10;                                    AppRoutes.Payments.route -&gt; stringResource(R.string.payments)&#10;                                    AppRoutes.Transport.route -&gt; stringResource(R.string.transporte)&#10;                                    AppRoutes.Notes.route -&gt; stringResource(R.string.notes)&#10;                                    AppRoutes.Attendance.route -&gt; stringResource(R.string.attendance)&#10;                                    AppRoutes.Tasks.route -&gt; stringResource(R.string.tasks)&#10;                                    AppRoutes.Calendar.route -&gt; stringResource(R.string.calendar)&#10;                                    AppRoutes.TeacherHome.route -&gt; stringResource(R.string.home)&#10;                                    AppRoutes.StudentHome.route -&gt; stringResource(R.string.home)&#10;                                    AppRoutes.Admin.route -&gt; stringResource(R.string.panel_admin)&#10;                                    AppRoutes.Dashboard.route -&gt; stringResource(R.string.dashboard)&#10;                                    else -&gt; stringResource(R.string.app_name)&#10;                                }&#10;                            )&#10;                        },&#10;                        navigationIcon = {&#10;                            // Ícono de menú que abre el drawer&#10;                            IconButton(onClick = { scope.launch { drawerState.open() } }) {&#10;                                Icon(Icons.Filled.Menu, contentDescription = &quot;Menú&quot;)&#10;                            }&#10;                        },&#10;                        actions = {&#10;                            // Notificaciones con badge&#10;                            IconButton(onClick = { navController.navigate(AppRoutes.Notifications.route) }) {&#10;                                BadgedBox(badge = {&#10;                                    if (notifCount &gt; 0) {&#10;                                        Badge { Text(if (notifCount &gt; 99) &quot;99+&quot; else notifCount.toString()) }&#10;                                    }&#10;                                }) {&#10;                                    Icon(Icons.Filled.Notifications, contentDescription = &quot;Notificaciones&quot;)&#10;                                }&#10;                            }&#10;                            // Overflow con accesos: Perfil, Pagos, Calendario y Dashboard (admin)&#10;                            IconButton(onClick = { overflowOpen = true }) {&#10;                                Icon(Icons.Filled.MoreVert, contentDescription = &quot;Más opciones&quot;)&#10;                            }&#10;                            DropdownMenu(expanded = overflowOpen, onDismissRequest = { overflowOpen = false }) {&#10;                                DropdownMenuItem(text = { Text(stringResource(R.string.profile)) }, onClick = {&#10;                                    overflowOpen = false&#10;                                    navController.navigate(AppRoutes.Profile.route)&#10;                                })&#10;                                if (!isStudent &amp;&amp; !isDocente) {&#10;                                    DropdownMenuItem(text = { Text(stringResource(R.string.payments)) }, onClick = {&#10;                                        overflowOpen = false&#10;                                        navController.navigate(AppRoutes.Payments.route)&#10;                                    })&#10;                                }&#10;                                DropdownMenuItem(text = { Text(stringResource(R.string.calendar)) }, onClick = {&#10;                                    overflowOpen = false&#10;                                    navController.navigate(AppRoutes.Calendar.route)&#10;                                })&#10;                                // El menú overflow ya no muestra &quot;Dashboard&quot; para evitar duplicado&#10;                                // (la opción Dashboard permanece en el drawer lateral para administradores)&#10;                            }&#10;                        },&#10;                        colors = TopAppBarDefaults.centerAlignedTopAppBarColors(&#10;                            containerColor = MaterialTheme.colorScheme.primaryContainer,&#10;                            titleContentColor = MaterialTheme.colorScheme.onPrimaryContainer,&#10;                            navigationIconContentColor = MaterialTheme.colorScheme.onPrimaryContainer,&#10;                            actionIconContentColor = MaterialTheme.colorScheme.onPrimaryContainer&#10;                        )&#10;                    )&#10;                },&#10;                bottomBar = {&#10;                    NavigationBar(containerColor = MaterialTheme.colorScheme.surface) {&#10;                        bottomItems.forEach { item -&gt;&#10;                            val selected = currentDestination?.hierarchy?.any { it.route == item.route } == true&#10;                            val scale by animateFloatAsState(targetValue = if (selected) 1f else 0.95f, label = &quot;nav_icon_scale&quot;)&#10;                            NavigationBarItem(&#10;                                selected = selected,&#10;                                onClick = {&#10;                                    // Navegación directa al destino (simple y confiable para evitar problemas desde Admin)&#10;                                    navController.navigate(item.route) {&#10;                                        launchSingleTop = true&#10;                                        restoreState = true&#10;                                    }&#10;                                },&#10;                                icon = {&#10;                                    val iconModifier = Modifier.graphicsLayer(scaleX = scale, scaleY = scale)&#10;                                    when (item.route) {&#10;                                        AppRoutes.Notifications.route -&gt; {&#10;                                            BadgedBox(badge = {&#10;                                                if (notifCount &gt; 0) {&#10;                                                    Badge { Text(if (notifCount &gt; 99) &quot;99+&quot; else notifCount.toString()) }&#10;                                                }&#10;                                            }) { Icon(item.icon, contentDescription = item.label, modifier = iconModifier) }&#10;                                        }&#10;                                        AppRoutes.Messages.route -&gt; {&#10;                                            BadgedBox(badge = {&#10;                                                if (msgCount &gt; 0) {&#10;                                                    Badge { Text(if (msgCount &gt; 99) &quot;99+&quot; else msgCount.toString()) }&#10;                                                }&#10;                                            }) { Icon(item.icon, contentDescription = item.label, modifier = iconModifier) }&#10;                                        }&#10;                                        else -&gt; Icon(item.icon, contentDescription = item.label, modifier = iconModifier)&#10;                                    }&#10;                                },&#10;                                label = { Text(item.label) }&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;            ) { innerPadding -&gt;&#10;                Box(Modifier.padding(innerPadding)) {&#10;                    content()&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;private data class BottomItem(val label: String, val route: String, val icon: androidx.compose.ui.graphics.vector.ImageVector)&#10;" />
              <option name="updatedContent" value="@file:OptIn(ExperimentalMaterial3Api::class)&#10;&#10;package com.example.appcolegios.navigation&#10;&#10;import android.app.Activity&#10;import android.content.Intent&#10;import androidx.compose.animation.core.animateFloatAsState&#10;import androidx.compose.foundation.layout.Box&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.foundation.layout.Spacer&#10;import androidx.compose.foundation.layout.height&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.filled.Message&#10;import androidx.compose.material.icons.automirrored.filled.Logout&#10;import androidx.compose.material.icons.filled.Home&#10;import androidx.compose.material.icons.filled.Menu&#10;import androidx.compose.material.icons.filled.Notifications&#10;import androidx.compose.material.icons.filled.Person&#10;import androidx.compose.material.icons.filled.MoreVert&#10;import androidx.compose.material.icons.filled.CreditCard&#10;import androidx.compose.material.icons.filled.DirectionsBus&#10;import androidx.compose.material.icons.filled.School&#10;import androidx.compose.material.icons.automirrored.filled.Assignment&#10;import androidx.compose.material.icons.automirrored.filled.EventNote&#10;import androidx.compose.material.icons.filled.CalendarToday&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.LaunchedEffect&#10;import androidx.compose.runtime.collectAsState&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.setValue&#10;import androidx.compose.runtime.rememberCoroutineScope&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.graphicsLayer&#10;import androidx.compose.ui.res.stringResource&#10;import androidx.compose.ui.unit.dp&#10;import androidx.navigation.NavDestination.Companion.hierarchy&#10;import androidx.navigation.compose.NavHost&#10;import androidx.navigation.compose.composable&#10;import androidx.navigation.compose.currentBackStackEntryAsState&#10;import androidx.navigation.compose.rememberNavController&#10;import com.example.appcolegios.R&#10;import com.example.appcolegios.academico.AttendanceScreen&#10;import com.example.appcolegios.academico.AnnouncementsScreen&#10;import com.example.appcolegios.academico.CalendarScreen&#10;import com.example.appcolegios.academico.ScheduleScreen&#10;import com.example.appcolegios.academico.NotesScreen&#10;import com.example.appcolegios.academico.TasksScreen&#10;import com.example.appcolegios.auth.LoginActivity&#10;import com.example.appcolegios.auth.RegisterScreen&#10;import com.example.appcolegios.auth.ResetPasswordScreen&#10;import com.example.appcolegios.auth.SplashScreen&#10;import com.example.appcolegios.home.HomeScreen&#10;import com.example.appcolegios.dashboard.DashboardScreen&#10;import com.example.appcolegios.mensajes.ChatScreen&#10;import com.example.appcolegios.mensajes.ConversationsScreen&#10;import com.example.appcolegios.mensajes.NewMessageScreen&#10;import com.example.appcolegios.notificaciones.NotificationsScreen&#10;import com.example.appcolegios.pagos.PaymentsScreen&#10;import com.example.appcolegios.perfil.ProfileScreen&#10;import com.example.appcolegios.transporte.TransportScreen&#10;import com.example.appcolegios.admin.AdminScreen&#10;import com.example.appcolegios.admin.AdminUsersScreen&#10;import com.example.appcolegios.ubicacion.UbicacionScreen&#10;import kotlinx.coroutines.launch&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.lifecycle.viewmodel.compose.viewModel&#10;import com.example.appcolegios.data.UserPreferencesRepository&#10;import androidx.navigation.NavType&#10;import androidx.navigation.navArgument&#10;import android.widget.Toast&#10;import com.example.appcolegios.auth.VerifyEmailScreen&#10;import com.example.appcolegios.teacher.TeacherHomeScreen&#10;import com.example.appcolegios.student.StudentHomeScreen&#10;&#10;@Composable&#10;fun AppNavigation(&#10;    startDestination: String = AppRoutes.Splash.route,&#10;    initialRole: String? = null,&#10;    unreadNotificationsCount: Int = 0,&#10;    unreadMessagesCount: Int = 0&#10;) {&#10;    val navController = rememberNavController()&#10;    val backStackEntry = navController.currentBackStackEntryAsState().value&#10;    val currentDestination = backStackEntry?.destination&#10;&#10;    // Mostrar chrome en todas las rutas salvo pantallas de auth/splash&#10;    val authlessRoutes = setOf(&#10;        AppRoutes.Splash.route,&#10;        AppRoutes.Login.route,&#10;        AppRoutes.Register.route,&#10;        AppRoutes.VerifyEmail.route,&#10;        AppRoutes.ResetPassword.route&#10;    )&#10;&#10;    val showChrome = currentDestination?.route !in authlessRoutes&#10;&#10;    val drawerState = rememberDrawerState(DrawerValue.Closed)&#10;    val scope = rememberCoroutineScope()&#10;&#10;    val context = LocalContext.current&#10;    val userPrefs = UserPreferencesRepository(context)&#10;    val userData = userPrefs.userData.collectAsState(initial = com.example.appcolegios.data.UserData(null, null, null)).value&#10;    // Preferir el role inyectado (initialRole) para evitar condiciones de carrera; si no está, usar el de prefs&#10;    val roleString = if (!initialRole.isNullOrBlank()) initialRole else (userData.role ?: &quot;&quot; )&#10;    val isAdmin = roleString.equals(&quot;ADMIN&quot;, ignoreCase = true)&#10;    val isDocente = roleString.equals(&quot;DOCENTE&quot;, ignoreCase = true)&#10;    val isStudent = roleString.equals(&quot;ESTUDIANTE&quot;, ignoreCase = true)&#10;&#10;    val bottomItems = if (isAdmin) {&#10;        listOf(&#10;            // Para admin, Inicio debe llevar al Home (pantalla de inicio que muestra todas las opciones admin)&#10;            BottomItem(stringResource(R.string.home), AppRoutes.Home.route, Icons.Filled.Home),&#10;            BottomItem(stringResource(R.string.profile), AppRoutes.Profile.route, Icons.Filled.Person)&#10;        )&#10;    } else {&#10;        listOf(&#10;            BottomItem(stringResource(R.string.home), AppRoutes.Home.route, Icons.Filled.Home),&#10;            BottomItem(stringResource(R.string.messages), AppRoutes.Messages.route, Icons.AutoMirrored.Filled.Message),&#10;            BottomItem(stringResource(R.string.notifications), AppRoutes.Notifications.route, Icons.Filled.Notifications),&#10;            BottomItem(stringResource(R.string.schedule), AppRoutes.Schedule.route, Icons.Filled.CalendarToday),&#10;            BottomItem(stringResource(R.string.profile), AppRoutes.Profile.route, Icons.Filled.Person)&#10;        )&#10;    }&#10;&#10;    // Badges en tiempo real desde Firestore&#10;    val badgesVm: BadgesViewModel = viewModel()&#10;    val badgesState = badgesVm.state.collectAsState().value&#10;&#10;    val notifCount = if (badgesState.unreadNotifications &gt; 0) badgesState.unreadNotifications else unreadNotificationsCount&#10;    val msgCount = if (badgesState.unreadMessages &gt; 0) badgesState.unreadMessages else unreadMessagesCount&#10;&#10;    val content: @Composable () -&gt; Unit = {&#10;        NavHost(navController = navController, startDestination = startDestination) {&#10;            composable(AppRoutes.Splash.route) { SplashScreen(navController) }&#10;            composable(AppRoutes.Login.route) {&#10;                val localContext = LocalContext.current&#10;                LaunchedEffect(Unit) {&#10;                    val intent = Intent(localContext, LoginActivity::class.java)&#10;                    localContext.startActivity(intent)&#10;                    if (localContext is Activity) {&#10;                        localContext.finish()&#10;                    }&#10;                }&#10;                // Puedes mostrar una pantalla vacía o de carga mientras se lanza la actividad&#10;                Box(modifier = Modifier.fillMaxSize()) {}&#10;            }&#10;            composable(AppRoutes.Register.route) {&#10;                RegisterScreen(&#10;                    onRegisterSuccess = {&#10;                        // Mostrar mensaje de éxito y navegar a verificación de correo&#10;                        Toast.makeText(context, &quot;Registro exitoso. Verifica tu correo.&quot;, Toast.LENGTH_SHORT).show()&#10;                        navController.navigate(AppRoutes.VerifyEmail.route) {&#10;                            popUpTo(0) { inclusive = true }&#10;                        }&#10;                    },&#10;                    onNavigateToLogin = { navController.popBackStack() }&#10;                )&#10;            }&#10;            // Nueva ruta para registro desde Admin (solo crea documento en Firestore)&#10;            composable(AppRoutes.RegisterAdmin.route) {&#10;                RegisterScreen(&#10;                    onRegisterSuccess = {&#10;                        Toast.makeText(context, &quot;Usuario creado correctamente&quot;, Toast.LENGTH_SHORT).show()&#10;                        // Al crear desde admin solo volver al home del admin&#10;                        navController.navigate(AppRoutes.Home.route) {&#10;                            popUpTo(0) { inclusive = true }&#10;                        }&#10;                    },&#10;                    onNavigateToLogin = { navController.popBackStack() },&#10;                    createOnly = true&#10;                )&#10;            }&#10;            composable(AppRoutes.ResetPassword.route) {&#10;                ResetPasswordScreen(&#10;                    onPasswordResetSent = { navController.popBackStack() },&#10;                    onNavigateToLogin = { navController.popBackStack() }&#10;                )&#10;            }&#10;            composable(AppRoutes.Home.route) { HomeScreen(navController = navController) }&#10;            composable(AppRoutes.Profile.route) { ProfileScreen(navController = navController) }&#10;            composable(AppRoutes.Payments.route) { PaymentsScreen() }&#10;            composable(AppRoutes.Transport.route) { TransportScreen() }&#10;            composable(AppRoutes.Notes.route) {&#10;                if (isDocente) {&#10;                    com.example.appcolegios.academico.TeacherNotesScreen(navController = navController)&#10;                } else {&#10;                    NotesScreen()&#10;                }&#10;            }&#10;            composable(AppRoutes.Attendance.route) { AttendanceScreen() }&#10;            composable(AppRoutes.Announcements.route) { AnnouncementsScreen(navController) }&#10;            composable(AppRoutes.Tasks.route) { TasksScreen() }&#10;            // Ruta para calificar (Cursos -&gt; Estudiantes -&gt; Notas)&#10;            composable(AppRoutes.Grading.route) { com.example.appcolegios.academico.GradingScreen() }&#10;            composable(AppRoutes.Notifications.route) { NotificationsScreen(navController = navController) }&#10;            composable(AppRoutes.Messages.route) { ConversationsScreen(navController = navController) }&#10;            composable(AppRoutes.Calendar.route) { CalendarScreen() }&#10;            composable(AppRoutes.Schedule.route) { ScheduleScreen() }&#10;            composable(AppRoutes.Admin.route) { AdminScreen(navController) }&#10;            composable(AppRoutes.AdminUsers.route) { AdminUsersScreen(onUserSelected = { uid -&gt;&#10;                // navegar a gestión de horario del usuario seleccionado&#10;                navController.navigate(com.example.appcolegios.navigation.AppRoutes.AdminScheduleManage.route.replace(&quot;{userId}&quot;, uid))&#10;            }) }&#10;            composable(&#10;                route = com.example.appcolegios.navigation.AppRoutes.AdminProfileDetail.route,&#10;                arguments = listOf(navArgument(&quot;userId&quot;) { type = NavType.StringType })&#10;            ) { backStackEntry -&gt;&#10;                val uid = backStackEntry.arguments?.getString(&quot;userId&quot;) ?: &quot;&quot;&#10;                com.example.appcolegios.admin.AdminProfileDetailScreen(navController, uid)&#10;            }&#10;            composable(AppRoutes.AdminEventCreate.route) { com.example.appcolegios.admin.AdminEventCreateScreen(navController)&#10;            }&#10;            composable(AppRoutes.TeacherHome.route) { TeacherHomeScreen(navController) }&#10;            composable(AppRoutes.StudentHome.route) { StudentHomeScreen(navController = navController) }&#10;            // Ruta Ubicación del colegio&#10;            composable(AppRoutes.Ubicacion.route) { UbicacionScreen() }&#10;            composable(&#10;                route = AppRoutes.Chat.route,&#10;                arguments = listOf(navArgument(&quot;otherUserId&quot;) { type = NavType.StringType })&#10;            ) { backStackEntry2 -&gt;&#10;                val otherUserId = backStackEntry2.arguments?.getString(&quot;otherUserId&quot;) ?: &quot;&quot;&#10;                ChatScreen(navController = navController, otherUserId = otherUserId)&#10;            }&#10;            composable(AppRoutes.NewMessage.route) {&#10;                NewMessageScreen(&#10;                    onUserSelected = { userId -&gt;&#10;                        navController.navigate(&quot;chat/$userId&quot;)&#10;                    },&#10;                    onBack = { navController.popBackStack() }&#10;                )&#10;            }&#10;            composable(AppRoutes.VerifyEmail.route) {&#10;                VerifyEmailScreen(onDone = { navController.navigate(AppRoutes.Splash.route) {&#10;                    popUpTo(0) { inclusive = true }&#10;                } }, onVerified = { dest -&gt;&#10;                    navController.navigate(dest) {&#10;                        popUpTo(0) { inclusive = true }&#10;                    }&#10;                })&#10;            }&#10;            composable(AppRoutes.Dashboard.route) { DashboardScreen() }&#10;            composable(&#10;                route = com.example.appcolegios.navigation.AppRoutes.AdminScheduleManage.route,&#10;                arguments = listOf(navArgument(&quot;userId&quot;) { type = NavType.StringType; defaultValue = &quot;&quot; })&#10;            ) { backStackEntry -&gt;&#10;                val uid = backStackEntry.arguments?.getString(&quot;userId&quot;)&#10;                com.example.appcolegios.admin.AdminScheduleManageScreen(userIdArg = uid, onDone = { navController.popBackStack() })&#10;            }&#10;            composable(&#10;                route = AppRoutes.CalendarEvent.route,&#10;                arguments = listOf(navArgument(&quot;eventId&quot;) { type = NavType.StringType })&#10;            ) { backStackEntry -&gt;&#10;                val eid = backStackEntry.arguments?.getString(&quot;eventId&quot;) ?: &quot;&quot;&#10;                CalendarScreen(eventId = eid)&#10;            }&#10;        }&#10;    }&#10;&#10;    if (!showChrome) {&#10;        // Rutas de auth/splash sin chrome&#10;        content()&#10;    } else {&#10;        // Drawer lateral funcional con opciones&#10;        ModalNavigationDrawer(&#10;            drawerState = drawerState,&#10;            drawerContent = {&#10;                ModalDrawerSheet {&#10;                    Spacer(Modifier.height(12.dp))&#10;                    Text(&#10;                        &quot;Menú&quot;,&#10;                        modifier = Modifier.padding(16.dp),&#10;                        style = MaterialTheme.typography.titleLarge&#10;                    )&#10;                    HorizontalDivider()&#10;&#10;                    // Opción Home / Admin&#10;                    if (isAdmin) {&#10;                        // Drawer item para administradores: ir a Admin&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.Home, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.panel_admin)) },&#10;                            selected = currentDestination?.route == AppRoutes.Admin.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Admin.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;                    } else {&#10;                        // Opción Home para usuarios no-admin (restaurada: menú completo)&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.Home, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.home)) },&#10;                            selected = currentDestination?.route == AppRoutes.Home.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Home.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Mensajes&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.AutoMirrored.Filled.Message, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.messages)) },&#10;                            selected = currentDestination?.route == AppRoutes.Messages.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Messages.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Notificaciones&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.Notifications, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.notifications)) },&#10;                            selected = currentDestination?.route == AppRoutes.Notifications.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Notifications.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Pagos&#10;                        if (!isStudent &amp;&amp; !isDocente) {&#10;                            NavigationDrawerItem(&#10;                                icon = { Icon(Icons.Filled.CreditCard, contentDescription = null) },&#10;                                label = { Text(stringResource(R.string.payments)) },&#10;                                selected = currentDestination?.route == AppRoutes.Payments.route,&#10;                                onClick = {&#10;                                    scope.launch { drawerState.close() }&#10;                                    navController.navigate(AppRoutes.Payments.route) {&#10;                                        launchSingleTop = true&#10;                                        restoreState = true&#10;                                    }&#10;                                },&#10;                                modifier = Modifier.padding(horizontal = 12.dp)&#10;                            )&#10;                        }&#10;&#10;                        // Transporte&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.DirectionsBus, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.transporte)) },&#10;                            selected = currentDestination?.route == AppRoutes.Transport.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Transport.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Notas&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.School, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.notes)) },&#10;                            selected = currentDestination?.route == AppRoutes.Notes.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Notes.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Asistencia&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.AutoMirrored.Filled.Assignment, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.attendance)) },&#10;                            selected = currentDestination?.route == AppRoutes.Attendance.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Attendance.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Tareas&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.AutoMirrored.Filled.EventNote, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.tasks)) },&#10;                            selected = currentDestination?.route == AppRoutes.Tasks.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Tasks.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Calendario&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.CalendarToday, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.calendar)) },&#10;                            selected = currentDestination?.route == AppRoutes.Calendar.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Calendar.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;                    }&#10;&#10;                    // Opciones comunes: Perfil y Cerrar sesión&#10;                    NavigationDrawerItem(&#10;                        icon = { Icon(Icons.Filled.Person, contentDescription = null) },&#10;                        label = { Text(stringResource(R.string.profile)) },&#10;                        selected = currentDestination?.route == AppRoutes.Profile.route,&#10;                        onClick = {&#10;                            scope.launch { drawerState.close() }&#10;                            navController.navigate(AppRoutes.Profile.route) {&#10;                                launchSingleTop = true&#10;                                restoreState = true&#10;                            }&#10;                        },&#10;                        modifier = Modifier.padding(horizontal = 12.dp)&#10;                    )&#10;&#10;                    // Logout&#10;                    NavigationDrawerItem(&#10;                        icon = { Icon(Icons.AutoMirrored.Filled.Logout, contentDescription = null) },&#10;                        label = { Text(stringResource(R.string.logout)) },&#10;                        selected = false,&#10;                        onClick = {&#10;                            scope.launch { drawerState.close() }&#10;                            // limpiar datos locales y lanzar actividad de login para cerrar sesión&#10;                            scope.launch {&#10;                                try {&#10;                                    userPrefs.clearAllUserData()&#10;                                } catch (_: Exception) {}&#10;                                val activity = context as? Activity&#10;                                val intent = Intent(context, LoginActivity::class.java)&#10;                                context.startActivity(intent)&#10;                                activity?.finish()&#10;                            }&#10;                        },&#10;                        modifier = Modifier.padding(horizontal = 12.dp)&#10;                    )&#10;                }&#10;            }&#10;        ) {&#10;            Scaffold(&#10;                topBar = {&#10;                    var overflowOpen by androidx.compose.runtime.remember { androidx.compose.runtime.mutableStateOf(false) }&#10;                    CenterAlignedTopAppBar(&#10;                        title = {&#10;                            Text(&#10;                                when (currentDestination?.route) {&#10;                                    AppRoutes.Home.route -&gt; stringResource(R.string.home)&#10;                                    AppRoutes.Messages.route -&gt; stringResource(R.string.messages)&#10;                                    AppRoutes.Notifications.route -&gt; stringResource(R.string.notifications)&#10;                                    AppRoutes.Profile.route -&gt; stringResource(R.string.profile)&#10;                                    AppRoutes.Payments.route -&gt; stringResource(R.string.payments)&#10;                                    AppRoutes.Transport.route -&gt; stringResource(R.string.transporte)&#10;                                    AppRoutes.Notes.route -&gt; stringResource(R.string.notes)&#10;                                    AppRoutes.Attendance.route -&gt; stringResource(R.string.attendance)&#10;                                    AppRoutes.Tasks.route -&gt; stringResource(R.string.tasks)&#10;                                    AppRoutes.Calendar.route -&gt; stringResource(R.string.calendar)&#10;                                    AppRoutes.TeacherHome.route -&gt; stringResource(R.string.home)&#10;                                    AppRoutes.StudentHome.route -&gt; stringResource(R.string.home)&#10;                                    AppRoutes.Admin.route -&gt; stringResource(R.string.panel_admin)&#10;                                    AppRoutes.Dashboard.route -&gt; stringResource(R.string.dashboard)&#10;                                    else -&gt; stringResource(R.string.app_name)&#10;                                }&#10;                            )&#10;                        },&#10;                        navigationIcon = {&#10;                            // Ícono de menú que abre el drawer&#10;                            IconButton(onClick = { scope.launch { drawerState.open() } }) {&#10;                                Icon(Icons.Filled.Menu, contentDescription = &quot;Menú&quot;)&#10;                            }&#10;                        },&#10;                        actions = {&#10;                            // Notificaciones con badge&#10;                            IconButton(onClick = { navController.navigate(AppRoutes.Notifications.route) }) {&#10;                                BadgedBox(badge = {&#10;                                    if (notifCount &gt; 0) {&#10;                                        Badge { Text(if (notifCount &gt; 99) &quot;99+&quot; else notifCount.toString()) }&#10;                                    }&#10;                                }) {&#10;                                    Icon(Icons.Filled.Notifications, contentDescription = &quot;Notificaciones&quot;)&#10;                                }&#10;                            }&#10;                            // Overflow con accesos: Perfil, Pagos, Calendario y Dashboard (admin)&#10;                            IconButton(onClick = { overflowOpen = true }) {&#10;                                Icon(Icons.Filled.MoreVert, contentDescription = &quot;Más opciones&quot;)&#10;                            }&#10;                            DropdownMenu(expanded = overflowOpen, onDismissRequest = { overflowOpen = false }) {&#10;                                DropdownMenuItem(text = { Text(stringResource(R.string.profile)) }, onClick = {&#10;                                    overflowOpen = false&#10;                                    navController.navigate(AppRoutes.Profile.route)&#10;                                })&#10;                                if (!isStudent &amp;&amp; !isDocente) {&#10;                                    DropdownMenuItem(text = { Text(stringResource(R.string.payments)) }, onClick = {&#10;                                        overflowOpen = false&#10;                                        navController.navigate(AppRoutes.Payments.route)&#10;                                    })&#10;                                }&#10;                                DropdownMenuItem(text = { Text(stringResource(R.string.calendar)) }, onClick = {&#10;                                    overflowOpen = false&#10;                                    navController.navigate(AppRoutes.Calendar.route)&#10;                                })&#10;                                // El menú overflow ya no muestra &quot;Dashboard&quot; para evitar duplicado&#10;                                // (la opción Dashboard permanece en el drawer lateral para administradores)&#10;                            }&#10;                        },&#10;                        colors = TopAppBarDefaults.centerAlignedTopAppBarColors(&#10;                            containerColor = MaterialTheme.colorScheme.primaryContainer,&#10;                            titleContentColor = MaterialTheme.colorScheme.onPrimaryContainer,&#10;                            navigationIconContentColor = MaterialTheme.colorScheme.onPrimaryContainer,&#10;                            actionIconContentColor = MaterialTheme.colorScheme.onPrimaryContainer&#10;                        )&#10;                    )&#10;                },&#10;                bottomBar = {&#10;                    NavigationBar(containerColor = MaterialTheme.colorScheme.surface) {&#10;                        bottomItems.forEach { item -&gt;&#10;                            val selected = currentDestination?.hierarchy?.any { it.route == item.route } == true&#10;                            val scale by animateFloatAsState(targetValue = if (selected) 1f else 0.95f, label = &quot;nav_icon_scale&quot;)&#10;                            NavigationBarItem(&#10;                                selected = selected,&#10;                                onClick = {&#10;                                    // Navegación directa al destino (simple y confiable para evitar problemas desde Admin)&#10;                                    navController.navigate(item.route) {&#10;                                        launchSingleTop = true&#10;                                        restoreState = true&#10;                                    }&#10;                                },&#10;                                icon = {&#10;                                    val iconModifier = Modifier.graphicsLayer(scaleX = scale, scaleY = scale)&#10;                                    when (item.route) {&#10;                                        AppRoutes.Notifications.route -&gt; {&#10;                                            BadgedBox(badge = {&#10;                                                if (notifCount &gt; 0) {&#10;                                                    Badge { Text(if (notifCount &gt; 99) &quot;99+&quot; else notifCount.toString()) }&#10;                                                }&#10;                                            }) { Icon(item.icon, contentDescription = item.label, modifier = iconModifier) }&#10;                                        }&#10;                                        AppRoutes.Messages.route -&gt; {&#10;                                            BadgedBox(badge = {&#10;                                                if (msgCount &gt; 0) {&#10;                                                    Badge { Text(if (msgCount &gt; 99) &quot;99+&quot; else msgCount.toString()) }&#10;                                                }&#10;                                            }) { Icon(item.icon, contentDescription = item.label, modifier = iconModifier) }&#10;                                        }&#10;                                        else -&gt; Icon(item.icon, contentDescription = item.label, modifier = iconModifier)&#10;                                    }&#10;                                },&#10;                                label = { Text(item.label) }&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;            ) { innerPadding -&gt;&#10;                Box(Modifier.padding(innerPadding)) {&#10;                    content()&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;private data class BottomItem(val label: String, val route: String, val icon: androidx.compose.ui.graphics.vector.ImageVector)" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/navigation/AppRoutes.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/navigation/AppRoutes.kt" />
              <option name="originalContent" value="package com.example.appcolegios.navigation&#10;&#10;sealed class AppRoutes(val route: String) {&#10;    object Splash : AppRoutes(&quot;splash&quot;)&#10;    object Login : AppRoutes(&quot;login&quot;)&#10;    object Register : AppRoutes(&quot;register&quot;)&#10;    object RegisterAdmin : AppRoutes(&quot;register_admin&quot;)&#10;    object ResetPassword : AppRoutes(&quot;reset_password&quot;)&#10;    object Home : AppRoutes(&quot;home&quot;)&#10;    object Profile : AppRoutes(&quot;profile&quot;)&#10;    object Payments : AppRoutes(&quot;payments&quot;)&#10;    object Transport : AppRoutes(&quot;transport&quot;)&#10;    object Notes : AppRoutes(&quot;notes&quot;)&#10;    object Attendance : AppRoutes(&quot;attendance&quot;)&#10;    object Announcements : AppRoutes(&quot;announcements&quot;)&#10;    object Tasks : AppRoutes(&quot;tasks&quot;)&#10;    object Notifications : AppRoutes(&quot;notifications&quot;)&#10;    object Messages : AppRoutes(&quot;messages&quot;)&#10;    object Calendar : AppRoutes(&quot;calendar&quot;)&#10;    object Schedule : AppRoutes(&quot;schedule&quot;)&#10;    object Admin : AppRoutes(&quot;admin&quot;)&#10;    object Dashboard : AppRoutes(&quot;dashboard&quot;)&#10;    object TeacherHome : AppRoutes(&quot;teacher_home&quot;)&#10;    object Grading : AppRoutes(&quot;grading&quot;)&#10;    object StudentHome : AppRoutes(&quot;student_home&quot;)&#10;    object VerifyEmail : AppRoutes(&quot;verify_email&quot;)&#10;    object Chat : AppRoutes(&quot;chat/{otherUserId}&quot;)&#10;    object NewMessage : AppRoutes(&quot;new_message&quot;)&#10;    object Ubicacion : AppRoutes(&quot;ubicacion&quot;)&#10;&#10;    // Admin helpers&#10;    object AdminUsers : AppRoutes(&quot;admin_users&quot;)&#10;    object AdminScheduleManage : AppRoutes(&quot;admin_schedule/{userId}&quot;)&#10;    object AdminEventCreate : AppRoutes(&quot;admin_event_create&quot;)&#10;&#10;    // Calendar deep link to open specific event&#10;    object CalendarEvent : AppRoutes(&quot;calendar/{eventId}&quot;)&#10;}&#10;" />
              <option name="updatedContent" value="package com.example.appcolegios.navigation&#10;&#10;sealed class AppRoutes(val route: String) {&#10;    object Splash : AppRoutes(&quot;splash&quot;)&#10;    object Login : AppRoutes(&quot;login&quot;)&#10;    object Register : AppRoutes(&quot;register&quot;)&#10;    object RegisterAdmin : AppRoutes(&quot;register_admin&quot;)&#10;    object ResetPassword : AppRoutes(&quot;reset_password&quot;)&#10;    object Home : AppRoutes(&quot;home&quot;)&#10;    object Profile : AppRoutes(&quot;profile&quot;)&#10;    object Payments : AppRoutes(&quot;payments&quot;)&#10;    object Transport : AppRoutes(&quot;transport&quot;)&#10;    object Notes : AppRoutes(&quot;notes&quot;)&#10;    object Attendance : AppRoutes(&quot;attendance&quot;)&#10;    object Announcements : AppRoutes(&quot;announcements&quot;)&#10;    object Tasks : AppRoutes(&quot;tasks&quot;)&#10;    object Notifications : AppRoutes(&quot;notifications&quot;)&#10;    object Messages : AppRoutes(&quot;messages&quot;)&#10;    object Calendar : AppRoutes(&quot;calendar&quot;)&#10;    object Schedule : AppRoutes(&quot;schedule&quot;)&#10;    object Admin : AppRoutes(&quot;admin&quot;)&#10;    object Dashboard : AppRoutes(&quot;dashboard&quot;)&#10;    object TeacherHome : AppRoutes(&quot;teacher_home&quot;)&#10;    object Grading : AppRoutes(&quot;grading&quot;)&#10;    object StudentHome : AppRoutes(&quot;student_home&quot;)&#10;    object VerifyEmail : AppRoutes(&quot;verify_email&quot;)&#10;    object Chat : AppRoutes(&quot;chat/{otherUserId}&quot;)&#10;    object NewMessage : AppRoutes(&quot;new_message&quot;)&#10;    object Ubicacion : AppRoutes(&quot;ubicacion&quot;)&#10;&#10;    // Admin helpers&#10;    object AdminUsers : AppRoutes(&quot;admin_users&quot;)&#10;    object AdminScheduleManage : AppRoutes(&quot;admin_schedule/{userId}&quot;)&#10;    object AdminEventCreate : AppRoutes(&quot;admin_event_create&quot;)&#10;    object AdminProfileDetail : AppRoutes(&quot;admin_profile/{userId}&quot;)&#10;&#10;    // Calendar deep link to open specific event&#10;    object CalendarEvent : AppRoutes(&quot;calendar/{eventId}&quot;)&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/ui/AnimatedMaterialButton.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/ui/AnimatedMaterialButton.kt" />
              <option name="updatedContent" value="package com.example.appcolegios.ui&#10;&#10;import android.content.Context&#10;import android.util.AttributeSet&#10;import android.view.MotionEvent&#10;import com.google.android.material.button.MaterialButton&#10;&#10;class AnimatedMaterialButton @JvmOverloads constructor(&#10;    context: Context,&#10;    attrs: AttributeSet? = null,&#10;    defStyleAttr: Int = com.google.android.material.R.attr.materialButtonStyle&#10;) : MaterialButton(context, attrs, defStyleAttr) {&#10;&#10;    override fun onTouchEvent(event: MotionEvent): Boolean {&#10;        when (event.action) {&#10;            MotionEvent.ACTION_DOWN -&gt; {&#10;                this.animate().scaleX(0.97f).scaleY(0.97f).setDuration(50).start()&#10;            }&#10;            MotionEvent.ACTION_UP, MotionEvent.ACTION_CANCEL -&gt; {&#10;                this.animate().scaleX(1f).scaleY(1f).setDuration(50).start()&#10;            }&#10;        }&#10;        return super.onTouchEvent(event)&#10;    }&#10;}" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/anim/fade_in.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/anim/fade_in.xml" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;alpha xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    android:duration=&quot;300&quot;&#10;    android:fromAlpha=&quot;0.0&quot;&#10;    android:toAlpha=&quot;1.0&quot; /&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/res/layout/activity_attendance.xml">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/res/layout/activity_attendance.xml" />
              <option name="originalContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#10;&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#10;    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;&#10;    android:orientation=&quot;vertical&quot;&#10;    android:layout_width=&quot;match_parent&quot;&#10;    android:layout_height=&quot;match_parent&quot;&#10;    android:background=&quot;@color/background&quot;&gt;&#10;&#10;    &lt;!-- Toolbar/Header --&gt;&#10;    &lt;com.google.android.material.appbar.AppBarLayout&#10;        android:layout_width=&quot;match_parent&quot;&#10;        android:layout_height=&quot;wrap_content&quot;&#10;        android:background=&quot;@color/primary&quot;&gt;&#10;&#10;        &lt;androidx.appcompat.widget.Toolbar&#10;            android:id=&quot;@+id/toolbar&quot;&#10;            android:layout_width=&quot;match_parent&quot;&#10;            android:layout_height=&quot;?attr/actionBarSize&quot;&#10;            android:background=&quot;@color/primary&quot;&#10;            app:title=&quot;@string/attendance&quot;&#10;            app:titleTextColor=&quot;@color/on_primary&quot; /&gt;&#10;&#10;    &lt;/com.google.android.material.appbar.AppBarLayout&gt;&#10;&#10;    &lt;!-- Card con resumen de asistencia --&gt;&#10;    &lt;com.google.android.material.card.MaterialCardView&#10;        android:layout_width=&quot;match_parent&quot;&#10;        android:layout_height=&quot;wrap_content&quot;&#10;        android:layout_margin=&quot;16dp&quot;&#10;        app:cardBackgroundColor=&quot;@color/surface&quot;&#10;        app:cardElevation=&quot;4dp&quot;&#10;        app:cardCornerRadius=&quot;16dp&quot;&gt;&#10;&#10;        &lt;LinearLayout&#10;            android:orientation=&quot;vertical&quot;&#10;            android:layout_width=&quot;match_parent&quot;&#10;            android:layout_height=&quot;wrap_content&quot;&#10;            android:padding=&quot;16dp&quot;&gt;&#10;&#10;            &lt;TextView&#10;                android:layout_width=&quot;wrap_content&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:text=&quot;Porcentaje de asistencia&quot;&#10;                android:textSize=&quot;16sp&quot;&#10;                android:textColor=&quot;@color/on_surface_variant&quot; /&gt;&#10;&#10;            &lt;TextView&#10;                android:id=&quot;@+id/attendancePercentageText&quot;&#10;                android:layout_width=&quot;wrap_content&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:text=&quot;95%&quot;&#10;                android:textSize=&quot;32sp&quot;&#10;                android:textStyle=&quot;bold&quot;&#10;                android:textColor=&quot;@color/primary&quot;&#10;                android:layout_marginTop=&quot;8dp&quot; /&gt;&#10;&#10;            &lt;!-- Leyenda --&gt;&#10;            &lt;LinearLayout&#10;                android:orientation=&quot;horizontal&quot;&#10;                android:layout_width=&quot;match_parent&quot;&#10;                android:layout_height=&quot;wrap_content&quot;&#10;                android:layout_marginTop=&quot;16dp&quot;&gt;&#10;&#10;                &lt;TextView&#10;                    android:layout_width=&quot;wrap_content&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:text=&quot;✅ Presente&quot;&#10;                    android:textSize=&quot;14sp&quot;&#10;                    android:layout_marginEnd=&quot;16dp&quot; /&gt;&#10;&#10;                &lt;TextView&#10;                    android:layout_width=&quot;wrap_content&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:text=&quot;❌ Ausente&quot;&#10;                    android:textSize=&quot;14sp&quot;&#10;                    android:layout_marginEnd=&quot;16dp&quot; /&gt;&#10;&#10;                &lt;TextView&#10;                    android:layout_width=&quot;wrap_content&quot;&#10;                    android:layout_height=&quot;wrap_content&quot;&#10;                    android:text=&quot;⚠️ Tarde&quot;&#10;                    android:textSize=&quot;14sp&quot; /&gt;&#10;&#10;            &lt;/LinearLayout&gt;&#10;&#10;        &lt;/LinearLayout&gt;&#10;&#10;    &lt;/com.google.android.material.card.MaterialCardView&gt;&#10;&#10;    &lt;!-- Selector de mes --&gt;&#10;    &lt;LinearLayout&#10;        android:orientation=&quot;horizontal&quot;&#10;        android:layout_width=&quot;match_parent&quot;&#10;        android:layout_height=&quot;wrap_content&quot;&#10;        android:gravity=&quot;center&quot;&#10;        android:padding=&quot;8dp&quot;&gt;&#10;&#10;        &lt;com.google.android.material.button.MaterialButton&#10;            android:id=&quot;@+id/previousMonthButton&quot;&#10;            android:layout_width=&quot;wrap_content&quot;&#10;            android:layout_height=&quot;wrap_content&quot;&#10;            android:text=&quot;◀&quot;&#10;            style=&quot;@style/Widget.Material3.Button.TextButton&quot; /&gt;&#10;&#10;        &lt;TextView&#10;            android:id=&quot;@+id/currentMonthText&quot;&#10;            android:layout_width=&quot;0dp&quot;&#10;            android:layout_height=&quot;wrap_content&quot;&#10;            android:layout_weight=&quot;1&quot;&#10;            android:text=&quot;Octubre 2025&quot;&#10;            android:textSize=&quot;18sp&quot;&#10;            android:textStyle=&quot;bold&quot;&#10;            android:textColor=&quot;@color/on_background&quot;&#10;            android:gravity=&quot;center&quot; /&gt;&#10;&#10;        &lt;com.google.android.material.button.MaterialButton&#10;            android:id=&quot;@+id/nextMonthButton&quot;&#10;            android:layout_width=&quot;wrap_content&quot;&#10;            android:layout_height=&quot;wrap_content&quot;&#10;            android:text=&quot;▶&quot;&#10;            style=&quot;@style/Widget.Material3.Button.TextButton&quot; /&gt;&#10;&#10;    &lt;/LinearLayout&gt;&#10;&#10;    &lt;!-- RecyclerView para días --&gt;&#10;    &lt;androidx.recyclerview.widget.RecyclerView&#10;        android:id=&quot;@+id/attendanceRecyclerView&quot;&#10;        android:layout_width=&quot;match_parent&quot;&#10;        android:layout_height=&quot;0dp&quot;&#10;        android:layout_weight=&quot;1&quot;&#10;        android:padding=&quot;8dp&quot;&#10;        android:clipToPadding=&quot;false&quot; /&gt;&#10;&#10;    &lt;!-- Progress bar --&gt;&#10;    &lt;ProgressBar&#10;        android:id=&quot;@+id/progressBar&quot;&#10;        android:layout_width=&quot;wrap_content&quot;&#10;        android:layout_height=&quot;wrap_content&quot;&#10;        android:layout_gravity=&quot;center&quot;&#10;        android:visibility=&quot;gone&quot; /&gt;&#10;&#10;&lt;/LinearLayout&gt;&#10;" />
              <option name="updatedContent" value="&lt;?xml version=&quot;1.0&quot; encoding=&quot;utf-8&quot;?&gt;&#13;&#10;&lt;LinearLayout xmlns:android=&quot;http://schemas.android.com/apk/res/android&quot;&#13;&#10;    xmlns:app=&quot;http://schemas.android.com/apk/res-auto&quot;&#13;&#10;    android:orientation=&quot;vertical&quot;&#13;&#10;    android:layout_width=&quot;match_parent&quot;&#13;&#10;    android:layout_height=&quot;match_parent&quot;&#13;&#10;    android:background=&quot;@color/background&quot;&gt;&#13;&#10;&#13;&#10;    &lt;!-- Toolbar/Header --&gt;&#13;&#10;    &lt;com.google.android.material.appbar.AppBarLayout&#13;&#10;        android:layout_width=&quot;match_parent&quot;&#13;&#10;        android:layout_height=&quot;wrap_content&quot;&#13;&#10;        android:background=&quot;@color/primary&quot;&gt;&#13;&#10;&#13;&#10;        &lt;androidx.appcompat.widget.Toolbar&#13;&#10;            android:id=&quot;@+id/toolbar&quot;&#13;&#10;            android:layout_width=&quot;match_parent&quot;&#13;&#10;            android:layout_height=&quot;?attr/actionBarSize&quot;&#13;&#10;            android:background=&quot;@color/primary&quot;&#13;&#10;            app:title=&quot;@string/attendance&quot;&#13;&#10;            app:titleTextColor=&quot;@color/on_primary&quot; /&gt;&#13;&#10;&#13;&#10;    &lt;/com.google.android.material.appbar.AppBarLayout&gt;&#13;&#10;&#13;&#10;    &lt;!-- Card con resumen de asistencia --&gt;&#13;&#10;    &lt;com.google.android.material.card.MaterialCardView&#13;&#10;        android:layout_width=&quot;match_parent&quot;&#13;&#10;        android:layout_height=&quot;wrap_content&quot;&#13;&#10;        android:layout_margin=&quot;16dp&quot;&#13;&#10;        app:cardBackgroundColor=&quot;@color/surface&quot;&#13;&#10;        app:cardElevation=&quot;4dp&quot;&#13;&#10;        app:cardCornerRadius=&quot;16dp&quot;&gt;&#13;&#10;&#13;&#10;        &lt;LinearLayout&#13;&#10;            android:orientation=&quot;vertical&quot;&#13;&#10;            android:layout_width=&quot;match_parent&quot;&#13;&#10;            android:layout_height=&quot;wrap_content&quot;&#13;&#10;            android:padding=&quot;16dp&quot;&gt;&#13;&#10;&#13;&#10;            &lt;TextView&#13;&#10;                android:layout_width=&quot;wrap_content&quot;&#13;&#10;                android:layout_height=&quot;wrap_content&quot;&#13;&#10;                android:text=&quot;Porcentaje de asistencia&quot;&#13;&#10;                android:textSize=&quot;16sp&quot;&#13;&#10;                android:textColor=&quot;@color/on_surface_variant&quot; /&gt;&#13;&#10;&#13;&#10;            &lt;TextView&#13;&#10;                android:id=&quot;@+id/attendancePercentageText&quot;&#13;&#10;                android:layout_width=&quot;wrap_content&quot;&#13;&#10;                android:layout_height=&quot;wrap_content&quot;&#13;&#10;                android:text=&quot;95%&quot;&#13;&#10;                android:textSize=&quot;32sp&quot;&#13;&#10;                android:textStyle=&quot;bold&quot;&#13;&#10;                android:textColor=&quot;@color/primary&quot;&#13;&#10;                android:layout_marginTop=&quot;8dp&quot; /&gt;&#13;&#10;&#13;&#10;            &lt;!-- Leyenda --&gt;&#13;&#10;            &lt;LinearLayout&#13;&#10;                android:orientation=&quot;horizontal&quot;&#13;&#10;                android:layout_width=&quot;match_parent&quot;&#13;&#10;                android:layout_height=&quot;wrap_content&quot;&#13;&#10;                android:layout_marginTop=&quot;16dp&quot;&gt;&#13;&#10;&#13;&#10;                &lt;TextView&#13;&#10;                    android:layout_width=&quot;wrap_content&quot;&#13;&#10;                    android:layout_height=&quot;wrap_content&quot;&#13;&#10;                    android:text=&quot;✅ Presente&quot;&#13;&#10;                    android:textSize=&quot;14sp&quot;&#13;&#10;                    android:layout_marginEnd=&quot;16dp&quot; /&gt;&#13;&#10;&#13;&#10;                &lt;TextView&#13;&#10;                    android:layout_width=&quot;wrap_content&quot;&#13;&#10;                    android:layout_height=&quot;wrap_content&quot;&#13;&#10;                    android:text=&quot;❌ Ausente&quot;&#13;&#10;                    android:textSize=&quot;14sp&quot;&#13;&#10;                    android:layout_marginEnd=&quot;16dp&quot; /&gt;&#13;&#10;&#13;&#10;                &lt;TextView&#13;&#10;                    android:layout_width=&quot;wrap_content&quot;&#13;&#10;                    android:layout_height=&quot;wrap_content&quot;&#13;&#10;                    android:text=&quot;⚠️ Tarde&quot;&#13;&#10;                    android:textSize=&quot;14sp&quot; /&gt;&#13;&#10;&#13;&#10;            &lt;/LinearLayout&gt;&#13;&#10;&#13;&#10;        &lt;/LinearLayout&gt;&#13;&#10;&#13;&#10;    &lt;/com.google.android.material.card.MaterialCardView&gt;&#13;&#10;&#13;&#10;    &lt;!-- Selector de mes --&gt;&#13;&#10;    &lt;LinearLayout&#13;&#10;        android:orientation=&quot;horizontal&quot;&#13;&#10;        android:layout_width=&quot;match_parent&quot;&#13;&#10;        android:layout_height=&quot;wrap_content&quot;&#13;&#10;        android:gravity=&quot;center&quot;&#13;&#10;        android:padding=&quot;8dp&quot;&gt;&#13;&#10;&#13;&#10;        &lt;com.example.appcolegios.ui.AnimatedMaterialButton&#13;&#10;            android:id=&quot;@+id/previousMonthButton&quot;&#13;&#10;            android:layout_width=&quot;wrap_content&quot;&#13;&#10;            android:layout_height=&quot;wrap_content&quot;&#13;&#10;            android:text=&quot;◀&quot;&#13;&#10;            style=&quot;@style/Widget.Material3.Button.TextButton&quot; /&gt;&#13;&#10;&#13;&#10;        &lt;TextView&#13;&#10;            android:id=&quot;@+id/currentMonthText&quot;&#13;&#10;            android:layout_width=&quot;0dp&quot;&#13;&#10;            android:layout_height=&quot;wrap_content&quot;&#13;&#10;            android:layout_weight=&quot;1&quot;&#13;&#10;            android:text=&quot;Octubre 2025&quot;&#13;&#10;            android:textSize=&quot;18sp&quot;&#13;&#10;            android:textStyle=&quot;bold&quot;&#13;&#10;            android:textColor=&quot;@color/on_background&quot;&#13;&#10;            android:gravity=&quot;center&quot; /&gt;&#13;&#10;&#13;&#10;        &lt;com.example.appcolegios.ui.AnimatedMaterialButton&#13;&#10;            android:id=&quot;@+id/nextMonthButton&quot;&#13;&#10;            android:layout_width=&quot;wrap_content&quot;&#13;&#10;            android:layout_height=&quot;wrap_content&quot;&#13;&#10;            android:text=&quot;▶&quot;&#13;&#10;            style=&quot;@style/Widget.Material3.Button.TextButton&quot; /&gt;&#13;&#10;&#13;&#10;    &lt;/LinearLayout&gt;&#13;&#10;&#13;&#10;    &lt;!-- RecyclerView para días --&gt;&#13;&#10;    &lt;androidx.recyclerview.widget.RecyclerView&#13;&#10;        android:id=&quot;@+id/attendanceRecyclerView&quot;&#13;&#10;        android:layout_width=&quot;match_parent&quot;&#13;&#10;        android:layout_height=&quot;0dp&quot;&#13;&#10;        android:layout_weight=&quot;1&quot;&#13;&#10;        android:padding=&quot;8dp&quot;&#13;&#10;        android:clipToPadding=&quot;false&quot; /&gt;&#13;&#10;&#13;&#10;    &lt;!-- Progress bar --&gt;&#13;&#10;    &lt;ProgressBar&#13;&#10;        android:id=&quot;@+id/progressBar&quot;&#13;&#10;        android:layout_width=&quot;wrap_content&quot;&#13;&#10;        android:layout_height=&quot;wrap_content&quot;&#13;&#10;        android:layout_gravity=&quot;center&quot;&#13;&#10;        android:visibility=&quot;gone&quot; /&gt;&#13;&#10;&#13;&#10;&lt;/LinearLayout&gt;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>