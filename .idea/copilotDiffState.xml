<?xml version="1.0" encoding="UTF-8"?>
<project version="4">
  <component name="CopilotDiffPersistence">
    <option name="pendingDiffs">
      <map>
        <entry key="$PROJECT_DIR$/SOLUCION_DEFINITIVA.bat">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/SOLUCION_DEFINITIVA.bat" />
              <option name="updatedContent" value="@echo off&#10;echo ==========================================&#10;echo SOLUCION DEFINITIVA - ERROR GRADLE TASKS&#10;echo ==========================================&#10;cd /d &quot;%~dp0&quot;&#10;&#10;echo.&#10;echo Este script resolvera: &quot;Unable to find Gradle tasks to build&quot;&#10;echo.&#10;pause&#10;&#10;echo.&#10;echo [1/8] Cerrando Android Studio si esta abierto...&#10;echo Por favor, CIERRA Android Studio ahora si esta abierto.&#10;echo.&#10;pause&#10;&#10;echo.&#10;echo [2/8] Deteniendo procesos de Gradle...&#10;call gradlew.bat --stop&#10;timeout /t 3 /nobreak &gt; nul&#10;&#10;echo.&#10;echo [3/8] Eliminando cache del proyecto...&#10;if exist .gradle rmdir /s /q .gradle&#10;if exist .idea rmdir /s /q .idea&#10;if exist .kotlin rmdir /s /q .kotlin&#10;if exist build rmdir /s /q build&#10;if exist app\build rmdir /s /q app\build&#10;&#10;echo.&#10;echo [4/8] Eliminando archivos de configuracion del IDE...&#10;if exist *.iml del /q *.iml&#10;if exist app\*.iml del /q app\*.iml&#10;&#10;echo.&#10;echo [5/8] Limpiando con Gradle...&#10;call gradlew.bat clean&#10;&#10;echo.&#10;echo [6/8] Verificando estructura del proyecto...&#10;call gradlew.bat projects&#10;&#10;echo.&#10;echo [7/8] Listando tareas disponibles...&#10;call gradlew.bat tasks&#10;&#10;echo.&#10;echo [8/8] Compilando el proyecto...&#10;call gradlew.bat assembleDebug&#10;&#10;echo.&#10;echo ==========================================&#10;echo COMPLETADO!&#10;echo ==========================================&#10;echo.&#10;echo Ahora ABRE Android Studio y:&#10;echo 1. Abre este proyecto&#10;echo 2. File ^&gt; Sync Project with Gradle Files&#10;echo 3. Build ^&gt; Rebuild Project&#10;echo.&#10;echo El error deberia estar resuelto.&#10;echo ==========================================&#10;pause&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
        <entry key="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/navigation/AppNavigation.kt">
          <value>
            <PendingDiffInfo>
              <option name="filePath" value="$PROJECT_DIR$/app/src/main/java/com/example/appcolegios/navigation/AppNavigation.kt" />
              <option name="originalContent" value="@file:OptIn(ExperimentalMaterial3Api::class)&#10;&#10;package com.example.appcolegios.navigation&#10;&#10;import android.app.Activity&#10;import android.content.Intent&#10;import androidx.compose.animation.core.animateFloatAsState&#10;import androidx.compose.foundation.layout.Box&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.foundation.layout.Spacer&#10;import androidx.compose.foundation.layout.height&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.filled.Message&#10;import androidx.compose.material.icons.automirrored.filled.Logout&#10;import androidx.compose.material.icons.filled.Home&#10;import androidx.compose.material.icons.filled.Menu&#10;import androidx.compose.material.icons.filled.Notifications&#10;import androidx.compose.material.icons.filled.Person&#10;import androidx.compose.material.icons.filled.MoreVert&#10;import androidx.compose.material.icons.filled.CreditCard&#10;import androidx.compose.material.icons.filled.DirectionsBus&#10;import androidx.compose.material.icons.filled.School&#10;import androidx.compose.material.icons.automirrored.filled.Assignment&#10;import androidx.compose.material.icons.automirrored.filled.EventNote&#10;import androidx.compose.material.icons.filled.CalendarToday&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.LaunchedEffect&#10;import androidx.compose.runtime.collectAsState&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.setValue&#10;import androidx.compose.runtime.rememberCoroutineScope&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.graphicsLayer&#10;import androidx.compose.ui.res.stringResource&#10;import androidx.compose.ui.unit.dp&#10;import androidx.navigation.NavDestination.Companion.hierarchy&#10;import androidx.navigation.compose.NavHost&#10;import androidx.navigation.compose.composable&#10;import androidx.navigation.compose.currentBackStackEntryAsState&#10;import androidx.navigation.compose.rememberNavController&#10;import com.example.appcolegios.R&#10;import com.example.appcolegios.academico.AttendanceScreen&#10;import com.example.appcolegios.academico.AnnouncementsScreen&#10;import com.example.appcolegios.academico.CalendarScreen&#10;import com.example.appcolegios.academico.NotesScreen&#10;import com.example.appcolegios.academico.TasksScreen&#10;import com.example.appcolegios.auth.LoginActivity&#10;import com.example.appcolegios.auth.RegisterScreen&#10;import com.example.appcolegios.auth.ResetPasswordScreen&#10;import com.example.appcolegios.auth.SplashScreen&#10;import com.example.appcolegios.home.HomeScreen&#10;import com.example.appcolegios.dashboard.DashboardScreen&#10;import com.example.appcolegios.mensajes.ChatScreen&#10;import com.example.appcolegios.mensajes.ConversationsScreen&#10;import com.example.appcolegios.mensajes.NewMessageScreen&#10;import com.example.appcolegios.notificaciones.NotificationsScreen&#10;import com.example.appcolegios.pagos.PaymentsScreen&#10;import com.example.appcolegios.perfil.ProfileScreen&#10;import com.example.appcolegios.transporte.TransportScreen&#10;import com.example.appcolegios.admin.AdminScreen&#10;import com.example.appcolegios.ubicacion.UbicacionScreen&#10;import kotlinx.coroutines.launch&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.lifecycle.viewmodel.compose.viewModel&#10;import com.example.appcolegios.data.UserPreferencesRepository&#10;import androidx.navigation.NavType&#10;import androidx.navigation.navArgument&#10;import android.widget.Toast&#10;import com.example.appcolegios.auth.VerifyEmailScreen&#10;import com.example.appcolegios.teacher.TeacherHomeScreen&#10;import com.example.appcolegios.student.StudentHomeScreen&#10;&#10;@Composable&#10;fun AppNavigation(&#10;    startDestination: String = AppRoutes.Splash.route,&#10;    initialRole: String? = null,&#10;    unreadNotificationsCount: Int = 0,&#10;    unreadMessagesCount: Int = 0&#10;) {&#10;    val navController = rememberNavController()&#10;    val backStackEntry = navController.currentBackStackEntryAsState().value&#10;    val currentDestination = backStackEntry?.destination&#10;&#10;    // Mostrar chrome en todas las rutas salvo pantallas de auth/splash&#10;    val authlessRoutes = setOf(&#10;        AppRoutes.Splash.route,&#10;        AppRoutes.Login.route,&#10;        AppRoutes.Register.route,&#10;        AppRoutes.VerifyEmail.route,&#10;        AppRoutes.ResetPassword.route&#10;    )&#10;&#10;    val showChrome = currentDestination?.route !in authlessRoutes&#10;&#10;    val drawerState = rememberDrawerState(DrawerValue.Closed)&#10;    val scope = rememberCoroutineScope()&#10;&#10;    val context = LocalContext.current&#10;    val userPrefs = UserPreferencesRepository(context)&#10;    val userData = userPrefs.userData.collectAsState(initial = com.example.appcolegios.data.UserData(null, null, null)).value&#10;    // Preferir el role inyectado (initialRole) para evitar condiciones de carrera; si no está, usar el de prefs&#10;    val roleString = if (!initialRole.isNullOrBlank()) initialRole else (userData.role ?: &quot;&quot; )&#10;    val isAdmin = roleString.equals(&quot;ADMIN&quot;, ignoreCase = true)&#10;    val isDocente = roleString.equals(&quot;DOCENTE&quot;, ignoreCase = true)&#10;    val isStudent = roleString.equals(&quot;ESTUDIANTE&quot;, ignoreCase = true)&#10;&#10;    val bottomItems = if (isAdmin) {&#10;        listOf(&#10;            // Para admin, Inicio debe llevar al Home (pantalla de inicio que muestra todas las opciones admin)&#10;            BottomItem(stringResource(R.string.home), AppRoutes.Home.route, Icons.Filled.Home),&#10;            BottomItem(stringResource(R.string.profile), AppRoutes.Profile.route, Icons.Filled.Person)&#10;        )&#10;    } else {&#10;        listOf(&#10;            BottomItem(stringResource(R.string.home), AppRoutes.Home.route, Icons.Filled.Home),&#10;            BottomItem(stringResource(R.string.messages), AppRoutes.Messages.route, Icons.AutoMirrored.Filled.Message),&#10;            BottomItem(stringResource(R.string.notifications), AppRoutes.Notifications.route, Icons.Filled.Notifications),&#10;            BottomItem(stringResource(R.string.schedule), AppRoutes.Schedule.route, Icons.Filled.CalendarToday),&#10;            BottomItem(stringResource(R.string.profile), AppRoutes.Profile.route, Icons.Filled.Person)&#10;        )&#10;    }&#10;&#10;    // Badges en tiempo real desde Firestore&#10;    val badgesVm: BadgesViewModel = viewModel()&#10;    val badgesState = badgesVm.state.collectAsState().value&#10;&#10;    val notifCount = if (badgesState.unreadNotifications &gt; 0) badgesState.unreadNotifications else unreadNotificationsCount&#10;    val msgCount = if (badgesState.unreadMessages &gt; 0) badgesState.unreadMessages else unreadMessagesCount&#10;&#10;    val content: @Composable () -&gt; Unit = {&#10;        NavHost(navController = navController, startDestination = startDestination) {&#10;            composable(AppRoutes.Splash.route) { SplashScreen(navController) }&#10;            composable(AppRoutes.Login.route) {&#10;                val localContext = LocalContext.current&#10;                LaunchedEffect(Unit) {&#10;                    val intent = Intent(localContext, LoginActivity::class.java)&#10;                    localContext.startActivity(intent)&#10;                    if (localContext is Activity) {&#10;                        localContext.finish()&#10;                    }&#10;                }&#10;                // Puedes mostrar una pantalla vacía o de carga mientras se lanza la actividad&#10;                Box(modifier = Modifier.fillMaxSize()) {}&#10;            }&#10;            composable(AppRoutes.Register.route) {&#10;                RegisterScreen(&#10;                    onRegisterSuccess = {&#10;                        // Mostrar mensaje de éxito y navegar a verificación de correo&#10;                        Toast.makeText(context, &quot;Registro exitoso. Verifica tu correo.&quot;, Toast.LENGTH_SHORT).show()&#10;                        navController.navigate(AppRoutes.VerifyEmail.route) {&#10;                            popUpTo(0) { inclusive = true }&#10;                        }&#10;                    },&#10;                    onNavigateToLogin = { navController.popBackStack() }&#10;                )&#10;            }&#10;            // Nueva ruta para registro desde Admin (solo crea documento en Firestore)&#10;            composable(AppRoutes.RegisterAdmin.route) {&#10;                RegisterScreen(&#10;                    onRegisterSuccess = {&#10;                        Toast.makeText(context, &quot;Usuario creado correctamente&quot;, Toast.LENGTH_SHORT).show()&#10;                        // Al crear desde admin solo volver al home del admin&#10;                        navController.navigate(AppRoutes.Home.route) {&#10;                            popUpTo(0) { inclusive = true }&#10;                        }&#10;                    },&#10;                    onNavigateToLogin = { navController.popBackStack() },&#10;                    createOnly = true&#10;                )&#10;            }&#10;            composable(AppRoutes.ResetPassword.route) {&#10;                ResetPasswordScreen(&#10;                    onPasswordResetSent = { navController.popBackStack() },&#10;                    onNavigateToLogin = { navController.popBackStack() }&#10;                )&#10;            }&#10;            composable(AppRoutes.Home.route) { HomeScreen(navController = navController) }&#10;            composable(AppRoutes.Profile.route) { ProfileScreen() }&#10;            composable(AppRoutes.Payments.route) { PaymentsScreen() }&#10;            composable(AppRoutes.Transport.route) { TransportScreen() }&#10;            composable(AppRoutes.Notes.route) {&#10;                if (isDocente) {&#10;                    com.example.appcolegios.academico.TeacherNotesScreen(navController = navController)&#10;                } else {&#10;                    NotesScreen()&#10;                }&#10;            }&#10;            composable(AppRoutes.Attendance.route) { AttendanceScreen() }&#10;            composable(AppRoutes.Announcements.route) { AnnouncementsScreen(navController) }&#10;            composable(AppRoutes.Tasks.route) { TasksScreen() }&#10;            // Ruta para calificar (Cursos -&gt; Estudiantes -&gt; Notas)&#10;            composable(AppRoutes.Grading.route) { com.example.appcolegios.academico.GradingScreen() }&#10;            composable(AppRoutes.Notifications.route) { NotificationsScreen() }&#10;            composable(AppRoutes.Messages.route) { ConversationsScreen(navController = navController) }&#10;            composable(AppRoutes.Calendar.route) { CalendarScreen() }&#10;            composable(AppRoutes.Schedule.route) { ScheduleScreen() }&#10;            composable(AppRoutes.Admin.route) { AdminScreen() }&#10;            composable(AppRoutes.TeacherHome.route) { TeacherHomeScreen(navController) }&#10;            composable(AppRoutes.StudentHome.route) { StudentHomeScreen(navController = navController) }&#10;            // Ruta Ubicación del colegio&#10;            composable(AppRoutes.Ubicacion.route) { UbicacionScreen() }&#10;            composable(&#10;                route = AppRoutes.Chat.route,&#10;                arguments = listOf(navArgument(&quot;otherUserId&quot;) { type = NavType.StringType })&#10;            ) { backStackEntry2 -&gt;&#10;                val otherUserId = backStackEntry2.arguments?.getString(&quot;otherUserId&quot;) ?: &quot;&quot;&#10;                ChatScreen(navController = navController, otherUserId = otherUserId)&#10;            }&#10;            composable(AppRoutes.NewMessage.route) {&#10;                NewMessageScreen(&#10;                    onUserSelected = { userId -&gt;&#10;                        navController.navigate(&quot;chat/$userId&quot;)&#10;                    },&#10;                    onBack = { navController.popBackStack() }&#10;                )&#10;            }&#10;            composable(AppRoutes.VerifyEmail.route) {&#10;                VerifyEmailScreen(onDone = { navController.navigate(AppRoutes.Splash.route) {&#10;                    popUpTo(0) { inclusive = true }&#10;                } }, onVerified = { dest -&gt;&#10;                    navController.navigate(dest) {&#10;                        popUpTo(0) { inclusive = true }&#10;                    }&#10;                })&#10;            }&#10;            composable(AppRoutes.Dashboard.route) { DashboardScreen() }&#10;        }&#10;    }&#10;&#10;    if (!showChrome) {&#10;        // Rutas de auth/splash sin chrome&#10;        content()&#10;    } else {&#10;        // Drawer lateral funcional con opciones&#10;        ModalNavigationDrawer(&#10;            drawerState = drawerState,&#10;            drawerContent = {&#10;                ModalDrawerSheet {&#10;                    Spacer(Modifier.height(12.dp))&#10;                    Text(&#10;                        &quot;Menú&quot;,&#10;                        modifier = Modifier.padding(16.dp),&#10;                        style = MaterialTheme.typography.titleLarge&#10;                    )&#10;                    HorizontalDivider()&#10;&#10;                    // Opción Home / Admin&#10;                    if (isAdmin) {&#10;                        // Drawer item para administradores: ir a Admin&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.Home, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.panel_admin)) },&#10;                            selected = currentDestination?.route == AppRoutes.Admin.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Admin.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;                    } else {&#10;                        // Opción Home para usuarios no-admin (restaurada: menú completo)&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.Home, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.home)) },&#10;                            selected = currentDestination?.route == AppRoutes.Home.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Home.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Mensajes&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.AutoMirrored.Filled.Message, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.messages)) },&#10;                            selected = currentDestination?.route == AppRoutes.Messages.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Messages.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Notificaciones&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.Notifications, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.notifications)) },&#10;                            selected = currentDestination?.route == AppRoutes.Notifications.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Notifications.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Pagos&#10;                        if (!isStudent &amp;&amp; !isDocente) {&#10;                            NavigationDrawerItem(&#10;                                icon = { Icon(Icons.Filled.CreditCard, contentDescription = null) },&#10;                                label = { Text(stringResource(R.string.payments)) },&#10;                                selected = currentDestination?.route == AppRoutes.Payments.route,&#10;                                onClick = {&#10;                                    scope.launch { drawerState.close() }&#10;                                    navController.navigate(AppRoutes.Payments.route) {&#10;                                        launchSingleTop = true&#10;                                        restoreState = true&#10;                                    }&#10;                                },&#10;                                modifier = Modifier.padding(horizontal = 12.dp)&#10;                            )&#10;                        }&#10;&#10;                        // Transporte&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.DirectionsBus, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.transporte)) },&#10;                            selected = currentDestination?.route == AppRoutes.Transport.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Transport.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Notas&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.School, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.notes)) },&#10;                            selected = currentDestination?.route == AppRoutes.Notes.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Notes.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Asistencia&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.AutoMirrored.Filled.Assignment, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.attendance)) },&#10;                            selected = currentDestination?.route == AppRoutes.Attendance.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Attendance.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Tareas&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.AutoMirrored.Filled.EventNote, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.tasks)) },&#10;                            selected = currentDestination?.route == AppRoutes.Tasks.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Tasks.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Calendario&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.CalendarToday, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.calendar)) },&#10;                            selected = currentDestination?.route == AppRoutes.Calendar.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Calendar.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;                    }&#10;&#10;                    // Opciones comunes: Perfil y Cerrar sesión&#10;                    NavigationDrawerItem(&#10;                        icon = { Icon(Icons.Filled.Person, contentDescription = null) },&#10;                        label = { Text(stringResource(R.string.profile)) },&#10;                        selected = currentDestination?.route == AppRoutes.Profile.route,&#10;                        onClick = {&#10;                            scope.launch { drawerState.close() }&#10;                            navController.navigate(AppRoutes.Profile.route) {&#10;                                launchSingleTop = true&#10;                                restoreState = true&#10;                            }&#10;                        },&#10;                        modifier = Modifier.padding(horizontal = 12.dp)&#10;                    )&#10;&#10;                    // Logout&#10;                    NavigationDrawerItem(&#10;                        icon = { Icon(Icons.AutoMirrored.Filled.Logout, contentDescription = null) },&#10;                        label = { Text(stringResource(R.string.logout)) },&#10;                        selected = false,&#10;                        onClick = {&#10;                            scope.launch { drawerState.close() }&#10;                            // limpiar datos locales y lanzar actividad de login para cerrar sesión&#10;                            scope.launch {&#10;                                try {&#10;                                    userPrefs.clearAllUserData()&#10;                                } catch (_: Exception) {}&#10;                                val activity = context as? Activity&#10;                                val intent = Intent(context, LoginActivity::class.java)&#10;                                context.startActivity(intent)&#10;                                activity?.finish()&#10;                            }&#10;                        },&#10;                        modifier = Modifier.padding(horizontal = 12.dp)&#10;                    )&#10;                }&#10;            }&#10;        ) {&#10;            Scaffold(&#10;                topBar = {&#10;                    var overflowOpen by androidx.compose.runtime.remember { androidx.compose.runtime.mutableStateOf(false) }&#10;                    CenterAlignedTopAppBar(&#10;                        title = {&#10;                            Text(&#10;                                when (currentDestination?.route) {&#10;                                    AppRoutes.Home.route -&gt; stringResource(R.string.home)&#10;                                    AppRoutes.Messages.route -&gt; stringResource(R.string.messages)&#10;                                    AppRoutes.Notifications.route -&gt; stringResource(R.string.notifications)&#10;                                    AppRoutes.Profile.route -&gt; stringResource(R.string.profile)&#10;                                    AppRoutes.Payments.route -&gt; stringResource(R.string.payments)&#10;                                    AppRoutes.Transport.route -&gt; stringResource(R.string.transporte)&#10;                                    AppRoutes.Notes.route -&gt; stringResource(R.string.notes)&#10;                                    AppRoutes.Attendance.route -&gt; stringResource(R.string.attendance)&#10;                                    AppRoutes.Tasks.route -&gt; stringResource(R.string.tasks)&#10;                                    AppRoutes.Calendar.route -&gt; stringResource(R.string.calendar)&#10;                                    AppRoutes.TeacherHome.route -&gt; stringResource(R.string.home)&#10;                                    AppRoutes.StudentHome.route -&gt; stringResource(R.string.home)&#10;                                    AppRoutes.Admin.route -&gt; stringResource(R.string.panel_admin)&#10;                                    AppRoutes.Dashboard.route -&gt; stringResource(R.string.dashboard)&#10;                                    else -&gt; stringResource(R.string.app_name)&#10;                                }&#10;                            )&#10;                        },&#10;                        navigationIcon = {&#10;                            // Ícono de menú que abre el drawer&#10;                            IconButton(onClick = { scope.launch { drawerState.open() } }) {&#10;                                Icon(Icons.Filled.Menu, contentDescription = &quot;Menú&quot;)&#10;                            }&#10;                        },&#10;                        actions = {&#10;                            // Notificaciones con badge&#10;                            IconButton(onClick = { navController.navigate(AppRoutes.Notifications.route) }) {&#10;                                BadgedBox(badge = {&#10;                                    if (notifCount &gt; 0) {&#10;                                        Badge { Text(if (notifCount &gt; 99) &quot;99+&quot; else notifCount.toString()) }&#10;                                    }&#10;                                }) {&#10;                                    Icon(Icons.Filled.Notifications, contentDescription = &quot;Notificaciones&quot;)&#10;                                }&#10;                            }&#10;                            // Overflow con accesos: Perfil, Pagos, Calendario y Dashboard (admin)&#10;                            IconButton(onClick = { overflowOpen = true }) {&#10;                                Icon(Icons.Filled.MoreVert, contentDescription = &quot;Más opciones&quot;)&#10;                            }&#10;                            DropdownMenu(expanded = overflowOpen, onDismissRequest = { overflowOpen = false }) {&#10;                                DropdownMenuItem(text = { Text(stringResource(R.string.profile)) }, onClick = {&#10;                                    overflowOpen = false&#10;                                    navController.navigate(AppRoutes.Profile.route)&#10;                                })&#10;                                if (!isStudent &amp;&amp; !isDocente) {&#10;                                    DropdownMenuItem(text = { Text(stringResource(R.string.payments)) }, onClick = {&#10;                                        overflowOpen = false&#10;                                        navController.navigate(AppRoutes.Payments.route)&#10;                                    })&#10;                                }&#10;                                DropdownMenuItem(text = { Text(stringResource(R.string.calendar)) }, onClick = {&#10;                                    overflowOpen = false&#10;                                    navController.navigate(AppRoutes.Calendar.route)&#10;                                })&#10;                                // El menú overflow ya no muestra &quot;Dashboard&quot; para evitar duplicado&#10;                                // (la opción Dashboard permanece en el drawer lateral para administradores)&#10;                            }&#10;                        },&#10;                        colors = TopAppBarDefaults.centerAlignedTopAppBarColors(&#10;                            containerColor = MaterialTheme.colorScheme.primaryContainer,&#10;                            titleContentColor = MaterialTheme.colorScheme.onPrimaryContainer,&#10;                            navigationIconContentColor = MaterialTheme.colorScheme.onPrimaryContainer,&#10;                            actionIconContentColor = MaterialTheme.colorScheme.onPrimaryContainer&#10;                        )&#10;                    )&#10;                },&#10;                bottomBar = {&#10;                    NavigationBar(containerColor = MaterialTheme.colorScheme.surface) {&#10;                        bottomItems.forEach { item -&gt;&#10;                            val selected = currentDestination?.hierarchy?.any { it.route == item.route } == true&#10;                            val scale by animateFloatAsState(targetValue = if (selected) 1f else 0.95f, label = &quot;nav_icon_scale&quot;)&#10;                            NavigationBarItem(&#10;                                selected = selected,&#10;                                onClick = {&#10;                                    // Navegación directa al destino (simple y confiable para evitar problemas desde Admin)&#10;                                    navController.navigate(item.route) {&#10;                                        launchSingleTop = true&#10;                                        restoreState = true&#10;                                    }&#10;                                },&#10;                                icon = {&#10;                                    val iconModifier = Modifier.graphicsLayer(scaleX = scale, scaleY = scale)&#10;                                    when (item.route) {&#10;                                        AppRoutes.Notifications.route -&gt; {&#10;                                            BadgedBox(badge = {&#10;                                                if (notifCount &gt; 0) {&#10;                                                    Badge { Text(if (notifCount &gt; 99) &quot;99+&quot; else notifCount.toString()) }&#10;                                                }&#10;                                            }) { Icon(item.icon, contentDescription = item.label, modifier = iconModifier) }&#10;                                        }&#10;                                        AppRoutes.Messages.route -&gt; {&#10;                                            BadgedBox(badge = {&#10;                                                if (msgCount &gt; 0) {&#10;                                                    Badge { Text(if (msgCount &gt; 99) &quot;99+&quot; else msgCount.toString()) }&#10;                                                }&#10;                                            }) { Icon(item.icon, contentDescription = item.label, modifier = iconModifier) }&#10;                                        }&#10;                                        else -&gt; Icon(item.icon, contentDescription = item.label, modifier = iconModifier)&#10;                                    }&#10;                                },&#10;                                label = { Text(item.label) }&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;            ) { innerPadding -&gt;&#10;                Box(Modifier.padding(innerPadding)) {&#10;                    content()&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;private data class BottomItem(val label: String, val route: String, val icon: androidx.compose.ui.graphics.vector.ImageVector)&#10;" />
              <option name="updatedContent" value="@file:OptIn(ExperimentalMaterial3Api::class)&#10;&#10;package com.example.appcolegios.navigation&#10;&#10;import android.app.Activity&#10;import android.content.Intent&#10;import androidx.compose.animation.core.animateFloatAsState&#10;import androidx.compose.foundation.layout.Box&#10;import androidx.compose.foundation.layout.fillMaxSize&#10;import androidx.compose.foundation.layout.padding&#10;import androidx.compose.foundation.layout.Spacer&#10;import androidx.compose.foundation.layout.height&#10;import androidx.compose.material.icons.Icons&#10;import androidx.compose.material.icons.automirrored.filled.Message&#10;import androidx.compose.material.icons.automirrored.filled.Logout&#10;import androidx.compose.material.icons.filled.Home&#10;import androidx.compose.material.icons.filled.Menu&#10;import androidx.compose.material.icons.filled.Notifications&#10;import androidx.compose.material.icons.filled.Person&#10;import androidx.compose.material.icons.filled.MoreVert&#10;import androidx.compose.material.icons.filled.CreditCard&#10;import androidx.compose.material.icons.filled.DirectionsBus&#10;import androidx.compose.material.icons.filled.School&#10;import androidx.compose.material.icons.automirrored.filled.Assignment&#10;import androidx.compose.material.icons.automirrored.filled.EventNote&#10;import androidx.compose.material.icons.filled.CalendarToday&#10;import androidx.compose.material3.*&#10;import androidx.compose.runtime.Composable&#10;import androidx.compose.runtime.LaunchedEffect&#10;import androidx.compose.runtime.collectAsState&#10;import androidx.compose.runtime.getValue&#10;import androidx.compose.runtime.setValue&#10;import androidx.compose.runtime.rememberCoroutineScope&#10;import androidx.compose.ui.Modifier&#10;import androidx.compose.ui.graphics.graphicsLayer&#10;import androidx.compose.ui.res.stringResource&#10;import androidx.compose.ui.unit.dp&#10;import androidx.navigation.NavDestination.Companion.hierarchy&#10;import androidx.navigation.compose.NavHost&#10;import androidx.navigation.compose.composable&#10;import androidx.navigation.compose.currentBackStackEntryAsState&#10;import androidx.navigation.compose.rememberNavController&#10;import com.example.appcolegios.R&#10;import com.example.appcolegios.academico.AttendanceScreen&#10;import com.example.appcolegios.academico.AnnouncementsScreen&#10;import com.example.appcolegios.academico.CalendarScreen&#10;import com.example.appcolegios.academico.ScheduleScreen&#10;import com.example.appcolegios.academico.NotesScreen&#10;import com.example.appcolegios.academico.TasksScreen&#10;import com.example.appcolegios.auth.LoginActivity&#10;import com.example.appcolegios.auth.RegisterScreen&#10;import com.example.appcolegios.auth.ResetPasswordScreen&#10;import com.example.appcolegios.auth.SplashScreen&#10;import com.example.appcolegios.home.HomeScreen&#10;import com.example.appcolegios.dashboard.DashboardScreen&#10;import com.example.appcolegios.mensajes.ChatScreen&#10;import com.example.appcolegios.mensajes.ConversationsScreen&#10;import com.example.appcolegios.mensajes.NewMessageScreen&#10;import com.example.appcolegios.notificaciones.NotificationsScreen&#10;import com.example.appcolegios.pagos.PaymentsScreen&#10;import com.example.appcolegios.perfil.ProfileScreen&#10;import com.example.appcolegios.transporte.TransportScreen&#10;import com.example.appcolegios.admin.AdminScreen&#10;import com.example.appcolegios.ubicacion.UbicacionScreen&#10;import kotlinx.coroutines.launch&#10;import androidx.compose.ui.platform.LocalContext&#10;import androidx.lifecycle.viewmodel.compose.viewModel&#10;import com.example.appcolegios.data.UserPreferencesRepository&#10;import androidx.navigation.NavType&#10;import androidx.navigation.navArgument&#10;import android.widget.Toast&#10;import com.example.appcolegios.auth.VerifyEmailScreen&#10;import com.example.appcolegios.teacher.TeacherHomeScreen&#10;import com.example.appcolegios.student.StudentHomeScreen&#10;&#10;@Composable&#10;fun AppNavigation(&#10;    startDestination: String = AppRoutes.Splash.route,&#10;    initialRole: String? = null,&#10;    unreadNotificationsCount: Int = 0,&#10;    unreadMessagesCount: Int = 0&#10;) {&#10;    val navController = rememberNavController()&#10;    val backStackEntry = navController.currentBackStackEntryAsState().value&#10;    val currentDestination = backStackEntry?.destination&#10;&#10;    // Mostrar chrome en todas las rutas salvo pantallas de auth/splash&#10;    val authlessRoutes = setOf(&#10;        AppRoutes.Splash.route,&#10;        AppRoutes.Login.route,&#10;        AppRoutes.Register.route,&#10;        AppRoutes.VerifyEmail.route,&#10;        AppRoutes.ResetPassword.route&#10;    )&#10;&#10;    val showChrome = currentDestination?.route !in authlessRoutes&#10;&#10;    val drawerState = rememberDrawerState(DrawerValue.Closed)&#10;    val scope = rememberCoroutineScope()&#10;&#10;    val context = LocalContext.current&#10;    val userPrefs = UserPreferencesRepository(context)&#10;    val userData = userPrefs.userData.collectAsState(initial = com.example.appcolegios.data.UserData(null, null, null)).value&#10;    // Preferir el role inyectado (initialRole) para evitar condiciones de carrera; si no está, usar el de prefs&#10;    val roleString = if (!initialRole.isNullOrBlank()) initialRole else (userData.role ?: &quot;&quot; )&#10;    val isAdmin = roleString.equals(&quot;ADMIN&quot;, ignoreCase = true)&#10;    val isDocente = roleString.equals(&quot;DOCENTE&quot;, ignoreCase = true)&#10;    val isStudent = roleString.equals(&quot;ESTUDIANTE&quot;, ignoreCase = true)&#10;&#10;    val bottomItems = if (isAdmin) {&#10;        listOf(&#10;            // Para admin, Inicio debe llevar al Home (pantalla de inicio que muestra todas las opciones admin)&#10;            BottomItem(stringResource(R.string.home), AppRoutes.Home.route, Icons.Filled.Home),&#10;            BottomItem(stringResource(R.string.profile), AppRoutes.Profile.route, Icons.Filled.Person)&#10;        )&#10;    } else {&#10;        listOf(&#10;            BottomItem(stringResource(R.string.home), AppRoutes.Home.route, Icons.Filled.Home),&#10;            BottomItem(stringResource(R.string.messages), AppRoutes.Messages.route, Icons.AutoMirrored.Filled.Message),&#10;            BottomItem(stringResource(R.string.notifications), AppRoutes.Notifications.route, Icons.Filled.Notifications),&#10;            BottomItem(stringResource(R.string.schedule), AppRoutes.Schedule.route, Icons.Filled.CalendarToday),&#10;            BottomItem(stringResource(R.string.profile), AppRoutes.Profile.route, Icons.Filled.Person)&#10;        )&#10;    }&#10;&#10;    // Badges en tiempo real desde Firestore&#10;    val badgesVm: BadgesViewModel = viewModel()&#10;    val badgesState = badgesVm.state.collectAsState().value&#10;&#10;    val notifCount = if (badgesState.unreadNotifications &gt; 0) badgesState.unreadNotifications else unreadNotificationsCount&#10;    val msgCount = if (badgesState.unreadMessages &gt; 0) badgesState.unreadMessages else unreadMessagesCount&#10;&#10;    val content: @Composable () -&gt; Unit = {&#10;        NavHost(navController = navController, startDestination = startDestination) {&#10;            composable(AppRoutes.Splash.route) { SplashScreen(navController) }&#10;            composable(AppRoutes.Login.route) {&#10;                val localContext = LocalContext.current&#10;                LaunchedEffect(Unit) {&#10;                    val intent = Intent(localContext, LoginActivity::class.java)&#10;                    localContext.startActivity(intent)&#10;                    if (localContext is Activity) {&#10;                        localContext.finish()&#10;                    }&#10;                }&#10;                // Puedes mostrar una pantalla vacía o de carga mientras se lanza la actividad&#10;                Box(modifier = Modifier.fillMaxSize()) {}&#10;            }&#10;            composable(AppRoutes.Register.route) {&#10;                RegisterScreen(&#10;                    onRegisterSuccess = {&#10;                        // Mostrar mensaje de éxito y navegar a verificación de correo&#10;                        Toast.makeText(context, &quot;Registro exitoso. Verifica tu correo.&quot;, Toast.LENGTH_SHORT).show()&#10;                        navController.navigate(AppRoutes.VerifyEmail.route) {&#10;                            popUpTo(0) { inclusive = true }&#10;                        }&#10;                    },&#10;                    onNavigateToLogin = { navController.popBackStack() }&#10;                )&#10;            }&#10;            // Nueva ruta para registro desde Admin (solo crea documento en Firestore)&#10;            composable(AppRoutes.RegisterAdmin.route) {&#10;                RegisterScreen(&#10;                    onRegisterSuccess = {&#10;                        Toast.makeText(context, &quot;Usuario creado correctamente&quot;, Toast.LENGTH_SHORT).show()&#10;                        // Al crear desde admin solo volver al home del admin&#10;                        navController.navigate(AppRoutes.Home.route) {&#10;                            popUpTo(0) { inclusive = true }&#10;                        }&#10;                    },&#10;                    onNavigateToLogin = { navController.popBackStack() },&#10;                    createOnly = true&#10;                )&#10;            }&#10;            composable(AppRoutes.ResetPassword.route) {&#10;                ResetPasswordScreen(&#10;                    onPasswordResetSent = { navController.popBackStack() },&#10;                    onNavigateToLogin = { navController.popBackStack() }&#10;                )&#10;            }&#10;            composable(AppRoutes.Home.route) { HomeScreen(navController = navController) }&#10;            composable(AppRoutes.Profile.route) { ProfileScreen() }&#10;            composable(AppRoutes.Payments.route) { PaymentsScreen() }&#10;            composable(AppRoutes.Transport.route) { TransportScreen() }&#10;            composable(AppRoutes.Notes.route) {&#10;                if (isDocente) {&#10;                    com.example.appcolegios.academico.TeacherNotesScreen(navController = navController)&#10;                } else {&#10;                    NotesScreen()&#10;                }&#10;            }&#10;            composable(AppRoutes.Attendance.route) { AttendanceScreen() }&#10;            composable(AppRoutes.Announcements.route) { AnnouncementsScreen(navController) }&#10;            composable(AppRoutes.Tasks.route) { TasksScreen() }&#10;            // Ruta para calificar (Cursos -&gt; Estudiantes -&gt; Notas)&#10;            composable(AppRoutes.Grading.route) { com.example.appcolegios.academico.GradingScreen() }&#10;            composable(AppRoutes.Notifications.route) { NotificationsScreen() }&#10;            composable(AppRoutes.Messages.route) { ConversationsScreen(navController = navController) }&#10;            composable(AppRoutes.Calendar.route) { CalendarScreen() }&#10;            composable(AppRoutes.Schedule.route) { ScheduleScreen() }&#10;            composable(AppRoutes.Admin.route) { AdminScreen() }&#10;            composable(AppRoutes.TeacherHome.route) { TeacherHomeScreen(navController) }&#10;            composable(AppRoutes.StudentHome.route) { StudentHomeScreen(navController = navController) }&#10;            // Ruta Ubicación del colegio&#10;            composable(AppRoutes.Ubicacion.route) { UbicacionScreen() }&#10;            composable(&#10;                route = AppRoutes.Chat.route,&#10;                arguments = listOf(navArgument(&quot;otherUserId&quot;) { type = NavType.StringType })&#10;            ) { backStackEntry2 -&gt;&#10;                val otherUserId = backStackEntry2.arguments?.getString(&quot;otherUserId&quot;) ?: &quot;&quot;&#10;                ChatScreen(navController = navController, otherUserId = otherUserId)&#10;            }&#10;            composable(AppRoutes.NewMessage.route) {&#10;                NewMessageScreen(&#10;                    onUserSelected = { userId -&gt;&#10;                        navController.navigate(&quot;chat/$userId&quot;)&#10;                    },&#10;                    onBack = { navController.popBackStack() }&#10;                )&#10;            }&#10;            composable(AppRoutes.VerifyEmail.route) {&#10;                VerifyEmailScreen(onDone = { navController.navigate(AppRoutes.Splash.route) {&#10;                    popUpTo(0) { inclusive = true }&#10;                } }, onVerified = { dest -&gt;&#10;                    navController.navigate(dest) {&#10;                        popUpTo(0) { inclusive = true }&#10;                    }&#10;                })&#10;            }&#10;            composable(AppRoutes.Dashboard.route) { DashboardScreen() }&#10;        }&#10;    }&#10;&#10;    if (!showChrome) {&#10;        // Rutas de auth/splash sin chrome&#10;        content()&#10;    } else {&#10;        // Drawer lateral funcional con opciones&#10;        ModalNavigationDrawer(&#10;            drawerState = drawerState,&#10;            drawerContent = {&#10;                ModalDrawerSheet {&#10;                    Spacer(Modifier.height(12.dp))&#10;                    Text(&#10;                        &quot;Menú&quot;,&#10;                        modifier = Modifier.padding(16.dp),&#10;                        style = MaterialTheme.typography.titleLarge&#10;                    )&#10;                    HorizontalDivider()&#10;&#10;                    // Opción Home / Admin&#10;                    if (isAdmin) {&#10;                        // Drawer item para administradores: ir a Admin&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.Home, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.panel_admin)) },&#10;                            selected = currentDestination?.route == AppRoutes.Admin.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Admin.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;                    } else {&#10;                        // Opción Home para usuarios no-admin (restaurada: menú completo)&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.Home, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.home)) },&#10;                            selected = currentDestination?.route == AppRoutes.Home.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Home.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Mensajes&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.AutoMirrored.Filled.Message, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.messages)) },&#10;                            selected = currentDestination?.route == AppRoutes.Messages.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Messages.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Notificaciones&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.Notifications, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.notifications)) },&#10;                            selected = currentDestination?.route == AppRoutes.Notifications.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Notifications.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Pagos&#10;                        if (!isStudent &amp;&amp; !isDocente) {&#10;                            NavigationDrawerItem(&#10;                                icon = { Icon(Icons.Filled.CreditCard, contentDescription = null) },&#10;                                label = { Text(stringResource(R.string.payments)) },&#10;                                selected = currentDestination?.route == AppRoutes.Payments.route,&#10;                                onClick = {&#10;                                    scope.launch { drawerState.close() }&#10;                                    navController.navigate(AppRoutes.Payments.route) {&#10;                                        launchSingleTop = true&#10;                                        restoreState = true&#10;                                    }&#10;                                },&#10;                                modifier = Modifier.padding(horizontal = 12.dp)&#10;                            )&#10;                        }&#10;&#10;                        // Transporte&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.DirectionsBus, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.transporte)) },&#10;                            selected = currentDestination?.route == AppRoutes.Transport.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Transport.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Notas&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.School, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.notes)) },&#10;                            selected = currentDestination?.route == AppRoutes.Notes.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Notes.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Asistencia&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.AutoMirrored.Filled.Assignment, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.attendance)) },&#10;                            selected = currentDestination?.route == AppRoutes.Attendance.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Attendance.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Tareas&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.AutoMirrored.Filled.EventNote, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.tasks)) },&#10;                            selected = currentDestination?.route == AppRoutes.Tasks.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Tasks.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;&#10;                        // Calendario&#10;                        NavigationDrawerItem(&#10;                            icon = { Icon(Icons.Filled.CalendarToday, contentDescription = null) },&#10;                            label = { Text(stringResource(R.string.calendar)) },&#10;                            selected = currentDestination?.route == AppRoutes.Calendar.route,&#10;                            onClick = {&#10;                                scope.launch { drawerState.close() }&#10;                                navController.navigate(AppRoutes.Calendar.route) {&#10;                                    launchSingleTop = true&#10;                                    restoreState = true&#10;                                }&#10;                            },&#10;                            modifier = Modifier.padding(horizontal = 12.dp)&#10;                        )&#10;                    }&#10;&#10;                    // Opciones comunes: Perfil y Cerrar sesión&#10;                    NavigationDrawerItem(&#10;                        icon = { Icon(Icons.Filled.Person, contentDescription = null) },&#10;                        label = { Text(stringResource(R.string.profile)) },&#10;                        selected = currentDestination?.route == AppRoutes.Profile.route,&#10;                        onClick = {&#10;                            scope.launch { drawerState.close() }&#10;                            navController.navigate(AppRoutes.Profile.route) {&#10;                                launchSingleTop = true&#10;                                restoreState = true&#10;                            }&#10;                        },&#10;                        modifier = Modifier.padding(horizontal = 12.dp)&#10;                    )&#10;&#10;                    // Logout&#10;                    NavigationDrawerItem(&#10;                        icon = { Icon(Icons.AutoMirrored.Filled.Logout, contentDescription = null) },&#10;                        label = { Text(stringResource(R.string.logout)) },&#10;                        selected = false,&#10;                        onClick = {&#10;                            scope.launch { drawerState.close() }&#10;                            // limpiar datos locales y lanzar actividad de login para cerrar sesión&#10;                            scope.launch {&#10;                                try {&#10;                                    userPrefs.clearAllUserData()&#10;                                } catch (_: Exception) {}&#10;                                val activity = context as? Activity&#10;                                val intent = Intent(context, LoginActivity::class.java)&#10;                                context.startActivity(intent)&#10;                                activity?.finish()&#10;                            }&#10;                        },&#10;                        modifier = Modifier.padding(horizontal = 12.dp)&#10;                    )&#10;                }&#10;            }&#10;        ) {&#10;            Scaffold(&#10;                topBar = {&#10;                    var overflowOpen by androidx.compose.runtime.remember { androidx.compose.runtime.mutableStateOf(false) }&#10;                    CenterAlignedTopAppBar(&#10;                        title = {&#10;                            Text(&#10;                                when (currentDestination?.route) {&#10;                                    AppRoutes.Home.route -&gt; stringResource(R.string.home)&#10;                                    AppRoutes.Messages.route -&gt; stringResource(R.string.messages)&#10;                                    AppRoutes.Notifications.route -&gt; stringResource(R.string.notifications)&#10;                                    AppRoutes.Profile.route -&gt; stringResource(R.string.profile)&#10;                                    AppRoutes.Payments.route -&gt; stringResource(R.string.payments)&#10;                                    AppRoutes.Transport.route -&gt; stringResource(R.string.transporte)&#10;                                    AppRoutes.Notes.route -&gt; stringResource(R.string.notes)&#10;                                    AppRoutes.Attendance.route -&gt; stringResource(R.string.attendance)&#10;                                    AppRoutes.Tasks.route -&gt; stringResource(R.string.tasks)&#10;                                    AppRoutes.Calendar.route -&gt; stringResource(R.string.calendar)&#10;                                    AppRoutes.TeacherHome.route -&gt; stringResource(R.string.home)&#10;                                    AppRoutes.StudentHome.route -&gt; stringResource(R.string.home)&#10;                                    AppRoutes.Admin.route -&gt; stringResource(R.string.panel_admin)&#10;                                    AppRoutes.Dashboard.route -&gt; stringResource(R.string.dashboard)&#10;                                    else -&gt; stringResource(R.string.app_name)&#10;                                }&#10;                            )&#10;                        },&#10;                        navigationIcon = {&#10;                            // Ícono de menú que abre el drawer&#10;                            IconButton(onClick = { scope.launch { drawerState.open() } }) {&#10;                                Icon(Icons.Filled.Menu, contentDescription = &quot;Menú&quot;)&#10;                            }&#10;                        },&#10;                        actions = {&#10;                            // Notificaciones con badge&#10;                            IconButton(onClick = { navController.navigate(AppRoutes.Notifications.route) }) {&#10;                                BadgedBox(badge = {&#10;                                    if (notifCount &gt; 0) {&#10;                                        Badge { Text(if (notifCount &gt; 99) &quot;99+&quot; else notifCount.toString()) }&#10;                                    }&#10;                                }) {&#10;                                    Icon(Icons.Filled.Notifications, contentDescription = &quot;Notificaciones&quot;)&#10;                                }&#10;                            }&#10;                            // Overflow con accesos: Perfil, Pagos, Calendario y Dashboard (admin)&#10;                            IconButton(onClick = { overflowOpen = true }) {&#10;                                Icon(Icons.Filled.MoreVert, contentDescription = &quot;Más opciones&quot;)&#10;                            }&#10;                            DropdownMenu(expanded = overflowOpen, onDismissRequest = { overflowOpen = false }) {&#10;                                DropdownMenuItem(text = { Text(stringResource(R.string.profile)) }, onClick = {&#10;                                    overflowOpen = false&#10;                                    navController.navigate(AppRoutes.Profile.route)&#10;                                })&#10;                                if (!isStudent &amp;&amp; !isDocente) {&#10;                                    DropdownMenuItem(text = { Text(stringResource(R.string.payments)) }, onClick = {&#10;                                        overflowOpen = false&#10;                                        navController.navigate(AppRoutes.Payments.route)&#10;                                    })&#10;                                }&#10;                                DropdownMenuItem(text = { Text(stringResource(R.string.calendar)) }, onClick = {&#10;                                    overflowOpen = false&#10;                                    navController.navigate(AppRoutes.Calendar.route)&#10;                                })&#10;                                // El menú overflow ya no muestra &quot;Dashboard&quot; para evitar duplicado&#10;                                // (la opción Dashboard permanece en el drawer lateral para administradores)&#10;                            }&#10;                        },&#10;                        colors = TopAppBarDefaults.centerAlignedTopAppBarColors(&#10;                            containerColor = MaterialTheme.colorScheme.primaryContainer,&#10;                            titleContentColor = MaterialTheme.colorScheme.onPrimaryContainer,&#10;                            navigationIconContentColor = MaterialTheme.colorScheme.onPrimaryContainer,&#10;                            actionIconContentColor = MaterialTheme.colorScheme.onPrimaryContainer&#10;                        )&#10;                    )&#10;                },&#10;                bottomBar = {&#10;                    NavigationBar(containerColor = MaterialTheme.colorScheme.surface) {&#10;                        bottomItems.forEach { item -&gt;&#10;                            val selected = currentDestination?.hierarchy?.any { it.route == item.route } == true&#10;                            val scale by animateFloatAsState(targetValue = if (selected) 1f else 0.95f, label = &quot;nav_icon_scale&quot;)&#10;                            NavigationBarItem(&#10;                                selected = selected,&#10;                                onClick = {&#10;                                    // Navegación directa al destino (simple y confiable para evitar problemas desde Admin)&#10;                                    navController.navigate(item.route) {&#10;                                        launchSingleTop = true&#10;                                        restoreState = true&#10;                                    }&#10;                                },&#10;                                icon = {&#10;                                    val iconModifier = Modifier.graphicsLayer(scaleX = scale, scaleY = scale)&#10;                                    when (item.route) {&#10;                                        AppRoutes.Notifications.route -&gt; {&#10;                                            BadgedBox(badge = {&#10;                                                if (notifCount &gt; 0) {&#10;                                                    Badge { Text(if (notifCount &gt; 99) &quot;99+&quot; else notifCount.toString()) }&#10;                                                }&#10;                                            }) { Icon(item.icon, contentDescription = item.label, modifier = iconModifier) }&#10;                                        }&#10;                                        AppRoutes.Messages.route -&gt; {&#10;                                            BadgedBox(badge = {&#10;                                                if (msgCount &gt; 0) {&#10;                                                    Badge { Text(if (msgCount &gt; 99) &quot;99+&quot; else msgCount.toString()) }&#10;                                                }&#10;                                            }) { Icon(item.icon, contentDescription = item.label, modifier = iconModifier) }&#10;                                        }&#10;                                        else -&gt; Icon(item.icon, contentDescription = item.label, modifier = iconModifier)&#10;                                    }&#10;                                },&#10;                                label = { Text(item.label) }&#10;                            )&#10;                        }&#10;                    }&#10;                }&#10;            ) { innerPadding -&gt;&#10;                Box(Modifier.padding(innerPadding)) {&#10;                    content()&#10;                }&#10;            }&#10;        }&#10;    }&#10;}&#10;&#10;private data class BottomItem(val label: String, val route: String, val icon: androidx.compose.ui.graphics.vector.ImageVector)&#10;" />
            </PendingDiffInfo>
          </value>
        </entry>
      </map>
    </option>
  </component>
</project>